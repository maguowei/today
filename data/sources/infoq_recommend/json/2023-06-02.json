[
  {
    "title": "Patcher：实现基础设施即代码持续更新的利器",
    "url": "https://www.infoq.cn/article/Sq6akvwJgu6LzuBM5pkx",
    "summary": "<p>Gruntwork<a href=\"https://blog.gruntwork.io/introducing-patcher-a-new-tool-for-keeping-infrastructure-code-up-to-date-e65b0c203b6b\">发布</a>\"Patcher的Beta测试版。该工具可以自动保持基础设施即代码的更新，即使有重大更改也没问题。</p><p>&nbsp;</p><p>在撰写本文时，Patcher允许将<a href=\"https://gruntwork.io/reference-architecture/\">参考架构</a>\"从<a href=\"https://docs.aws.amazon.com/securityhub/latest/userguide/cis-aws-foundations-benchmark.html\">CIS AWS Foundation Benchmark</a>\" 1.4版本升级到1.5版本。该版本引入了200多项更改并修复了3项重大更改。参考架构是一系列建议和最佳实践，将来自Gruntwork的<a href=\"https://gruntwork.io/infrastructure-as-code-library/\">基础设施即代码库</a>\"组装成AWS上的端到端技术栈。Patcher的目标是让用户可以管理Gruntwork基础设施即代码库的所有升级工作，并自动执行一系列的操作。</p><p>&nbsp;</p><p>用户可以从GitHub存储库安装Patcher（在撰写本文时，访问其存储库还需要向Gruntwork申请）。Patcher使用Docker在沙盒环境中执行升级。</p><p>&nbsp;</p><p>安装完成后，要升级IaC存储库，Patcher会执行以下步骤：</p><p>查找依赖项更新应用更改的补丁检查更改部署</p><p>&nbsp;</p><p>Patcher使用以下命令查找并更新依赖项：</p><p><code lang=\"null\">patcher upgrade</code></p><p>&nbsp;</p><p>该工具会分析源代码并自动发现依赖项、每个依赖项的版本，以及是否有新版本。在下面的示例中，Patcher发现了一些需要升级的依赖项。</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/f2/f22c4bdaf32faf29066e39a46db35fae.jpeg\" /></p><p></p><p><a href=\"https://blog.gruntwork.io/introducing-patcher-a-new-tool-for-keeping-infrastructure-code-up-to-date-e65b0c203b6b\">Patcher如何显示需要升级的依赖项</a>\"</p><p>&nbsp;</p><p>Patcher允许维护人员定义一个补丁，指定如何转换代码以完成重大更改。应用于代码的补丁通过YAML文件描述。Patcher会执行YAML代码中定义的步骤。那些步骤可能是任意命令。例如，tflint（一种强制执行与安全组相关的新建议的方法）的补丁可以指定为：</p><p><code lang=\"null\">name: \"Add tflint hook to Terragrunt configuration for CIS compliance checks\"\nauthor: Gruntwork \nimage: gruntwork/patcher_bash_env:v0.0.12\nsteps:\n  - name: \"Create tflint configuration\"\n    run: create_tf_lint_config.sh\n  - name: \"Add to the root terragrunt.hcl a hook for tflint\"\n    run: add_hook.sh</code></p><p>&nbsp;</p><p>Patcher在已定义的Docker镜像中执行升级。这使得代码可移植，并且能够通过限制镜像可以查看的内容和执行的操作来保证用户的安全。当Patcher升级完成后，它会显示应用的所有补丁的摘要信息。这样，用户就可以查看更改并应用它们。</p><p>&nbsp;</p><p>可以使用git diff进行检查，因为Patcher会将所有的更改都保存在本地存储库中。然后，用户可以决定提交所有更改，还是进行部分更改。</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/ef/ef7a980fa6c7481e48a80238ed621cc0.jpeg\" /></p><p></p><p><a href=\"https://blog.gruntwork.io/introducing-patcher-a-new-tool-for-keeping-infrastructure-code-up-to-date-e65b0c203b6b\">在Patcher升级后执行git diff</a>\"</p><p>&nbsp;</p><p>在上面的屏幕截图中，作为从CIS 1.4到1.5升级的一部分，Patcher做了一些更改，应用了一些补丁。</p><p>&nbsp;</p><p>Patcher的第一个版本专注于支持从CIS 1.4到1.5的迁移，但Gruntwork的愿景是将Gruntwork基础设施即代码和参考架构的所有更新都自动化。</p><p>&nbsp;</p><p>原文链接：</p><p><a href=\"https://www.infoq.com/news/2023/04/patcher-iac-upgrade/\">https://www.infoq.com/news/2023/04/patcher-iac-upgrade/</a>\"</p><p></p><p>相关阅读：</p><p><a href=\"https://www.infoq.cn/article/Rxk0KGocM5ygWH8mS90v\">谷歌发布云基础设施可靠性指南，帮助消费者做出正确决策</a>\"</p><p><a href=\"https://www.infoq.cn/article/6puCE2lCFJPgz0YLexg5\">Medium的Kubernetes基础设施</a>\"</p>",
    "publish_time": "2023-06-02 08:00:00",
    "source": {
      "name": "infoq_recommend",
      "desc": "InfoQ推荐",
      "icon": "https://raw.githubusercontent.com/maguowei/today/master/imgs/icon/infoq.png"
    }
  }
]