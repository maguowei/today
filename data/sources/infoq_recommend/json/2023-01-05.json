[
  {
    "title": "Grafana Labs发布跟踪查询语言TraceQL",
    "url": "https://www.infoq.cn/article/4rQRdft9ps5mfbXu2gRs",
    "summary": "<p>作为即将发布的<a href=\"https://www.infoq.com/news/2022/10/grafana-92-metrics-tracing/\">Grafana Tempo 2.0</a>\"的一部分，<a href=\"https://grafana.com/blog/2022/11/30/traceql-a-first-of-its-kind-query-language-to-accelerate-trace-analysis-in-tempo-2.0/\">TraceQL</a>\"是一种旨在简化交互式搜索和提取跟踪信息的查询语言。根据Grafana官方的说法，这将有助于加快诊断故障根源的过程。</p><p>&nbsp;</p><p></p><blockquote>分布式跟踪包含了丰富的信息，可以帮助开发者跟踪错误、确定故障根源、分析性能，等等。虽然一些自动增强检测工具也可以用于捕获这些数据，但从这些数据中提取有价值的信息却要困难得多。</blockquote><p></p><p>&nbsp;</p><p>根据Grafana官方的说法，如果你不知道你需要哪些跟踪信息，或者如果你想重建事件链的上下文，那么现有的跟踪解决方案在搜索跟踪信息时就没有那么灵活。这也就是为什么要从头设计TraceQL来处理跟踪信息。下面的示例展示了如何查找与耗时超过一秒的数据库插入操作相对应的跟踪信息：</p><p><code lang=\"null\">{ .db.statement =~ \"INSERT.*\"} | avg(duration) &gt; 1s</code></p><p>&nbsp;</p><p>TraceQL支持<a href=\"https://github.com/grafana/tempo/blob/main/docs/design-proposals/2022-04%20TraceQL%20Concepts.md\">使用span</a>\"、时间点和时间段来选择跟踪信息，它可以聚合同一个跟踪信息中的多个span的数据，并利用span之间的结构关系。查询由一组被选中或被丢弃的span集合的链式表达式组成，例如：</p><p><code lang=\"null\">{ .http.status = 200 } | by(.namespace) | count() &gt; 3</code></p><p>&nbsp;</p><p>它支持属性字段、包含字段的表达式、组合并聚合span集合、分组、管道，等等。下面的示例展示了如何过滤所有按照特定的顺序经过两个区域的跟踪信息：</p><p><code lang=\"null\">{ .region = \"eu-west-0\" } &gt;&gt; { .region = \"eu-west-1\" }</code></p><p>&nbsp;</p><p>TraceQL可感知数据类型，这意味着你可以使用文本、整数和其他数据类型来表示查询。此外，TraceQL兼容Tempo 2.0中的<a href=\"https://parquet.apache.org/\">Apache Parquet</a>\"存储格式。Parquet是一种列式数据文件格式，许多数据库和分析工具都支持这种格式。</p><p>&nbsp;</p><p>如上所述，TraceQL将成为Tempo 2.0的一部分，后者将在未来几周内发布，<a href=\"https://grafana.com/grafana/download/9.3.1?edition=oss&amp;mdm=rss&amp;platform=docker&amp;src=grafana\">Grafana 9.3.1</a>\"中已经内置了其预览版本。</p><p>&nbsp;</p><p>原文链接：</p><p><a href=\"https://www.infoq.com/news/2022/12/grafana-traceql/\">https://www.infoq.com/news/2022/12/grafana-traceql/</a>\"</p><p></p><p>相关阅读：</p><p><a href=\"https://xie.infoq.cn/article/2723176da5693f6085c6b1e78\">一文带你了解&nbsp;Grafana&nbsp;最新开源项目 Mimir 的前世今生</a>\"</p><p><a href=\"https://www.infoq.cn/article/e2B77jUHkWSRmgN9G7uV\">Grafana、Loki 和 Tempo 更改开源协议，由 Apache License 2.0 转为 AGPL v3</a>\"</p><p><a href=\"https://www.infoq.cn/article/k2tWvtKrSIpKIxloqfdN\">Grafana&nbsp;9 在警报和用户体验方面带来巨大改进</a>\"</p>",
    "publish_time": "2023-01-05 08:00:00",
    "source": {
      "name": "infoq_recommend",
      "desc": "InfoQ推荐",
      "icon": "https://raw.githubusercontent.com/maguowei/today/master/imgs/icon/infoq.png"
    }
  },
  {
    "title": "消息称微软将投资自动驾驶初创公司Gatik，后者估值超7亿美元",
    "url": "https://www.infoq.cn/article/yQW1dCHFQemYLSuHx0Tf",
    "summary": "<p>当地时间1月4日，据路透社报道，据两名知情人士透露，微软公司正在就投资<a href=\"https://gatik.ai/\">自动驾驶初创公司 Gatik </a>\"进行高级谈判，这也是双方进行云计算合作的一部分。</p><p>&nbsp;</p><p>据悉，Gatik公司总部位于加州，由行业资深人士 Gautam Narang 和 Arjun Narang 于 2017 年创立，专注于零售业的中等距离B2B物流。</p><p>&nbsp;</p><p>自从 2021 年以来，该公司已经与沃尔玛和 Loblaw Companies 合作推出了全无人驾驶商业配送服务，Gatik 负责在美国阿肯色州和加拿大安大略省提供厢式货车的短途配送服务。</p><p>&nbsp;</p><p>迄今为止，Gatik公司已经融资超过 1.2 亿美元，投资者包括 Koch Disruptive Technologies、Innovation Endeavors、Goodyear Ventures 和 RyderVentures。</p><p>&nbsp;</p><p>今年第一季度，Gatik 计划将该公司的自动驾驶箱式货车整合到 Pitney Bowes 位于美国得州达拉斯市的电子商务物流网络中，以期改善配送效率和降低物流成本。</p><p>&nbsp;</p><p>消息人士补充说，此次<a href=\"https://www.infoq.cn/article/kAa4265g8zfsKVXm1MG3\">微软</a>\"计划为Gatik投资超过1000万美元，对 Gatik的估值也超过7亿美元。作为该交易的一部分，Gatik 将使用微软的云和边缘计算平台 Azure 来开发卡车无人驾驶交付技术。</p><p>&nbsp;</p><p>知情人士称，该交易的具体条款仍有可能发生变化。</p><p>&nbsp;</p><p>截至发稿前，<a href=\"https://www.infoq.cn/article/FJhulyO6mpox7bqqZIg4\">微软</a>\"和Gatik均拒绝对此置评。</p><p>&nbsp;</p><p>与其他大型科技公司一样，微软最近一直在向<a href=\"https://www.infoq.cn/article/JElWUoZJokAshqchaiBw\">自动驾驶</a>\"技术投入资金。2021年1月，微软投资了通用汽车旗下的机器人出租车公司 Gruise，这笔交易对该公司的估值为300亿美元。Cruise 计划使用微软 Azure 来加快无人驾驶汽车解决方案的商用步伐，并与 Alphabet 旗下的 Waymo 和亚马逊旗下的 Zoox 展开竞争。</p><p>&nbsp;</p><p>自动驾驶技术被视为运输和物流行业的革命性技术，但由于监管机构担心安全问题，加之市场增长放缓导致资金匮乏，使得整个行业面临挫折。</p><p>&nbsp;</p><p>2022年11月，福特和大众关闭了他们的自动驾驶技术部门 <a href=\"https://www.infoq.cn/article/bucqgwcQO7KSPctEc3oV\">Argo AI</a>\"，称开发无人驾驶机器人出租车“比把人类送上月球还难”。</p><p>&nbsp;</p><p>参考链接：</p><p><a href=\"https://www.reuters.com/business/autos-transportation/microsoft-invest-autonomous-trucking-startup-gatik-sources-2023-01-04/\">https://www.reuters.com/business/autos-transportation/microsoft-invest-autonomous-trucking-startup-gatik-sources-2023-01-04/</a>\"</p>",
    "publish_time": "2023-01-05 10:08:57",
    "source": {
      "name": "infoq_recommend",
      "desc": "InfoQ推荐",
      "icon": "https://raw.githubusercontent.com/maguowei/today/master/imgs/icon/infoq.png"
    }
  },
  {
    "title": "Apache Doris 在小米亿级用户行为分析平台的实践",
    "url": "https://www.infoq.cn/article/iT7purpsKqaPwr8Touco",
    "summary": "<p></p><blockquote>作者｜小米数据智能部开发工程师 汤佳树编辑｜SelectDB</blockquote><p></p><p></p><p>小米用户行为分析统一平台是基于海量数据的一站式、全场景、多模型、多维度、自助式大数据智能洞察分析服务平台，对接各类数据源，进行加工处理、分析挖掘和可视化展现，满足各类用户在用户洞察场景下的数据分析应用需求，提供高效极致的分析体验。</p><p></p><h1>业务需求</h1><p></p><p></p><p>平台可以基于数据进行时间分析，留存分析，分布分析，漏斗分析等，业务方主要基于事件进行分析，事件是追踪或记录的用户行为或业务过程，可以是单个事件也可以是多个事件组合的虚拟事件。</p><p></p><p>数据来源于各业务的打点数据，且基于事件模型进行建模，用户在产品中的各种操作都可以抽象成 Event 实体，并且里面都会包含五要素：</p><p></p><p>Who：即参与这个事件的用户是谁，例如用户的唯一 IDWhen：即这个事件发生的实际时间，例如time字段，记录精确到毫秒的事件发生时间Where：即事件发生的地点，例如根据 IP 解析出的省份和城市How：即用户从事这个事件的方式，例如用户的设备，使用的浏览器，使用的 App 版本等等What：描述用户所做的这件事件的具体内容，例如点击类型的事件，需要记录的字段有点击 URL，点击 Title，点击位置等</p><p></p><p>数据基于 OLAP 引擎 Doris 进行存储，随着接入业务不断增多，且接入的业务量不断膨胀，Top 级应用可以达到 100 亿条/天，查询压力和时间相继增大，用户对查询时延的吐槽愈来愈多，我们急切的需要提升查询性能来提升用户的体验。</p><p></p><h1>痛点问题</h1><p></p><p></p><p>针对于业务需求，我们总结了以下痛点问题：</p><p></p><p>为了实现复杂的业务需求，OLAP 分析引擎需要留存、漏斗等分析函数支撑。增量数据 100亿/天，导入压力大，部分业务要求数据导入不丢不重。业务接入不断增多，数据量膨胀，需要 PB 级的数据下的交互式分析查询达到秒级响应。</p><p></p><p>为了解决以上的痛点问题，我们对比了多款 OLAP 分析引擎，最终选择了 Apache Doris。Doris 提供了留存、漏斗分析等函数，极大程度的简化了开发的成本。在数据导入的过程中，我们尝试 Doris 刚推出的 <a href=\"http://mp.weixin.qq.com/s?__biz=Mzg3Njc2NDAwOA==&amp;mid=2247512201&amp;idx=1&amp;sn=13e743781165eb3b28cef0a98aa09902&amp;chksm=cf2fbe8ef858379879dcb3769285759c74515b6a7d069cea8e445c5200e053e4da44e8ff4b17&amp;scene=21#wechat_redirect\">Merge On Write Unique Key</a>\" 导入模型，可以抗住 100 亿/天的增量数据压力。针对于向量化查询引擎的改造也是的性能较之前的版本有 3-5 倍的提升。</p><p></p><h1>架构演进</h1><p></p><p></p><p>一个优秀的系统离不开持续迭代与演进。为了更好的满足业务需求，我们在存储架构与查询引擎两个层面上不断进行尝试，小米用户行为分析系统在上线后，目前已完成 3 次改造，以下将为大家介绍改造历程。</p><p></p><h2>数据存储结构：数据架构的演进</h2><p></p><p><img src=\"https://static001.geekbang.org/infoq/79/79026c1e0c92aab3c4444ef499032e00.png\" /></p><p></p><p>在小米的用户行为分析平台中，原始数据通过小米自研的消息队列 Talos，在 Flink 中清洗与建模后，被下游的 Doris 与 Hive 消费。全量的数据会存储在 Hive 中，进行批量 ETL 或历史数据召回的查询。实时增量数据被存储在 Doris 中，用来做热数据的查询操作。基于冷热数据分离的架构，我们进行了 3 次架构的演进。</p><p></p><h3>第一阶段：基于明细宽表的查询</h3><p></p><p></p><p>在最初的阶段我们使用了基于明细的宽表查询模式。为了处理灵活多样的分析请求，在系统中，我们配合统一埋点平台处理数据，接入的 OLAP 的数据是直接埋点的全字段展平。在入库之前，我们在 Flink 中将数据打平，以宽表的模式存储在 Doris 明细表中。根据查询的需求，我们将经常使用的列作为建表的维度列，利用前缀索引的特性进行查询加速。但某些头部大数据量业务容易查询多天数据，一个大查询可能就会将集群资源占满甚至导致集群不可用，且查询耗时相当之久。</p><p></p><h3>第二阶段：基于聚合模型的查询加速</h3><p></p><p></p><p>在改造的第二阶段，我们使用了聚合模型对业务查询进行加速。 我们对接入行为分析的应用进行统计分析，绝大多数接入行为分析的应用数据量在 1 亿/天数据量以内。对于部分使用频率较高的表，我们采用聚合表完成查询加速，对单天数据量超 10 亿且高频的头部应用做聚合表加速。具体流程为根据数据量挑选出头部应用，对其进行字段解析，并挑选出常用指标及维度，由 Hive 表数据进行聚合 T-1 产出数据，最后写入到 Doris 中，进行查询加速。该阶段的改造解决了集群头部业务大查询的问题，此时虽然独立集群存储没问题，但由于其他业务接入后还会持续增加数据量和埋点字段 ，这样会导致元数据最先进入瓶颈。</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/99/994259848095bea0234db963d87decc6.png\" /></p><p></p><h3>第三阶段（当前阶段）：业务适配的建表改造</h3><p></p><p></p><p>当前阶段，我们对业务需求进行深度解析后重新规划了建表结构。我们对某些应用的埋点字段进行分析，发现有些用户埋点字段多达 500+，但在行为分析里实际用到的可能只有 100+，这显然有所浪费。所以我们与用户沟通调研需求，配合行为分析平台侧的能力，用户可在平台对有用事件和属性进行筛选，同时设置字段映射和过滤逻辑，然后再进行建表。</p><p></p><h2>查询服务架构：查询引擎的改造与演进</h2><p></p><p></p><p>我们基于业务深度改造了查询的服务架构，构建了新的查询引擎架构，实现 SQL 的权重、路由、缓存和资源调度操作。根据查询条件，路由引擎会将 SQL 拆分成多条子查询，在 Doris 或 Hive 中执行后，将子查询的结果汇总，得到最终的结果。针对查询引擎，我们也进行了 3 次技术架构的改造。</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/42/42d78a8d362bf4feb222dcd707f1d40a.png\" /></p><p></p><h3>第一阶段：基于集群粒度的查询资源管理</h3><p></p><p></p><p>我们对集群粒度进行查询资源管理，在资源调度中，我们会给每一个 Doris 集群设置一个总的资源池大小（根据集群能力和测试进行量化），根据数据量大小和查询天数对每个 SQL 进行加权，并对资源池的最大最小并行 SQL 数进行限制，如果计算的 SQL 超过限制则进行排队。其次，还会利用 Redis 对数据进行 SQL 级别缓存。</p><p></p><h3>第二阶段：基于 SQL 路由的改造</h3><p></p><p></p><p>为适配聚合表加速做了路由层，提升缓存命中率和利用率，此阶段拆分原始提交 SQL，基于指标进行缓存，粒度更细，服务端可根据指标进行适当计算更易于缓存命中。值得一提的是排队时间往往会比较长，有些场景下可能会进行重复提交或拆分成同样的 SQL，为了提高效率会在 SQL 排队前和排队后各进行一次缓存校验。</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/ac/acbc39babd523f934b0f89f265ebe54a.png\" /></p><p></p><h3>第三阶段（当前阶段）：基于 SQL 权重的改造</h3><p></p><p></p><p>整体架构方面，由于采取了筛选埋点字段而非全量字段导入 Doris，针对头部问题用户，我们会基于查询历史统计指标及维度，根据指定的某些规则进行默认初始化操作，并以此沟通用户并进行引导升级。此外为了更精细的控制资源调度，本阶段对对 SQL 内容进行加权，如含有DISTINCT，LIKE，VARIANCE_SAMP等字样再加权。对于资源消耗较大的操作，如 DISTINCT，会给予更高的权重，调度引擎在执行时会分配更多的资源。</p><p></p><h1>实践应用</h1><p></p><p></p><p>数据建模</p><p></p><p>对业务来讲，分析查询需要较高的灵活度，且是对用户粒度进行分析，所以需要保留较多的维度和指标，我们选用 Doris 作为存储查询引擎，且采用明细表建模，这样可以保证用户能够根据分析需求查出数据。另一方面，由于查询分析是一个延时要求较高的产品，对于数据量大、查询天数多、语句复杂的情况，查询延时会很高，所以对于头部应用，我们根据高频指标维度进行了聚合表模型建模。</p><p></p><p><code lang=\"sql\"> CREATE TABLE `doris_XXX_event` (\n  `olap_date` bigint(20) NOT NULL COMMENT \"\",\n  `event_name` varchar(256) NOT NULL COMMENT \"\",\n  `uniq_id` varchar(256) NOT NULL COMMENT \"\",\n  `dim1` varchar(256) REPLACE NULL COMMENT \"\",\n  `dim2` varchar(256) REPLACE NULL COMMENT \"\",\n  ...\n  `cnt` bigint(20) REPLACE NULL COMMENT \"\",\n  `index1` double REPLACE NULL COMMENT \"\",\n  `index2` double REPLACE NULL COMMENT \"\",\n  ...\n) ENGINE=OLAP\nAGGREGATE KEY(`olap_date`, `event_name`, `uniq_id`)\nCOMMENT \"OLAP\"\nPARTITION BY RANGE(`olap_date`)</code></p><p></p><p>数据导入</p><p></p><p>明细表部分，我们接入 Json 格式 TalosTopic，动态获取 Doris 表的 Schema 信息，通过双缓冲区循环攒批的方式，利用 StreamLoad 向 Doris 中写数据，如果在导入 Doris 时有出现失败的批次，重试 10 次仍然失败，会将数据按照应用粒度存入 HDFS，并在凌晨定时调度任务重新写入 T-1 未写入的数据。聚合表部分，我们由 Talos 落盘的 Iceberg 表，每日进行 T-1 数据的聚合，根据服务端选取的维度和指标，以及聚合类型（count ,count distinct , sum ,max ,min ），进行聚合存入中间 Hive 表，再由统一导入 Doris 程序进行导入。</p><p></p><p>数据管理</p><p></p><p>明细数据和应用聚合表分库存储，TTL 均为 33 天。数据表会有数据质量监控，如果总行数或者设置指标环比波动太大，会进行告警人工介入确认数据是否有误，视紧急程度进行回补处理。</p><p></p><p>数据查询及应用</p><p></p><p>绝大多数用户会锚定事件，进行含指标聚合，去重用户数（几乎占总查询的 50%）的事件行为分析，同时还会有留存分析，漏斗分析，分布分析等分析类型。</p><p></p><p>建表模型的维护</p><p></p><p>为了适配业务的变更，上游的埋点信息会周期性的更新。原有的表结构需要进行变更以适配埋点的增加。在过去的 Doris 版本中，Schema Change 是一项相对消耗较大的工作，需要对文件进行修改。在<a href=\"http://mp.weixin.qq.com/s?__biz=Mzg3Njc2NDAwOA==&amp;mid=2247509133&amp;idx=1&amp;sn=a1c5a66404c0ceb0cd3015a4f2e13b9a&amp;chksm=cf2faa8af858239c761a46e4f729191cce45cd8cd0e5e1dfd78e8a7263f32661814c590306af&amp;scene=21#wechat_redirect\">新版本中开启 Light Schema Change 功能后</a>\" ， 对于增减列的操作不需要修改文件，只需要修改 FE 中的元数据，从而实现毫秒级的 Schame Change 操作。</p><p></p><h1>应用现状</h1><p></p><p></p><p>小米目前在 300 多个业务线上线了 Doris 集群，超过 1.5PB 的业务数据。在初期我们选择了两个使用较为频繁的集群进行向量化升级。</p><p></p><p>现迁移 Doris 向量化集群的行为分析业务有 2 个，7 天增量数据的平均值在百亿左右，存储空间占用 7T/天左右。在升级到向量化的版本后，存储资源有较大的节省，只需要原有集群约 2/3 的存储空间。</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/21/2113287a96fb92fae409ad675e128a50.png\" /></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/1b/1b3827026c93b1cd0a6286f569f723ff.png\" /></p><p></p><h1>性能提升</h1><p></p><p></p><h2>请求粒度</h2><p></p><p></p><p>升级 Doris 向量化版本后，行为分析平台以请求粒度统计查询耗时 P80 和均值，P80 耗时下降 43% ，平均耗时下降 27% ；统计口径：汇总 12.07-12.11 期间，行为分析请求粒度查询执行时间。</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/31/3162d30d6d313bfa349b3cf3f2b1a24e.png\" /></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/60/6013a31e2d7e4ff187dbbd15d7e2410e.png\" /></p><p></p><h2>SQL 粒度</h2><p></p><p></p><p>升级 Doris 向量化版本后，行为分析平台以 SQL 粒度来统计查询耗时 P80 和均值，耗时 P80 下降 70% ，平均耗时下降 54% 。统计口径：汇总 12.04-12.11 期间，行为分析 SQL 粒度查询执行时间（未含排队）</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/c1/c1dcb20e203d5576f90fac0224ccf60b.png\" /></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/96/9636245b7d709c8324a7369d23651c7d.png\" /></p><p></p><p>升级 Doris 向量化版本后，行为分析平台以 SQL 粒度统计查询耗时 P80 和均值，耗时 P80 下降 56% ，平均耗时下降 44% ；</p><p></p><p>统计口径：汇总 12.02-12.11，行为分析 SQL 粒度查询总时间 （含排队）</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/40/405af931262151e61f28b8108dda4351.png\" /></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/79/79aa7f0734f5982ed85dc1f85978cfb4.png\" /></p><p></p><h2>去重优化</h2><p></p><p></p><p>在 ID-Mapping 的时候，通常需要针对 ID 进行去重操作。在最初我们使用了COUNT DISTINCT来完成去重。</p><p></p><p><code lang=\"sql\">SELECT      a.`olap_date` AS `time`, \n            count(distinct a.`distinct_id`) AS distinct_id \nFROM        analysis.doris_XXX_event a \nWHERE       `a`.`olap_date` BETWEEN 20221218 AND 20221220 AND \n            a.`event_name` IN(XXXX, XXX, XXX, XXX) AND \n            ... ... \nGROUP BY    1 \nORDER BY    2 DESC \nLIMIT       10000</code></p><p></p><p>在经过优化后，我们使用子查询+ GROUP BY来替代COUNT DISTINCT的功能</p><p></p><p><code lang=\"sql\">SELECT      z.`time`, \n            count(distinct_id) var1 \nFROM        (SELECT     a.`olap_date` AS `time`, \n                        a.`distinct_id` AS distinct_id \n            FROM        analysis.doris_XXX_event a \n            WHERE       `a`.`olap_date` BETWEEN 20221218 AND 20221220 AND \n                        a.`event_name` (XXXX, XXX, XXX, XXX) AND \n                        ... ...\n            GROUP BY 1, 2) z \nGROUP BY    1 \nORDER BY    2 DESC \nLIMIT       10000</code></p><p></p><p>相较于原有的COUNT DISTINCT，使用子查询+ GROUP BY 的模式性能有 1/3 的提升。</p><p></p><h1>未来规划</h1><p></p><p></p><p>在过去的三年时间里，Apache Doris 已经在小米内部得到了广泛的应用，支持了集团数据看板、广告投放/广告 BI、新零售、用户行为分析、A/B 实验平台、天星数科、小米有品、用户画像、小米造车等小米内部数十个业务，并且在小米内部形成了一套以 Apache Doris 为核心的数据生态 。随着业务的持续增长，未来我们会进一步推动小米的其他业务上线向量化版本。</p><p></p><p>非常感谢 Apache Doris 社区与 SelectDB 公司的鼎力支持，小米集团作为 Apache Doris 最早期的用户之一，一直深度参与社区建设，参与 Apache Doris 的稳定性打磨，未来我们也会密切联系社区，为社区贡献更多的力量。</p>",
    "publish_time": "2023-01-05 10:27:51",
    "source": {
      "name": "infoq_recommend",
      "desc": "InfoQ推荐",
      "icon": "https://raw.githubusercontent.com/maguowei/today/master/imgs/icon/infoq.png"
    }
  },
  {
    "title": "从编译到可执行，eBPF 加速容器网络原理分析",
    "url": "https://www.infoq.cn/article/xpBcjM5O7PeRlteVXWQE",
    "summary": "<p></p><blockquote><a href=\"https://xie.infoq.cn/article/4740fad28050c331ea9d329df\">eBPF</a>\"(extended Berkeley Packet Filter) 是一种可以在 Linux 内核中运行用户编写的程序，而不需要修改内核代码或加载内核模块的技术。简单说，eBPF 让 <a href=\"https://www.infoq.cn/article/4lDxHRoqXbSw6zl29AEo\">Linux</a>\" 内核变得可编程化了。本文整理自龙蜥大讲堂第 57 期，浪潮信息 SE 王传国从原理上分析了 eBPF 的加载工作过程，解释了它如何保证系统运行稳定以及它能加速网络的原因。</blockquote><p></p><p></p><h2>1. eBPF 加载过程</h2><p></p><p></p><p>我们知道，一般 eBPF 的加载过程，首先是写&nbsp;C 代码，然后用 llvm lang 编译成&nbsp; ELF 文件，接着用 libelf 对&nbsp;ELF&nbsp;文件进行解析，解析之后按照 libbpf 所需要的格式进行数据的整理、组织，再通过 BPF 的系统调用，可以将这些数据都加载到内核里面，包括程序翻译出来的 eBPF 指令集。</p><p></p><p>在内核里面有校验器负责对程序进行校验，有 JIT 对程序进行翻译解析。</p><p></p><h4>1.1 重定位</h4><p></p><p></p><p>BPF 基础设施提供了一组有限的“稳定接口”， 使用 convert_ctx_access 对各种 CTX 进行转换，在内核版本升级时保证稳定。</p><p></p><p>CO-RE 核心思想就是采用(BTF)非硬编码的形式对成员在结构中的偏移位置进行描述，解决不同版本之间的差异。</p><p></p><p>需要重定位的元素：Map、函数调用、Helper函数调用、字段、Extern 内核符号和kconfig。</p><p></p><h4>1.2 安全性检查：数据、指令、循环</h4><p></p><p></p><p>数学计算除数不能为 0，指令调用范围[0, prog-&gt;len)深度优先遍历排除环。</p><p></p><h4>1.3 eBPF 指令集</h4><p></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/69/69d44b84bf70de0cf3650c18c2aef55d.png\" /></p><p></p><h4>1.4 指针安全性检查</h4><p></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/dd/ddd2c0f2de215b96b804e3cda0f3a23a.png\" /></p><p></p><p>确定指针类型、范围纠正，识别不了的指针类型不允许引用。</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/14/14bc918c8f8cbe676585133fcb738e36.png\" /></p><p></p><p>范围检查，不同的指针类型有不同的检查方法和范围。</p><p></p><h2>2. eBPF&nbsp;加速容器网络</h2><p></p><p></p><p>主要涉及的 eBPF 程序类型：XDP、tc、sock_ops。</p><p></p><p>它们加速网络性能的基本原理都是把数据直接从一端（网口/socket）的发送队列传递到另一端的接收或发送队列，绕过不需要的网络协议栈。</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/ce/ce278ff54bbe200e08db28af012d010b.png\" /></p><p></p><p>XDP 位于整个 Linux 内核网络软件栈的底部，还未生成 skb，能够非常早地识别并丢弃攻击报文，具有很高的性能；但是在虚拟机中有时候可能无法支持 XDP 程序的加载，例如虚拟机网卡的接收队列太少。</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/55/55016b4f999908d23edf234cc9414ddd.png\" /></p><p></p><p>在 tc 功能的 sch_handle_ingress、sch_handle_egress 添加 hook 点，分别是 tc ingress 和 tc egress，没有 XDP 那么多要求，基本上所有的 OS 中都能使用，绕过 netfilter 等非必要的内核网络协议栈路径，能极大地提升网络性能，降低延迟。</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/15/15084f0089e2b8b54ea77c4b0561f2e6.png\" /></p><p></p><p>技术概述：把数据从一端 socket 发送队列直接发送到对端 socket 的接收队列或发送队列。</p><p>sockops：挂载到cgroup，监控整个 cgroup 中所有 socket 的握手和挥手（主动|被动），记录 tcp 连接。</p><p>sockmap：存储数据特征与 socket 句柄的关系。写数据时执行 bpf_map_update，修改对应 socket 的 sendmsg 函数指针。</p><p>sk_msg：使用 sockmap 对数据进行 redirect 判定。</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/1b/1bfbf86749340e9360ae5a58bdab060d.png\" /></p><p></p><p>经过我们的测试，如果用 <a href=\"https://xie.infoq.cn/article/69592432882ccce6cc3fbd177\">Cilium</a>\" 替换 calico，用 TCP Throughput 模式测，那么&nbsp;pod 间的通讯性能&nbsp;tcp 吞吐量提升 58%、sockops 提升 153%、跨节点也能提升 24%。</p><p></p><p>如果用 TCP-RR 模式来测，那么相比 calico 同节点能提升 28%、sockops 提升200.82%、跨节点提升 43%。</p><p></p><p>如果用&nbsp;TCP_CRR&nbsp;模式去测的话，&nbsp;calico&nbsp;同节点能提升40%、sockops 提升 35% 、跨节点提升 55%。&nbsp;</p><p></p><p>Cilium&nbsp;在提升性能的时候，它对于 CPU 的占用降低了&nbsp;10% 以上，因此我们测试的结果是&nbsp;Cilium&nbsp;的性能要明显优于使用 iptables 的&nbsp;calico。所以说目前我们打算使用&nbsp;Cilium&nbsp;优化我们的容器网络。</p>",
    "publish_time": "2023-01-05 10:58:18",
    "source": {
      "name": "infoq_recommend",
      "desc": "InfoQ推荐",
      "icon": "https://raw.githubusercontent.com/maguowei/today/master/imgs/icon/infoq.png"
    }
  },
  {
    "title": "谷歌推出文本到图像模型Muse：生成图片质量更高、推理时间更短",
    "url": "https://www.infoq.cn/article/zIcEM3fpYm9zfvvcYUSu",
    "summary": "<p>自 2021 年初以来，随着大量深度学习支持的文本到图像模型（例如<a href=\"https://analyticsindiamag.com/choose-your-player-dall-e-2-or-midjourney/\">DALL-E-2</a>\"、<a href=\"https://analyticsindiamag.com/stability-ai-releases-stable-diffusion-2-0/\">Stable Diffusion</a>\"和<a href=\"https://analyticsindiamag.com/this-scariest-horror-movie-was-made-using-midjourney/\">Midjourney</a>\"等）的诞生，人工智能研究的进展发生了革命性的变化。</p><p>&nbsp;</p><p>近日，<a href=\"https://www.infoq.cn/article/76gYqPA2YU0YXCDHFvIE\">谷歌</a>\"Muse AI系统正式亮相。据谷歌Muse AI团队称，Muse是一种文本到图像的 Transformer 模型，该模型可以实现先进的图像生成性能。&nbsp;</p><p>&nbsp;</p><p></p><blockquote>我们提出Muse，一种文本到图像的 Transformer 模型，可实现先进的图像生成性能，同时比扩散或自回归模型更有效。——谷歌Muse AI团队</blockquote><p></p><p>&nbsp;</p><p>据开发团队介绍，与<a href=\"https://www.infoq.cn/article/BKPTWSyeidEDNaoBvEKv\"> Imagen </a>\"和 <a href=\"https://www.infoq.cn/article/SwDArsl8afPV6baZRyE0\">DALL-E 2</a>\" 等像素空间扩散模型相比，Muse 由于使用离散标记并且需要更少的采样迭代，因此效率显着提高；与 <a href=\"https://github.com/google-research/parti\">Parti </a>\"和其他自回归模型不同，<a href=\"https://muse-model.github.io/\">Muse </a>\"利用了并行解码。 为了生成高质量的图像并识别物体、它们的空间关系、姿态、基数等视觉概念，使用预训练的 LLM 可以实现细粒度的语言理解。Muse 还可以直接启用许多图像编辑应用程序，而无需微调或反转模型：修复、修复和无蒙版编辑。</p><p>&nbsp;</p><p>Muse的900M 参数模型在 CC3M 上实现了新的 SOTA，FID 得分为 6.06。Muse 3B 参数模型在零样本 COCO 评估中实现了 7.88 的 FID，以及 0.32 的 CLIP 分数。Muse 还可以直接启用许多图像编辑应用程序，而无需微调或反转模型：修复、修复和无蒙版编辑。</p><p>&nbsp;</p><p>Muse模型能够根据文本提示快速生成高质量图像：在 TPUv4 上，512x512 分辨率为 1.3 秒，256x256 分辨率为 0.5 秒。</p><p>&nbsp;</p><p>根据 MUSE 的基准测试可以看出，Muse 的推理时间明显低于竞争模型。</p><p>&nbsp;</p><p><img src=\"https://static001.geekbang.org/infoq/f5/f58f561c185e85afe800916a2b119952.png\" /></p><p></p><p>参考链接：</p><p>&nbsp;</p><p><a href=\"https://muse-model.github.io/\">https://muse-model.github.io/</a>\"</p><p><a href=\"https://dataconomy.com/2023/01/google-muse-ai-explained-how-does-it-work/\">https://dataconomy.com/2023/01/google-muse-ai-explained-how-does-it-work/</a>\"</p>",
    "publish_time": "2023-01-05 11:43:08",
    "source": {
      "name": "infoq_recommend",
      "desc": "InfoQ推荐",
      "icon": "https://raw.githubusercontent.com/maguowei/today/master/imgs/icon/infoq.png"
    }
  },
  {
    "title": "乐视实行4天半工作制：不降薪无996，研发可准点下班，网友：推行到全国可行吗？",
    "url": "https://www.infoq.cn/article/8boGZvjPt7I5qpa7f62C",
    "summary": "<p></p><p></p><blockquote>4 天工作制要不要推行？</blockquote><p></p><p></p><h2>乐视实行 4 天半工作制</h2><p></p><p></p><p>1 月 3 日，乐视 CEO 张巍发布了 2023 年致全体员工的一封信，名为《乐视，从来与众不同》。</p><p></p><p>全员信中，乐视宣布自 2023 年 1 月 1 日起，公司将执行每周四天半工作制，每周三实行弹性的半天工作制，考勤时间调整为连续 5 小时，如上午 10 点至下午 15 点、上午 11 点至下午 16 点都符合规定。</p><p>据潇湘晨报报道，乐视市场部的一名员工称，自去年7月起，乐视就已经提出这个制度了，这项决策并不是管理层的一时兴起，而是作为一项长期执行的制度。</p><p></p><p>而且最重要的是，实行 4 天半工作制并不会降薪。</p><p></p><p>乐视在公开信中表示，这项工作制有四点好处：</p><p></p><p></p><blockquote>1、有利于员工和家人及时就医。疫情让我们认识到健康的重要性，周三休息半天，员工不用请假可以更灵活安排自己和家人就诊，对自己负责，更是对家庭、对社会负责。2、有利于缓解“周一工作焦虑症”。大城市工作压力大，上下班路远时间长，很多人周末休息后因周一至周五要连续工作五天，一到周一便感到焦虑。周三休息半天，员工可以去跑跑步、健健身或进行其他娱乐活动，能有效缓解这种焦虑。3、有利于员工学习和提高专业技能。活到老学到老，工作不只是输出，更需要充电。对于想要提升自己的员工尤其是刚毕业的年轻员工，周三弹性工作能增加周二晚和周三晚学习时长，规避周未突击学习的弊端，有利于提高学历和备考各类专业证书。4、有利于提升家庭幸福感。对于已经组建家庭的员工，可以更好的平衡工作与家庭。如果家里有孩子，周三不需要请假就可以接送孩子上下学 ; 如果还没有孩子，那么也有利于提高员工生育率，拥护国家政策。</blockquote><p></p><p></p><p>一位半年前加入乐视的员工阿乐在接受燃次元采访时表示，他就是因为乐视没有 996 而选择加入的。他此前曾在杭州度过大半年的 996 高强度生活，在入职乐视后，他觉得找到了自己的生活，“做研发也可以准时下班，每周公司考虑到早高峰，还有 5 次补卡机会”。在实行 4 天半工作制的第一天，他下午 3 点就离开了公司。</p><p></p><p>这两年日益加剧的内卷文化也让身处其中的互联网人感到压力山大。2019 年从乐视离开的小白向燃次元表示“在乐视，内卷的人会被鄙视”，“没人卷工作时长，都是做本职工作。”</p><p></p><p>乐视这封公开信一出，便引起了极大的关注度。“4 天工作制要不要推行”， “全国推行 4 天半工作制可行吗”，“如果上 4 天班你会搞副业吗”等相关话题很快登上热搜，引发广泛讨论。在国内，“四天工作制”的呼声也很高涨，但要想短时间内并不容易实现。</p><p></p><p>乐视一直是网友眼里的神仙公司——“从不 996，下班即挂机”。去年 7 月，有微博网友发博称，乐视“还剩下 400 多人”，“没有内卷和 996，没拖欠过留下来的员工工资”。随后又有人爆料，靠着《甄嬛传》等影视版权收入和大楼出租租金，乐视的 400 名员工过着没有老板的神仙日子。</p><p></p><p>有网友调侃“房租和《甄嬛传》保住了公司的荣华富贵”。事实上，靠房租过活消息不实。去年 9 月乐视已搬离乐视大厦，原乐视大厦将由新业主接手。去年 4 月，乐视视频通过官方微博自我调侃，如果 2018 年《甄嬛传》版权没有被分销，乐视视频可以安心养老。</p><p></p><p></p><h3>全球规模最大的不降薪「四天工作制」试验</h3><p></p><p></p><p>类似的“四天工作制”制度，最初由美国开创。上世纪 70 年代，因为汽油价格猛涨，受困于石油危机，美国伯明翰市被迫考虑并推行每周 4 天工作制。最初的“四天工作制”并不是一周只工作四天，而是每周都有一天可以让员工做自己岗位职责之外的事情。</p><p></p><p>现在，世界上有一些国家，比如冰岛、新西兰、日本、西班牙等国家的部分企业已经推行一周 4 天工作制。</p><p></p><p>去年 6 月，全球规模最大的不降薪「四天工作制」试验在英国、美国、新西兰等地开展，为期 6 个月，有 70 多家公司和 3300 多名员工参加。</p><p></p><p>这项实验由非营利性组织 4 Day Week Global、剑桥大学、波士顿学院和都柏林大学的研究人员合作开展。参与公司在为期六个月的实验过程中采用 100-80-100 模式：员工在 80% 的时间里领取 100% 的工资，并保持 100% 的生产力。研究人员将衡量新工作模式对<a href=\"https://edition.cnn.com/2022/05/05/economy/us-productivity-first-quarter-2022/index.html\">生产力水平</a>\"、性别平等、环境以及工人薪资福利的影响。</p><p></p><p>在实验进入到半程之际。去年 9 月，组织者“全球四天工作制”(4 Day Week Global) 公布了调查结果：实施的试点计划——“四天工作制”是可行的。</p><p></p><p>4 Day Week Global 发布的一份调查显示，有 78% 的领导者表示目前已顺利实现了从五天到四天工作制的过渡，只有 2% 的公司认为它具有挑战性。还有 88% 的人认为，四天工作制是有效的。同时，也有大约五分之一的公司选择了退出。</p><p></p><p>试点公司的高管们表示，他们面临着双重挑战：一方面，要克服员工和行业内部的五天工作规范；另一方面，要积极改进工作流程，以便在四天内完成与五天一样多的产出。</p><p></p><p>一些参与实验的员工<a href=\"https://edition.cnn.com/2022/08/01/business/4-day-work-week-uk-trial/index.html\">表示</a>\"，他们感觉更快乐、更健康，并且在工作中做得更好。英格兰西南部一家慈善银行的贷款服务经理丽 Lisa Gilbert 将她的新日常工作描述为“惊人的”。“我现在真的可以享受我的周末了，因为我可以在周五做家务和处理其他琐碎的事情”。</p><p></p><p>不过，这种转变并非是一帆风顺的。伦敦公共关系机构 Unity 的常务董事 Samantha Losey 表示，第一周“真的很混乱”，她的团队没有为更短的工作交接做好准备。但她的团队很快找到了解决方法。现在，公司已禁止所有超过 5 分钟的内部会议，并将所有客户会议限制在 30 分钟以内。Losey 说，到第四周时，她的团队已经取得了进展。但她坦陈，如果在六个月的试验过程中 ，团队的生产力水平下降了， 她“绝对”有可能恢复五天的工作时间表。</p><p></p><p>新冠大流行 3 年以来，许多员工已经达到了<a href=\"https://edition.cnn.com/2022/03/30/economy/great-resignation-uk-australia-europe/index.html\">极限</a>\"。麦肯锡去年对全球 5,000 名员工进行的一项调查发现，近一半的人表示至少感到有些精疲力竭。Losey 说，她决定让 Unity 参与试点的一个主要原因是为了弥补员工在大流行最严重时期面临的“异常程度的倦怠”。</p><p></p><p>额外的一天为许多员工腾出了空间，让他们可以培养新的爱好，实现长期的抱负，或者可以在人际关系上投入更多时间。一些企业老板表示，参加试验的员工参加了烹饪班、钢琴班、志愿服务、钓鱼和轮滑等活动。</p><p></p><p>大多数员工都喜欢多给自己留出一天时间：他们将这种体验评为 9.1（满分 10 分），97% 的人表示他们希望继续紧凑的日程安排。他们自我报告的表现水平上升，而倦怠和疲劳下降。他们可以更好地控制自己的日程安排，每周还可以节省一个小时的通勤时间，尽管在整个实验期间，面对面的工作有所增加。</p><p></p><p>有网友观点认为，“五天工作周是 20 世纪的概念，不再适合 21 世纪。”</p><p></p><p>到去年 11 月底，项目进入尾声之时，参与企业决定是否坚持新的工作时间表。一些企业领导者表示他们愿意继续，因为业务没有受到影响。平均而言，企业将员工的日程安排减少了 6 个小时，从每位员工每周约 41 小时减少到 35 小时。在提供数据的企业中，企业报告整个实验期间的收入增长了 8%，比去年同期增长了 38%。</p><p></p><p>在试验结束时提供反馈的 27 家公司中，有 18 家表示他们肯定会继续每周工作 4 天的制度，7 家计划继续但尚未做出最终决定，1 家倾向于继续，1 家仍在考虑。</p><p></p><p>参考链接：</p><p>https://baijiahao.baidu.com/s?id=1754104286312243575&amp;wfr=spider&amp;for=pc</p><p>https://finance.sina.com.cn/tech/csj/2023-01-05/doc-imxzayir5711977.shtml</p><p><a href=\"https://mp.weixin.qq.com/s?__biz=MjM5NzM2MzI4MQ==&amp;mid=2652612313&amp;idx=4&amp;sn=9feae21385f411bfe1dd83507be8c12f&amp;chksm=bd342de78a43a4f17b0de3bc81e433f1695684b685faf63ee77cd44e5107768c78d37a32749c&amp;scene=21#wechat_redirect\">https://mp.weixin.qq.com/s?__biz=MjM5NzM2MzI4MQ==&amp;mid=2652612313&amp;idx=4&amp;sn=9</a>\"</p><p>https://www.cnbc.com/2022/12/09/us-4-day-workweek-trial-results-no-one-is-going-back-to-normal.html</p>",
    "publish_time": "2023-01-05 14:51:00",
    "source": {
      "name": "infoq_recommend",
      "desc": "InfoQ推荐",
      "icon": "https://raw.githubusercontent.com/maguowei/today/master/imgs/icon/infoq.png"
    }
  },
  {
    "title": "打造学习型企业，致胜数字化时代｜2022企业数字人才发展领航榜揭晓！",
    "url": "https://www.infoq.cn/article/lddQUeZBH9JyjZ6kELQK",
    "summary": "<p>回顾 2022，疫情带来的经济寒冬进入第三年，随着国家数字化蓝图的展开，越来越多的企业开始从数字化转型中谋求实现降本增效，提升盈利能力的机会。行业数字化变革蓬勃发展，数字人才的重要性也愈发凸显，人才数字化思维和能力缺乏，是数字化转型落地的首要困难，“数字化转型人才先行”已成为众多企业的数字化纲领。</p><p>&nbsp;</p><p>​随着数字化转型走深向实，数转企业全面开展数字化人才梯队建设，行业中涌现出大量数字人才培养优秀实践案例。在培训杂志的指导下，极客邦科技双数研究院与中国企业数字人才发展研究中心（培训杂志与极客邦科技共建），共同开展数字人才培养优秀案例的选拔，基于对 2022 年度极客时间合作企业的数字人才培养创新项目和运营效果的综合评议，最终从 3000 家企业中决出涵盖“数字人才培养先锋组织”、“自驱学习力典范”、“持续学习型组织”三个不同维度的标杆企业，由极客时间与 InfoQ 极客传媒联合发布“2022 年企业数字人才发展领航榜”。希望通过榜样的力量激发行业数字人才培养体系和标准搭建，筑牢数字人才基石，助力数字中国建设。</p><p><img src=\"https://static001.infoq.cn/resource/image/b0/2e/b083deea3a0004efb1060ffea4747d2e.jpg\" /></p><p></p>",
    "publish_time": "2023-01-05 15:09:00",
    "source": {
      "name": "infoq_recommend",
      "desc": "InfoQ推荐",
      "icon": "https://raw.githubusercontent.com/maguowei/today/master/imgs/icon/infoq.png"
    }
  },
  {
    "title": "汽车芯片成Arm增长发力点，分析师：汽车市场至关重要，目前还未分出胜负",
    "url": "https://www.infoq.cn/article/VFO6mFhtBuWIpkDNl3M4",
    "summary": "<p>据《金融时报》报道，自 2020 年以来，芯片设计公司 Arm 的汽车业务收入增长了一倍多，汽车业务也成了Arm 新的增长途径。</p><p>&nbsp;</p><p>Arm汽车市场副总裁Dennis Laudick表示，该细分市场的增长速度一直快于智能手机和数据中心等其他部门。该部门主要为从电气化到先进的驾驶员辅助系统（ADAS）和车载“信息娱乐”的一切提供动力。</p><p>&nbsp;</p><p>这是因为，现代汽车需要更多的芯片，这些芯片也比以往任何时候都更加昂贵。由于需求旺盛，汽车芯片是整个芯片行业中为数不多的、预计将在今年全年严重短缺的芯片之一。</p><p>&nbsp;</p><p>事实上，在 2022 年，<a href=\"https://www.infoq.cn/article/IIrxAaTj0zL0vmWeDqMl\">汽车芯片</a>\"就已出现短缺。</p><p>&nbsp;</p><p>半导体行业人士陈启在接受 InfoQ 采访时曾表示，2022 年需求旺盛的芯片产品主要集中在汽车电子类和新能源功率类，像高端的汽车所用到的各种车规级芯片，以及功率半导体方面的 IGBT、MOS 类产品一直有很好的需求。研究背后的本质原因可以发现，汽车电子类芯片壁垒较高，玩家较少，因此价格一直坚挺。特别是 IGBT 这种产品，由于汽车和新能源上都要用，呈现出“双轮驱动，量价齐升”的局面。</p><p>&nbsp;</p><p>此外，由于疫情催生出大量汽车消费需求，而随着需求从传统燃油车转向新能源汽车，车规芯片需求量大增。与消费级芯片相比，车规芯片安全性、可靠性要求更高，认证周期较长，并且短期内消费级芯片无法平移到车上。也因此，车规芯片在长时间内处于缺芯、高价阶段。</p><p>&nbsp;</p><p><a href=\"https://www.infoq.cn/article/ErbwGSrFJ4cFauGv5ys0\">Arm</a>\"发力汽车芯片后，营收迈上了新的台阶。数据显示，Arm 的总收入在 2022 年增长了 35%，达到 27 亿英镑。虽然Arm并未透露具体数字，但表示其汽车业务的收入在过去四年中增长了五倍。</p><p>&nbsp;</p><p>带来高收入的同时，汽车<a href=\"https://www.infoq.cn/article/uMkRA2sFBBmtzSLKO0TF\">芯片</a>\"业务也为Arm带来新的挑战。</p><p>&nbsp;</p><p>Dennis Laudick表示，“一款高端汽车所配备的软件系统，可以说是目前世界上最复杂的软件系统之一。它基本上就是轮子上的数据中心。”</p><p>&nbsp;</p><p>此外，Arm还面临来自英特尔、MIPS 和 Synopsys 等竞争对手的激烈竞争。D2D Advisory 分析师 Jay Goldberg 表示：“半导体行业在高速增长中一直表现良好，现在所有芯片公司都在追逐下一个高点。”“汽车市场至关重要，目前还没有人赢得这个市场。”</p>",
    "publish_time": "2023-01-05 15:56:20",
    "source": {
      "name": "infoq_recommend",
      "desc": "InfoQ推荐",
      "icon": "https://raw.githubusercontent.com/maguowei/today/master/imgs/icon/infoq.png"
    }
  },
  {
    "title": "音视频技术持续进击，直播互动场景会如何“进化”？",
    "url": "https://www.infoq.cn/article/QlsziKdTXqzhwruZhSW3",
    "summary": "<p>最近几年，音视频是一个非常热的技术话题。远程办公、线上娱乐的需求持续增加，元宇宙的概念也在被广泛讨论，在通信技术不断演进迭代的同时，带来了很多直播互动的新玩法、新形式。</p>\n<p>本次直播，InfoQ 与 ZEGO 即构科技 视频处理工程师李凯围绕音视频技术的突破、应用场景，以及实时互动 RTI 进行探讨。</p>",
    "publish_time": "2023-01-05 16:19:46",
    "source": {
      "name": "infoq_recommend",
      "desc": "InfoQ推荐",
      "icon": "https://raw.githubusercontent.com/maguowei/today/master/imgs/icon/infoq.png"
    }
  },
  {
    "title": "请查收你的新年礼物，InfoQ 内容中心 2022 私享书单",
    "url": "https://www.infoq.cn/article/Wg8tTqCMY1zDOabZQlpf",
    "summary": "<p>新年好，关注&nbsp;InfoQ&nbsp;的你，首先祝你新的一年诸事顺遂，遇见更好的自己。</p><p></p><p>2022&nbsp;年我们遇见了太多的混沌与不确定性，但还好有一件事毫无疑问：书籍始终是我们最忠实的朋友。无论通货膨胀的多厉害，读书这件事总是一本万利的。</p><p></p><p>所以在新年到来之际，InfoQ&nbsp;内容中心的每一个同学，都会将自己的私人爱书推荐给你，希望能帮你节省挑书选书的时间，也希望以书会友，交流我们之间的新发现、新思考、新感悟，所以如果在你的心中，也有一本&nbsp;2022&nbsp;最爱的书，欢迎在评论区分享给我们。</p><p></p><h1>书单推荐</h1><p></p><p></p><p>书名：《纳博科夫文学讲稿三种》</p><p></p><p>作者：弗拉基米尔·纳博科夫</p><p></p><p>出版社：上海译文出版社</p><p></p><p>推荐人：<a href=\"https://www.infoq.cn/u/knight/publish\">王一鹏</a>\"</p><p></p><p>推荐语：</p><p></p><p></p><blockquote>焦虑、躺平、松弛感，人们关注这些热词，与过分关注物质收益分配、沉溺理工思维主导的信息化时代，有着千丝万缕的联系。如果人们眼里只有数字，没有感性的文学、艺术之美，没有哲学的思辨，那么社会就一定会出现问题。恰好，文学、艺术向来又是高傲的，对美的欣赏是有门槛的，没有经过一位大师的训练，难以自学成才。而这或许就是《纳博科夫文学讲稿三种》存在于当今社会的现实意义。纳博科夫是少有的文学大师，他既是《洛丽塔》的作者，也是哈佛、康奈尔、斯坦福的客座教授，他对重要文学作品的讲解和分析，或许能帮你跨过认知鸿沟，重新认识并沉浸在一种古老的艺术形式里。千万别以为该系列图书是读起来令人昏昏欲睡的大学课件，恰好相反，讲稿行文虽有卖弄的嫌疑，但也称得上是旁征博引、慷慨陈词，自身就是文学之美的彰显。如果有一天，你既不是为了在主流价值评判体系下显得更上进，也不是为了升职加薪，而是单纯的像打开一部综艺一样打开一本书，那么我想，你已经收到了纳博科夫献给文坛的礼物。</blockquote><p></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/46/46269f76d8abe23becbbc03be74cbc43.jpeg\" /></p><p></p><p>书名：《思考，快与慢》</p><p></p><p>作者：丹尼尔·卡尼曼</p><p></p><p>出版社：中信出版社</p><p></p><p>推荐人：<a href=\"https://www.infoq.cn/profile/16655B089D4524/publish\">凌敏</a>\"</p><p></p><p>推荐语：</p><p></p><p></p><blockquote>这本书的作者丹尼尔·卡尼曼是诺贝尔经济学奖得主，他认为人的思考模式分为快思考和慢思考两个系统，快思考是指依赖直觉的、无意识的思考，慢思考则是指需要主动控制的、有意识进行的思考。人们以为能驾驭自己的思想，但实际上我们的每一个思考都会被看不见的因素影响着，很多时候，我们还会陷入思维陷阱里。</blockquote><p></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/8b/8bfb7d8695fc374c16016fd1307d2dd2.png\" /></p><p></p><p>书名：《外婆的道歉信》</p><p></p><p>作者：弗雷德里克·巴克</p><p></p><p>出版社：天津人民出版社</p><p></p><p>推荐人：<a href=\"https://www.infoq.cn/profile/F13709F72C8E46/publish\">褚杏娟</a>\"</p><p></p><p>推荐语：</p><p></p><p></p><blockquote>这本书里有个“活泼过头”的外婆：她带着七岁的外孙女爱莎夜闯动物园看猴子；用屎球打警察；开车时一边抽烟一边吃烤肉，用膝盖控制方向盘；给雪人穿衣服，让邻居误以为有人从阳台上跌下去；甚至在宜家偷黄色购物袋。关于外婆的每件事都让人既好气又好笑。或许你会觉得这个没正经的外婆简直太疯癫了，但她却是爱莎心中的超级英雄，因为为了外孙女她不惜与世界为敌。然而有一天，外婆因为癌症不幸去世了，留给了爱莎一项艰巨的任务——送道歉信。跟着爱莎的脚步，关于外婆以及更多古怪的邻居们的故事会逐渐展开，你会爱上这些平凡、有缺点、被命运伤害，但依然可爱的人。他们让你想起生活本身。</blockquote><p></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/7e/7e5adef2f95fcf64f1de65db1d22f16b.jpeg\" /></p><p></p><p>书名：《也许你该找个人聊聊》</p><p></p><p>作者：洛莉·戈特利布</p><p></p><p>出版社：果麦文化/上海文化出版社</p><p></p><p>推荐人：<a href=\"https://www.infoq.cn/u/caifangfang/publish\">蔡芳芳</a>\"</p><p></p><p>推荐语：</p><p></p><p></p><blockquote>本书以一位心理治疗师的视角，讲述了发生在心理治疗诊室中的一些故事。作者采用双线讲述的方式，其中一条线是她作为心理咨询师如何治疗病人的过程，另一条线则是她自己作为病人如何被疗愈的过程。书里没有任何高高在上的说教或艰深晦涩的理论，只有一个个直戳人心的故事，特别扎心，但也很动人，你可能会在其中获得情感共鸣。阅读这本书的旅程就像做了一场心灵SPA，让我放松了一点执念，学会把重心放回自己身上，专心做对自己有意义的事情。</blockquote><p></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/f6/f6187b0a80135d7bb65193145ef66ca8.png\" /></p><p></p><p>书名：《破绽：风口上的独角兽》</p><p></p><p>作者：陈歆磊、史颖波</p><p></p><p>出版社：中信出版社</p><p></p><p>推荐人：<a href=\"https://www.infoq.cn/profile/E5368BDB0F3A58/publish\">Tina</a>\"</p><p></p><p>推荐语：</p><p></p><p></p><blockquote>本书写于2018年下半年，于2019年3月出版，当时寒潮未至，正值互联网企业风头正盛时期。作者以敏锐的视角和新颖的思路，分析了小米、乐视、共享单车、新零售、网红等独角兽公司和新兴业态中的“破绽”。放到现在来看，作者的不少观点得到了印证，可谓是“互联网时代的盛世危言”。也正如图书简介中所言：光鲜的泡沫往往也是危险的泡沫。激情澎湃过后，风口上的泡沫终会露出破绽，如何在成功和热闹背后去发现破绽，这需要冷静的思考和分析。</blockquote><p></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/16/166e390b407daab7f51aff48c19b5040.png\" /></p><p></p><p>书名：《大地孤独闪光》</p><p></p><p>作者：李海鹏</p><p></p><p>出版社：南方日报出版社</p><p></p><p>推荐人：<a href=\"https://www.infoq.cn/profile/E8113DAB95C4DE/publish\">刘燕</a>\"</p><p></p><p>推荐语：</p><p></p><p></p><blockquote>本书汇聚了原南方周末高级记者李海鹏的精选特稿作品。作家慕容雪村说，李海鹏的文字在中国当代无出其右。李海鹏的作品，把文字之美发挥的淋漓尽致，你可以感受到优美的文字是如何在作者的指尖自然流淌。同时，这些作品的内涵又十分深刻，反映社会重大问题，富有现实意义，凸显了作者对人和事的深邃理解。李海鹏的特稿，为“光怪陆离纷纭复杂的今日中国留下了无双的写照”。透过这些文字，相信你可以更加读懂中国。</blockquote><p></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/f4/f4a29634d93ee2960d6dd567cb37a6aa.png\" /></p><p></p><p>书名：《纳瓦尔宝典》</p><p></p><p>作者：埃里克·乔根森</p><p></p><p>出版社：中信出版社</p><p></p><p>推荐人：金玉秀</p><p></p><p>推荐语：</p><p></p><p></p><blockquote>对于很多忙碌的职场人来说，这是一本非常适合随手翻看的书，它收集整理了硅谷知名天使投资人纳瓦尔的智慧箴言，随便从哪一页都可以读下去，都会有收获。这是一本关于财富、关于幸福的书，财富和幸福是人生的重要课题，却也是我们平时鲜少花时间思考的，虽然这本书只有200多页，但它的思考很厚重，值得我们在人生的不同时期反复翻看，每次都会有不同的体会，也值得分享给你身边的朋友，相信他们也会受益良多。</blockquote><p></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/0d/0dd7de2a2c69fd5ab404ca8840fca59b.png\" /></p><p></p><p>书名：《马克洛尔的奇遇与厄运》</p><p></p><p>作者：阿尔瓦罗·穆蒂斯</p><p></p><p>出版社：中信出版社</p><p></p><p>推荐人：刘德胜</p><p></p><p>推荐语：</p><p></p><p></p><blockquote>这本书是塞万提斯奖得主、哥伦比亚作家阿尔瓦罗·穆蒂斯最重要的作品，六年成书，中文世界首次系统引进。诗意的语言+“詹姆斯·邦德”式的讲故事的方式，讲述“瞭望员马克洛尔”的史诗人生，七部曲组成的英雄传奇，这七个故事彼此独立又相互关联，小说里的时间与人生像海浪一样奔涌往复，最后激荡成为壮观的个人史诗。</blockquote><p></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/a3/a332293393233a528f5937396ee99da6.png\" /></p><p></p><p>书名：《人间烟火：&nbsp;掩埋在历史里的日常与人生》</p><p></p><p>作者：赵冬梅</p><p></p><p>出版社：中信出版集团</p><p></p><p>推荐人：<a href=\"https://www.infoq.cn/profile/4DF22B36EA245A/publish\">Alice</a>\"</p><p></p><p>推荐语：</p><p></p><p></p><blockquote>汪曾祺曾说：“四方食事，不过一碗人间烟火。”人间烟火味，最抚世人心。这本书围绕衣食住行，以及衣食住行的主体——女人和男人。食部分比较有印象的是，生鱼片我们日常以为是日本菜，但其实在我国唐代就很盛行了。衣服部分的汉服，也不是我们印象中的宽袍大袖，华夏的衣冠一直是变化的，比如赵武灵王引进的“胡服”，宋人的衣物特别像鲜卑人。出行也不只是古装剧里的“策马扬鞭”，更多是驿站、关山、宦游人的辛酸泪。在对男子和女子的描述中，介绍了很多习俗，还原了当时的日常生活。食一碗《人间烟火》，饮几杯人生起落。历史中的个体虽然渺小，也都曾熠熠生辉。</blockquote><p></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/2c/2cbea7ee4b76e9ebd9ba75e4e4c10038.png\" /></p><p></p><p>书名：《午夜降临前抵达》</p><p></p><p>作者：刘子超</p><p></p><p>出版社：文汇出版社</p><p></p><p>推荐人：<a href=\"https://www.infoq.cn/profile/5380C3E21515FE/publish\">张雅文</a>\"</p><p></p><p>推荐语：</p><p></p><p></p><blockquote>如果你厌倦了打卡式旅行，那么这本书将提供给你一种全新的旅行方式——沿着历史与文明的印记前行。《午夜降临前抵达》记录了作者两次中欧旅行的经历，一次夏季，一次冬季。买书的时候会附送一张小地图，详细标注了作者的旅行路线。在阅读的时候，每读到一座城市，打开地图看看他的地理位置，有一种自己真的在旅行的感觉，很奇妙。中欧的地理位置非常特殊，他生存在历史的夹缝中。在帝国的斗争中，这片土地不断被撕扯、被重塑。然而，跟随作者的脚步，你会发现。哪怕饱经战争的摧残，哪怕城市被夷为平地，哪怕三分之一的人口因为战争失去生命或者流亡，重建的城市依旧抹不掉曾经历史的印记。没有人能拒绝一位会旅行、懂历史、有故事的朋友吧～在安静的午后或者是睡前，不妨翻开这本书。</blockquote><p></p><p></p><p><img src=\"https://static001.infoq.cn/resource/image/87/f7/87d059ca65cbc8c91bb6f2c847fe11f7.png\" /></p><p></p><p></p><p>书名：《额尔古纳河右岸》</p><p></p><p>作者：迟子建</p><p></p><p>出版社：人民文学出版社</p><p></p><p>推荐人：<a href=\"https://www.infoq.cn/profile/A1FD048785A6CC/publish\">任传英</a>\"</p><p></p><p>推荐语：</p><p></p><p></p><blockquote>这是一部描写鄂温克人生存现状及百年沧桑的长篇小说，展示了弱小民族在严酷的自然环境和现代文明的挤压下的顽强生命力和不屈不挠的民族精神，以及丰富多彩的民族性格和风情。作者以一位年届九旬的鄂温克族最后一位酋长女人的自述口吻讲述一个弱小民族顽强的百年命运抗争和平凡的生活。作者文笔细腻，语言通俗易懂，她没有用冗杂的道理去陈述“人和自然的和谐相处”、“大爱和宽容”的主题，也没有用晦涩的暗喻明讽来突出困难。对自然景色的描述中，运用大量的比喻和拟人的修辞，让人声临其境，浮想联翩。文中大量故事重复着喜悦与悲伤、失望与希望的转换，在生活挫折之时阅读尤能增加面对困难的勇气。</blockquote><p></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/21/2187783a00641e08e27ca20a36c40126.png\" /></p><p></p><p>书名：《我本芬芳》</p><p></p><p>作者：杨本芬</p><p></p><p>出版社：北京联合出版公司</p><p></p><p>推荐人：<a href=\"https://www.infoq.cn/profile/7592FCF81288CF/publish\">郑思宇</a>\"</p><p></p><p>推荐语：</p><p></p><p></p><blockquote>这是一本看完之后让人压抑的书。看到这本书觉得封面和书名有股悲凉感，果不其然，这本书一点都不“芬芳”，主人公把自己60年来的孤独、失落和委屈，浓缩到了这本巴掌大的小书里，从女性视角讲述了那个时代背景下的婚姻。封皮最后写的是：献给每一个不被看见的你我她，希望读到这本书的你，不用在落寞中绽放，拥有不必隐忍的权利。</blockquote><p></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/b7/b765a1d95f1a6951a56d9c0f0cbbf81e.png\" /></p><p></p><p>书名：《皮囊》</p><p></p><p>作者：蔡崇达</p><p></p><p>出版社：天津人民出版社</p><p></p><p>推荐人：<a href=\"https://www.infoq.cn/u/ludongxue/publish\">鲁冬雪</a>\"</p><p></p><p>推荐语：</p><p></p><p></p><blockquote>该书讲述一个名叫东石的福建渔业小镇的风土人情和时代变迁，记录了作者与故乡、家人、好友之间温情而又残酷的故事。作者虽以苦难为题材，但却是以超越困难、寻找与苦难和解、救赎心灵的方式来立意，整体基调虽忧伤但不颓废，文本中散发出一种明朗向上的精神力量。emo的时候，妄自菲薄的时候，读一读，找一下自己，很管用。（ps：这应该算是个散文集，有艺术加工，不爱看散文的可以忽略，但我觉得可读性挺高的。）</blockquote><p></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/2b/2ba79766c42ca47faa536146f301409b.png\" /></p><p></p><p>书名：《被讨厌的勇气》</p><p></p><p>作者：岸见一郎、古贺史健</p><p></p><p>出版社：机械工业出版社</p><p></p><p>推荐人：<a href=\"https://www.infoq.cn/u/junbao/publish\">张俊宝</a>\"</p><p></p><p>推荐语：</p><p></p><p></p><blockquote>可能有很多人看过，但还是值得推荐一下。人是所有社会关系的总和。决定我们自身的不是过去的经历，而是我们自己赋予经历的意义。希望你从这本书里能够得到一些正向的情感激励。</blockquote><p></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/5a/5a49d2acf641e0c7f639fab48f3852fb.jpeg\" /></p><p></p><p>书名：《悉达多》</p><p></p><p>作者：赫尔曼·黑塞</p><p></p><p>出版社：天津人民出版社</p><p></p><p>推荐人：<a href=\"https://www.infoq.cn/profile/3CF61DFD223E0E/publish\">付秋伟</a>\"</p><p></p><p>推荐语：</p><p></p><p></p><blockquote>这本书讲述的是佛陀的故事，但是同时它更是一本心灵救赎之书，2022&nbsp;是不确定的一年，我们可能遇到了各种各样的新问题、新麻烦，甚至给我们带来超乎过往的痛苦、迷茫、无奈、失落，就像书里的悉达多一样，从在婆罗门时的意气风发，到沙门的跌跌撞撞，乃至于后面坠入凡尘、迷失自我，期间也经历友情、品尝爱情、追逐名利，庆幸的是内心的阿特曼（信仰）一直都没有彻底消散，最终幡然醒悟，求得生命意义的圆融统一，看似宏大，却是每个人无法回避的问题。《悉达多》的副标题为一首印度的诗，风格上充满着诗歌的洒脱，同样也饱含着哲学和心理学的智慧，读《悉达多》能够让我们从凡尘俗世中暂时抽离出来，去体验一场属于佛陀的人生，酣畅淋漓之外同样发人深省。</blockquote><p></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/90/906725fcd4581f778350ba66ba2fdecf.png\" /></p><p></p><p>书名：《日瓦戈医生》</p><p></p><p>作者：鲍·帕斯捷尔纳克</p><p></p><p>出版社：天津人民出版社</p><p></p><p>推荐人：<a href=\"https://www.infoq.cn/u/kimmy/publish\">罗燕珊</a>\"</p><p></p><p>推荐语：</p><p></p><p></p><blockquote>《日瓦戈医生》是前苏联作家帕斯捷尔纳克于上世纪五十年代出版的一本长篇小说，通过主人公日瓦戈一生的经历反映俄罗斯社会从沙俄、苏俄、再到苏联时代的社会变迁。小说描写了前苏联十月革命前后多个重大历史与社会事件，包括1905年革命、一战、十月革命、苏俄内战、新经济政策等，以及不断变化的社会经济环境对人们传统价值观念和思维方式的冲击。推荐这部小说，是因为我们当下正生活在一个充满剧变的时代，无数的“黑天鹅”、“灰犀牛”、“疯狗浪”事件不断颠覆着我们对这个世界的认知，甚至颠覆着我们的价值体系。在这个充满不确定性的时代，也许我们可以以史为鉴，看一看作家帕斯捷尔纳克，以及他笔下的日瓦戈医生，是如何在兵荒马乱，山河破碎的大时代中坚守着自己的善良、良知、对美与自由的热爱。正如本书作家在其诗作中所写的那样：但行将就木的我，相信那样一个时辰：善的精神必将战胜，强大的卑鄙和怨恨。</blockquote><p></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/fc/fc94f4d70080a0c1efee5801826fc142.png\" /></p><p></p><p>书名：《生死疲劳》</p><p></p><p>作者：莫言</p><p></p><p>出版社：浙江文艺出版社</p><p></p><p>推荐人：<a href=\"https://www.infoq.cn/profile/07B1FEA2B7C7C4/publish\">高玉娴</a>\"</p><p></p><p>推荐语：</p><p></p><p></p><blockquote>莫言自称诺奖评委主要是因为看了这本书才把诺奖给了他。《生死疲劳》讲的是一个被冤杀的地主西门闹的六道轮回，一世为驴、二世为牛、三世为猪、四世为狗、五世为猴，看尽人性百态，一切恩怨消弭，最后终于再次转生为人。全书近50万字，看到根本停不下来，莫言用他幽默的笔触，荒诞又有趣的想象，直击灵魂深处。都说人生除了生死无大事，看过《生死疲劳》之后发现，原来生死也是小事。再多的苦大仇深、爱恨情仇，都可以交给时间。与自己和解、与他人和解、与万事和解，很多时候我们确实需要这样一场救赎。在那些痛苦瞬间、至暗时刻，不妨翻开一看。相信你也一定会笑出声来，获得内心深处的解脱。btw.新版附的人物关系图简直不要太友好。</blockquote><p></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/91/914de7adcf2537eb9b689826b751995f.jpeg\" /></p><p></p><p>书名：《山茶文具店》</p><p></p><p>作者：小川系</p><p></p><p>出版社：湖南文艺出版社</p><p></p><p>推荐人：姜昕蔚</p><p></p><p>推荐语：</p><p></p><p></p><blockquote>精神紧绷的日子久了，&nbsp;就希望能有一个安静的角落，能静静地待一会儿，看一本小书，疗愈一段惊涛骇浪的过往。如果你也在寻找一本治愈的小书，山茶文具店一定是这个元旦非常好的选择。这本书讲了一个日本古老的职业（代笔人）和她的客人的小故事。书很短，&nbsp;读起来完全不费力，但是却会给你很多平静的力量。</blockquote><p></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/89/894234ba4d01ba6117a4e53cb5c35a94.png\" /></p><p></p><p>书名：《最高职责》</p><p></p><p>作者：切斯利·萨伦伯格、杰夫·扎斯洛</p><p></p><p>出版社：北京联合出版公司</p><p></p><p>推荐人：崔白洁</p><p></p><p>推荐语：</p><p></p><p></p><blockquote>第一次知道萨利机长，是空中浩劫纪录片中简短的“Unable”、“Brace&nbsp;for&nbsp;Impace”。他面临重大危机也临危不乱，最终使双引擎熄火的飞机顺利迫降在哈德逊河，且机上155人全部幸免于难。在这本书中，你会看见一位经验丰富机长的成长史，以及整个事件机长视角的描述，本书同纪录片、萨利机长影片、采访与ATC的录音同时食用最佳。</blockquote><p></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/49/49c1b80e9690933f28c3b9d883f42f2b.png\" /></p><p></p><p>书名：《袭击面包店》</p><p></p><p>作者：村上春树</p><p></p><p>出版社：南海出版公司</p><p></p><p>推荐人：吴倩妮</p><p></p><p>推荐语：</p><p></p><p></p><blockquote>《袭击面包店》分为《袭击面包店》和《再袭面包店》两篇。在一种没由来的饥饿感的驱使下，主人公袭击了面包店。时隔十年后主人公已经成家，但又一次被这种饥饿感困扰，于是袭击麦当劳。用荒诞的情节描述了不同思想潮流的冲击与时代洪流中”人“的处境。</blockquote><p></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/4e/4e0516583f56a97b4d9c6077d822561f.png\" /></p><p></p><p>书名：《爱生活，不爱也行：日常哲学提案》</p><p></p><p>作者：热拉尔迪娜·莫斯纳-萨瓦</p><p></p><p>出版社：北京日报出版社</p><p></p><p>推荐人：李佳</p><p></p><p>推荐语：</p><p></p><p></p><blockquote>这几年我们深刻体验了所谓的无常是有偿，肯定有那么一些瞬间，你心中有这样那样的问题，或者憋屈，或者愤怒，或者激动，或者失望……零零总总的情绪难以处理，这个时候，哲学或许是一把钥匙。但是哲学啊，会不会太难，太虚，太难以理解。咦，这本小书来得恰到好处。打开目录，找到感兴趣的题目，随便翻过去看几眼，居然总能看到不一样的视角，获得一种开朗的能量。</blockquote><p></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/66/667e70fd76dd4da766d6a1f805aca08f.png\" /></p><p>相关阅读：</p><p><a href=\"https://xie.infoq.cn/article/53a62477b6b0976d3903e3c8e\">这里有一份 Java 程序员的珍藏书单，请您注意查收</a>\"</p><p><a href=\"http://mp.weixin.qq.com/s?__biz=MjM5ODQ2MDIyMA==&amp;mid=200313619&amp;idx=1&amp;sn=d662b5fa6646fd6201a0d58eb70cf544&amp;chksm=28ce45401fb9cc56971a968ac14bb7ac6fd88123393247bd627158d902cba98269d75fabdb7c&amp;scene=27#wechat_redirect\">推荐书单第一季</a>\"</p><p><a href=\"http://mp.weixin.qq.com/s?__biz=MjM5ODQ2MDIyMA==&amp;mid=200329578&amp;idx=1&amp;sn=80ed0ebd3aedfc118a1e5a79709ba413&amp;chksm=28ce07391fb98e2f038c86a890296c609c699409266488039853725d37a2bfb2faf60765856e&amp;scene=27#wechat_redirect\">推荐书单第二季</a>\"</p>",
    "publish_time": "2023-01-05 16:21:30",
    "source": {
      "name": "infoq_recommend",
      "desc": "InfoQ推荐",
      "icon": "https://raw.githubusercontent.com/maguowei/today/master/imgs/icon/infoq.png"
    }
  },
  {
    "title": "数据库内核杂谈（二十五）- 数据湖前世今生",
    "url": "https://www.infoq.cn/article/zgcYo1o62QXeWDdUhE8Q",
    "summary": "<p>欢迎阅读新一期的<a href=\"https://www.infoq.cn/theme/46\">数据库内核杂谈</a>\"。再次和大家道歉，拖更太久了，工作忙，然后出差，然后就阳了，恢复花了好久时间。一言难尽的2022年结束了，希望2023年能够善待我们（虽然，2022年初的时候，我也这么说）。数据湖(data lake)这个概念提出已经有了一段时间，各个大数据公司，或者技术厂商都有推出过自家的数据湖产品，比如DataBricks的Delta Lake，Uber开源的Apache Hudi以及Netflix开源的Apache Iceberg。一直想写一篇关于数据湖的文章。但，总觉得自己的理解和思考不深，可以学习和阅读的材料也不多。前阵子，读了不少博客，也阅读了Databricks关于数据湖的技术论文：Delta Lake：High-Performance ACID Table Storage over Cloud Object Stores。这一期，我们尝试着来聊一下数据湖。</p><p></p><h2>为什么需要数据湖？</h2><p></p><p></p><p>第一个问题依然是Why。为什么需要数据湖？数据湖要真正解决的问题是什么？我自己的理解就是，一套数据系统解决在线和离线数据统一查询的问题。</p><p>&nbsp;</p><p>我们都知道， hdfs, hadoop系统，让处理海量数据成为可能。但数据主要是以离线的形式呈现：批量导入数据，且历史数据不会被改动，新数据会周期性地新增（比如，按天级）。而这种形式带来的问题也显而易见，就是，不支持对及时更新的数据的查询。当然，我们也需要辩证地去思考这个问题。业务逻辑是否需要最新的数据。对于一些离线的报表，统计业务，T+1的延时已经完全能满足要求（在很多情况下，我也会和团队的同学去讨论，我们的业务是否需要小时级别的数据同步，往往答案是否定的）。</p><p>&nbsp;</p><p>在数据湖之前，其他系统是如何解决这个问题的。答案就是Lambda架构和Kappa架构。</p><p></p><h2>Lambda 架构介绍</h2><p></p><p></p><p>Lambda架构最早被提出是Nathan Mars发表于2013年的一篇博客，名为\"How to beat the CAP theorem\"，在文中Lambda架构被指为\"离线（batch）和在线（realtime）架构的结合：Lambda架构是一个数据处理和服务架构，通过协同并利用好离线和实时处理子系统来处理海量数据。Lambda架构通过使用离线子系统来计算出完整正确的离线数据，使用实时子系统来处理在线数据，并结合两者的结果，以此来平衡返回延时，吞吐量，以及容错率。Lambda架构的出现旨在通过实时数据处理解决大数据系统中MapReduce的延迟较高的问题。</p><p></p><h3>离线计算引擎（Batch Layer）</h3><p></p><p></p><p>离线计算引擎通常使用大规模计算引擎，离线处理并计算好结果（precompute）。离线计算引擎的好处在于，对于结果不追求时效性，比如T+1事件计算好即可。但同时由于计算的时候，离线计算引擎可以读取某个时间点（snapshot）内的所有数据，因此数据的准确性有保障（理论上是100%正确）。计算的结果通常会写到一个只读（read-only）的数据库里面。如果需要更新，也是完全覆盖旧的结果。</p><p>&nbsp;</p><p>2014年，开源的Hadoop（hdfs/mapreduce）被认为是一个具有代表性且应用广泛的离线计算引擎。这之后，一些其他的数据库系统比如Snowflake，Redshift，或者Big Query也被广泛使用。</p><p>&nbsp;</p><p></p><h3>实时处理引擎（Speed Layer）</h3><p></p><p></p><p>实时处理引擎，通常使用流式计算来处理数据，并不强求数据的完整性和正确性。它通过流式引擎来处理最实时的数据，以牺牲整体数据吞吐量的方式来进一步减少实时数据查询的延时。实时处理引擎是用来弥补离线引擎对于新数据的缺失。从数据正确性上来看，实时引擎不可能比肩离线引擎，但从时效性上来看，实时引擎几乎可以在读取到最新数据的同时（秒甚至毫秒级别）给出查询结果。</p><p>&nbsp;</p><p>常见的实时处理引擎有Amazon Kinesis，Apache Storm，Apache Samza，Apache Spark Streaming等。</p><p></p><h3>服务层（Serving Layer）</h3><p></p><p></p><p>服务层通常存储了离线和实时处理引擎处理后的数据结果，然后根据查询请求来决定是否直接返回离线结果，或者直接返回在线结果还是需要结合离线和实时数据，行程一个joint view，然后再返回。</p><p>&nbsp;</p><p>下图给出了Lambda架构示例：</p><p><img src=\"https://static001.geekbang.org/infoq/1f/1f956243e59480d2b74b33e16faa399a.png\" /></p><p></p><p></p><h2>Kappa 架构</h2><p></p><p></p><p>介绍完了Lambda架构，不知道大家是否发现了Lambda架构不好，或者说不优雅的地方。我引用一下Jay Kreps在2014年的一篇博客\"<a href=\"https://www.oreilly.com/radar/questioning-the-lambda-architecture/\">Questioning the Lambda Architecture</a>\"\"中的一句话\"The problem with the Lambda Architecture is that maintaining code that needs to produce the same result in two complex distributed systemsis painful and easily get wrong. \"。翻译过来就是指，离线引擎和在线引擎对于数据处理的逻辑是一致的，但Lambda架构需要维护两套代码在不同的引擎上（由于技术栈的不同）。</p><p>&nbsp;</p><p>也因此，Jay在博客中提出了Kappa架构。Kappa架构的主旨就是，既然在线处理引擎已经要做一次数据处理，是否可以提升在线引擎的吞吐量，把离线的任务也都交给它。下图给出了Kaapa架构的示意图：</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/a5/a55e02d265b2c7d9c49bd65fe776d5c3.png\" /></p><p></p><p>只用在线引擎来做数据处理，对于离线request，可以做好预处理存储起来，直接返回结果（可以利用hdfs来存储预处理的结果，但只作为serving layer），也可以重新feed原始的数据流来到在线引擎来支持新的计算。</p><p>&nbsp;</p><p>说一些我个人的理解，Kappa主打一套系统rule them all。但在线处理引擎，或者流式处理系统相对于离线系统还是有局限性的，比如功能不完善，特别是做一些需要复杂join的情形。第二，重新feed原始数据流来做计算并不是一个高效的实现方式。现实系统的演进也说明了问题，如果Kappa真的fit所有的用例，那也不会持续有新的NewSql，或者数据湖这类技术的持续改进。</p><p>&nbsp;</p><p>稍微总结一下， Lambda架构，是用两套系统来解决这个问题；Kappa架构是希望用流式系统解决，但并没有很好地解决这个问题。那数据湖又是如何去解决数据统一的问题呢？咱们围绕Delta lake这篇论文来讨论。</p><p></p><h2>使用对象存储作为存储介质</h2><p></p><p></p><p>Delta lake文中讨论的第一个观点就是，使用对象存储（比如S3，Ceph）作为存储介质。Hadoop或者Spark的存储系统一般都是HDFS。通常情况下，HDFS和Hadoop或者Spark是部署在相同的计算节点上的。因为HDFS重存储，而MapReduce或者Spark重计算（memory, CPU）。部署在一起的好处是，可以最大化地利用data locality来做移动计算。</p><p>&nbsp;</p><p>而数据湖架构，推荐使用对象存储作为存储介质。 原因如下：1）更贴近云原生。云厂商通常提供了超大规模，稳定，且性价比很高的对象存储服务。2）统一了结构化和非结构化的存储，非结构化的数据本来就会使用对象存储。3）更好地支持存算分离。 数据存储完全交给对象存储，计算就可以通过弹性资源来更好地scale，同时，也更符合云原生的概念。</p><p>&nbsp;</p><p>当然对象存储也面临一些问题。文中也梳理了一下：1）对象存储通常提供了key-value形式的access pattern，但不具备文件系统的很多功能。虽然key的命名可以去匹配directory的命名法则，且大部分的对象存储也支持list操作，但这些文件并不是物理存储在一个文件夹下，导致list操作并不是很高效（通常需要十几到几百毫秒），甚至有return数的限制（S3的list操作限制return 1000个key）。2）并不是强一致性：这也是对象存储性质决定的。当有新文件被创建时，list操作并不能保证会返回这个新文件。</p><p>&nbsp;</p><p>文章在介绍Delta lake技术方案之前，讨论了现有数据系统是如何基于对象存储做数据存储。</p><p></p><h3>directories of files</h3><p></p><p></p><p>这个方法和使用hdfs存储数据完全一致，数据以文件和文件夹的形式存在，只是将介质换到了对象存储。文件夹的构造通过通过命名规则来实现。比如</p><p>&nbsp;</p><p>namespace1/table1/partition1/<a href=\"http://1.data/\">1.data</a>\"</p><p>namespace1/table1/partition1/<a href=\"http://2.data/\">2.data</a>\"</p><p>namespace1/table1/partition2/<a href=\"http://1.data/\">1.data</a>\"</p><p>...</p><p>&nbsp;</p><p>这种方法的优势在于，实现非常简单，所有的信息都存储在对象存储上。数据引擎可以以很小的代价从支持hdfs读取到支持对象存储读取。并且，其他数据工具，在不需要额外工作的情况下（只要知道存储命名规则），也可以读写数据。劣势依然逃不开性能和一致性的问题。</p><p>&nbsp;</p><p></p><h3>custom storage engines（自研元数据管理中心）</h3><p></p><p></p><p>另一种方法（文中介绍了Snowflake），就是使用对象存储来存储数据文件，但通过自研的元数据管理中心来管理数据文件到表，namespace的映射。我个人其实是比较倾向这种设计的，用正确的技术做正确的事嘛。文中也提到了这类方法的挑战。1）需要额外的研发资源来建造这个元数据管理中心，2）所有对数据的读写都需要和这个元数据中心做交互，使得这个元数据中心要做到高性能，强一致，且始终在线。这是一个不小的挑战。3）source of truth都存储在这个元数据中心里，使得这个数据系统相对而言更闭源，其他数据系统接入的成本也会更高。</p><p></p><h2>Delta lake存储格式介绍</h2><p></p><p></p><p>比较了上述两种管理方式，来看Delta lake是如何实现对数据的管理。原理也挺容易想到的，就是对现有两种方法的结合：除了存储数据文件，也将数据的变更操作（log）存储在对象存储中。下图给出了示意：</p><p><img src=\"https://static001.geekbang.org/infoq/b4/b457f21d695eb0faa2151c1d2651333d.png\" /></p><p></p><p>除了数据文件，每个表会有一个单独的_delta_log的子目录，里面会记录数据变更的操作（虽然Apache Iceberg不在本文的介绍中，但我读过相关的blog以及Apache Iceberg的spec，方法是类似的）。</p><p>&nbsp;</p><p>log文件夹下存储着序列号递增的log文件，顺序记录着数据管理的操作。在某些情况下，也会有checkpoint的log文件存在（这些checkpoint log文件以parquet format存储，相当于snapshot，用来合并前面log的操作来提升读取性能）。每个log文件，记录着从上一个版本的数据，到这个版本的数据要做哪些操作。常见的操作有：</p><p>元数据改变(change metadata)： 比如schema 改变，或者partition column改变。数据文件改变（Add or Remove files）：记录着对于一个表数据，有新的数据文件生成，或者旧的数据文件删除。协议改变（protocol evolution）：主要用于明示系统目前使用的是哪个版本的Delta table protocol。</p><p>&nbsp;</p><p>文中也介绍了一些关于log读取的优化操作，除了已经介绍过的checkpoint文件，在log里也会存储一个_last_checkpoint的文件用来告诉系统最新的checkpoint的version是哪一个，方便快速读取而不用list所有的log文件后再做判断。</p><p>&nbsp;</p><p>介绍了log的存储格式，再来看如何支持数据读写操作。这边以读取最新版本的数据为例。</p><p>读取_last_checkpoint（如果存在的话），找到最新的checkpoint的版本号。以这个版本号为start-key（如果没有，就是0），读取大于这个版本号的json-log或者checkpoint parquet文件（这边为什么还需要读取checkpoint，主要原因也是因为系统没有强一致保障，不能保证_last_checkpoint里存储的就是最新的checkpoint）。用最新的checkpoint文件加上后续的log文件来获得当前数据表的最新元数据，包括schema信息，数据文件信息，statistics等等。根据上面获得的信息，结合query，读取相应的数据文件。</p><p>&nbsp;</p><p>写操作则如下：</p><p>获取数据表最新的元数据信息，这个操作和读操作里面的1，2，3步一致。如果是数据更新操作，将新的数据文件写到data folder里面。假如目前版本是n，尝试创建n+1.json，并将元数据改变的操作写入这个文件。判断是否需要创建一个新的checkpoint log（目前的判断逻辑是每10个版本创建一个checkpoint），如果需要，将最新的元数据信息写入checkpoint，并更新_last_checkpoint文件。</p><p>&nbsp;</p><p>细心的读者会发现写操作的第三步，创建n+1.json需要原子操作，但并不是所有的对象存储都支持原子操作。文中介绍了，Google Cloud Storage和Azure Blob Store都支持原子的put-if-abscent操作，因此可以直接使用，但如果是AWS S3，需要配合DataBricks的轻量级的coordination service来保证原子操作。</p><p>&nbsp;</p><p>介绍完了实现，文中也梳理了一些Delta lake的属性：</p><p>TPS支持：考虑到对象存储的写入性能，可以预料其实transaction per second （TPS）不会特别高，可能也就是每秒个位数的transaction级别。文中也写到了可以通过batch操作来减少TPS，并表示，目前的TPS可以满足绝大部分usecase的需求。支持time travel query 和 rollbacks: 由于保留了全部的log记录，Delta lake的表可以很好地支持time travel查询和rollback操作。支持update, delete, merge等数据操作：理由同上。Schema evolution and enforcement支持：理由同上。</p><p></p><h2>总结</h2><p></p><p></p><p>本期内容，结合DataBricks发表的介绍他们数据湖产品Delta Lake的论文，我们讨论了为什么需要数据湖架构，并学习了Delta Lake的数据湖的一些细节。说一些我自己不成熟的想法：数据湖相比原先的Lambda架构，通过log手段加入了对数据更新的支持，希望通过一套数据管理系统支持所有业务。但从目前的实现来看，实现上还是有很多限制，对于实时性非常高的应用场景，数据湖并不能满足。感谢阅读！</p><p></p><p>相关阅读：</p><p><a href=\"https://www.infoq.cn/article/mtyRVkfZ9dQNcqlslfJe\">数据库内核杂谈 (二十二) 自动驾驶数据库 - Behavior Modeling</a>\"</p><p><a href=\"https://www.infoq.cn/article/clOUD2iRFTk7NUaPcb3J\">数据库内核杂谈（二十三）- Hologres，支持 Hybrid serving/analytical Processing 的数据引擎</a>\"</p><p><a href=\"https://www.infoq.cn/article/65zC4wl1zoDko1GRvQFS\">数据库内核杂谈（二十四）- Hologres，支持 Hybrid serving/analytical Processing 的数据引擎</a>\"</p><p></p>",
    "publish_time": "2023-01-05 17:52:30",
    "source": {
      "name": "infoq_recommend",
      "desc": "InfoQ推荐",
      "icon": "https://raw.githubusercontent.com/maguowei/today/master/imgs/icon/infoq.png"
    }
  }
]