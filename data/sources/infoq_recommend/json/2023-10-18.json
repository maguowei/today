[
  {
    "title": "每日24亿事件处理：Airbnb的Riverbed技术解析",
    "url": "https://www.infoq.cn/article/BAFdDgo3MvJXau26mURs",
    "summary": "<p>Airbnb<a href=\"https://medium.com/airbnb-engineering/riverbed-optimizing-data-access-at-airbnbs-scale-c37ecf6456d9?accessToken=eyJhbGciOiJIUzI1NiIsImtpZCI6ImRlZmF1bHQiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE2OTc0MjIyNjIsImZpbGVHVUlEIjoibG9xZU1wOE55TUM0ODJxbiIsImlhdCI6MTY5NzQyMTk2MiwiaXNzIjoidXBsb2FkZXJfYWNjZXNzX3Jlc291cmNlIiwidXNlcklkIjo2MjMyOH0.IhskYNPEbAyCQZqGb3pvdnAXhoTNzCRd5Hg1e-O0mJw\">开发的Riverbed是一个Lambda风格的数据框架</a>\"，用于生成和管理分布式物化视图。该框架支持50多个涉及重度数据读取的应用场景，在这些场景中，数据来自Airbnb面向服务架构(SOA)平台的多个数据源。它分别使用Apache Kafka和Apache Spark作为在线和离线处理组件。</p><p></p><p>Airbnb观察发现，一些跨多个不同数据存储的复杂查询是导致该平台主要功能出现延迟的罪魁祸首。开发团队不能使用数据库提供的标准的物化视图，因为计算物化视图所需的数据不在单个数据库中。</p><p></p><p>开发团队尝试使用一种技术来创建分布式物化视图，该技术使用了<a href=\"https://en.wikipedia.org/wiki/Change_data_capture?accessToken=eyJhbGciOiJIUzI1NiIsImtpZCI6ImRlZmF1bHQiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE2OTc0MjIyNjIsImZpbGVHVUlEIjoibG9xZU1wOE55TUM0ODJxbiIsImlhdCI6MTY5NzQyMTk2MiwiaXNzIjoidXBsb2FkZXJfYWNjZXNzX3Jlc291cmNlIiwidXNlcklkIjo2MjMyOH0.IhskYNPEbAyCQZqGb3pvdnAXhoTNzCRd5Hg1e-O0mJw\">变更数据捕获(CDC)</a>\"、流处理和专门用来存储最终结果的数据库。他们仔细权衡了数据处理架构：</p><p></p><p></p><blockquote>Lambda和Kappa是两种实时数据处理架构。Lambda结合了批处理和实时处理，可以有效地处理大数据量，而Kappa仅专注于流处理。Kappa的简单性提供了更好的可维护性，但在实现回填机制和确保数据一致性方面存在挑战，特别是对于乱序事件。</blockquote><p></p><p></p><p>Riverbed框架采用了Lambda架构，并提供了一种声明式的方式，使用<a href=\"https://graphql.org/?accessToken=eyJhbGciOiJIUzI1NiIsImtpZCI6ImRlZmF1bHQiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE2OTc0MjIyNjIsImZpbGVHVUlEIjoibG9xZU1wOE55TUM0ODJxbiIsImlhdCI6MTY5NzQyMTk2MiwiaXNzIjoidXBsb2FkZXJfYWNjZXNzX3Jlc291cmNlIiwidXNlcklkIjo2MjMyOH0.IhskYNPEbAyCQZqGb3pvdnAXhoTNzCRd5Hg1e-O0mJw\">GraphQL</a>\"为在线(实时事件)和离线(数据回填)组件定义数据查询和计算逻辑。该框架负责并发、版本控制和数据正确性保证，以及与基础设施组件的集成。</p><p></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/67/67de98fae92e9d47e49582679bc2bf5a.webp\" /></p><p></p><p>Riverbed的流式处理(来源：<a href=\"https://medium.com/airbnb-engineering/riverbed-optimizing-data-access-at-airbnbs-scale-c37ecf6456d9?accessToken=eyJhbGciOiJIUzI1NiIsImtpZCI6ImRlZmF1bHQiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE2OTc0MjIyNjIsImZpbGVHVUlEIjoibG9xZU1wOE55TUM0ODJxbiIsImlhdCI6MTY5NzQyMTk2MiwiaXNzIjoidXBsb2FkZXJfYWNjZXNzX3Jlc291cmNlIiwidXNlcklkIjo2MjMyOH0.IhskYNPEbAyCQZqGb3pvdnAXhoTNzCRd5Hg1e-O0mJw\">Airbnb工程博客</a>\")</p><p></p><p>对于实时处理，Riverbed使用<a href=\"https://kafka.apache.org/?accessToken=eyJhbGciOiJIUzI1NiIsImtpZCI6ImRlZmF1bHQiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE2OTc0MjIyNjIsImZpbGVHVUlEIjoibG9xZU1wOE55TUM0ODJxbiIsImlhdCI6MTY5NzQyMTk2MiwiaXNzIjoidXBsb2FkZXJfYWNjZXNzX3Jlc291cmNlIiwidXNlcklkIjo2MjMyOH0.IhskYNPEbAyCQZqGb3pvdnAXhoTNzCRd5Hg1e-O0mJw\">Apache Kafka</a>\"消费数据源发出的变更数据捕获(CDC)事件来进行消息传递。来自CDC的事件通过执行用GraphQL定义的聚合逻辑来更新物化视图，结果文档存储在物化视图数据库中。为了提高效率，处理是高度并行化和批量化的。</p><p></p><p>流式管道避免了竞态条件，因为CDC事件在Apache Kafka中基于物化视图文档的标识符被重新分区，因此对物化视图的更新是顺序完成的。此外，在在线(实时)和离线(批处理)处理之间使用<a href=\"https://en.wikipedia.org/wiki/Optimistic_concurrency_control?accessToken=eyJhbGciOiJIUzI1NiIsImtpZCI6ImRlZmF1bHQiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE2OTc0MjIyNjIsImZpbGVHVUlEIjoibG9xZU1wOE55TUM0ODJxbiIsImlhdCI6MTY5NzQyMTk2MiwiaXNzIjoidXBsb2FkZXJfYWNjZXNzX3Jlc291cmNlIiwidXNlcklkIjo2MjMyOH0.IhskYNPEbAyCQZqGb3pvdnAXhoTNzCRd5Hg1e-O0mJw\">乐观并发控制</a>\"来避免并发写和潜在的数据不一致。</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/3d/3d357ce78cf5a04a9b086e7e0be8d00a.webp\" /></p><p></p><p>Riverbed的批处理(来源：<a href=\"https://medium.com/airbnb-engineering/riverbed-optimizing-data-access-at-airbnbs-scale-c37ecf6456d9?accessToken=eyJhbGciOiJIUzI1NiIsImtpZCI6ImRlZmF1bHQiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE2OTc0MjIyNjIsImZpbGVHVUlEIjoibG9xZU1wOE55TUM0ODJxbiIsImlhdCI6MTY5NzQyMTk2MiwiaXNzIjoidXBsb2FkZXJfYWNjZXNzX3Jlc291cmNlIiwidXNlcklkIjo2MjMyOH0.IhskYNPEbAyCQZqGb3pvdnAXhoTNzCRd5Hg1e-O0mJw\">Airbnb工程博客</a>\")</p><p></p><p>Riverbed支持数据回填和协调，以防出现因丢失CDC事件导致的实时处理问题。这一部分使用<a href=\"https://spark.apache.org/?accessToken=eyJhbGciOiJIUzI1NiIsImtpZCI6ImRlZmF1bHQiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE2OTc0MjIyNjIsImZpbGVHVUlEIjoibG9xZU1wOE55TUM0ODJxbiIsImlhdCI6MTY5NzQyMTk2MiwiaXNzIjoidXBsb2FkZXJfYWNjZXNzX3Jlc291cmNlIiwidXNlcklkIjo2MjMyOH0.IhskYNPEbAyCQZqGb3pvdnAXhoTNzCRd5Hg1e-O0mJw\">Apache Spark</a>\"来处理存储每日快照的数据仓库中的数据。该框架基于在Riverbed中配置的GraphQL定义生成<a href=\"https://spark.apache.org/sql/?accessToken=eyJhbGciOiJIUzI1NiIsImtpZCI6ImRlZmF1bHQiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE2OTc0MjIyNjIsImZpbGVHVUlEIjoibG9xZU1wOE55TUM0ODJxbiIsImlhdCI6MTY5NzQyMTk2MiwiaXNzIjoidXBsb2FkZXJfYWNjZXNzX3Jlc291cmNlIiwidXNlcklkIjo2MjMyOH0.IhskYNPEbAyCQZqGb3pvdnAXhoTNzCRd5Hg1e-O0mJw\">Spark SQL</a>\"。</p><p></p><p>Riverbed目前每天处理24亿个事件，写入3.5亿个文档，处理与Airbnb的支付、搜索、评论、行程和内部产品等功能相关的50多个物化视图。</p><p></p><p></p><p>原文链接：</p><p><a href=\"https://www.infoq.com/news/2023/10/airbnb-riverbed-introduction/\">https://www.infoq.com/news/2023/10/airbnb-riverbed-introduction/</a>\"</p>",
    "publish_time": "2023-10-18 08:00:00",
    "source": {
      "name": "infoq_recommend",
      "desc": "InfoQ推荐",
      "icon": "https://raw.githubusercontent.com/maguowei/today/master/imgs/icon/infoq.png"
    }
  }
]