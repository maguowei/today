[
  {
    "title": "“TDD就是死亡”？我要为单元测试辩护",
    "url": "https://www.infoq.cn/article/Brwh11Pqd6Oa2T8VBpC2",
    "summary": "<p>在2014年的时候，<a href=\"https://dhh.dk/\">David Heinemeier Hansson</a>\"在软件开发界引起了轩然大波。他在<a href=\"https://youtu.be/9LfmrkyP81M\">RailsConf</a>\"的台上公然宣布“<a href=\"https://TDD is Death\">TDD就是死亡</a>\"”。</p><p>&nbsp;</p><p>这是个大胆的举动，但他也成为了很多不满于测试的人所寻找的领头人。很多人选择了跟随，开发者们就此分成了两个阵营。</p><p>&nbsp;</p><p>当时所掀起的新浪潮一路带我们到了今天，单元测试不再重要，集成测试占据上风。Mike Cohn所提出的著名测试金字塔如今被重塑为菱形形状。推动这股浪潮的因素并不唯一，在对现有测试实践不满的背后，或许并不难找到许多原因。</p><p>&nbsp;</p><p>这种情况常常伴随固化的实践传播、缺乏的正确指导，以及沉溺的抽象思维出现。人人都试图做到最好，不断尝试、失败，再尝试，直到有人能打破锁链，开拓不同的道路，一条承诺通往低维护性测试套组的道路。</p><p>&nbsp;</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/db/db8a8ffba8339f72ef138754c5a44898.png\" /></p><p></p><p>&nbsp;</p><p></p><h2>什么是最好的方向？</h2><p></p><p></p><p>即使是在新领域，我们也很容易遗忘历史，这是我在这个行业中所学到的事。飞速发展的步伐让我们相信过去没有答案，而未来充满奇迹。我不知道未来会如何，但我相信我们总会倾向于追寻创新而非寻找信息。</p><p>&nbsp;</p><p>或许下面这些问题能让很多质疑用测试菱形替代金字塔的声音：</p><p>问题是由单元测试或单元测试编写所引起的吗？集成测试是否应用于需要的组件？我的误解是否导致了多处相同的断言？我是通过测试优化设计，还是围绕现有设计进行测试？</p><p>&nbsp;</p><p>&nbsp;</p><p></p><h2>寻根&nbsp;&nbsp;</h2><p></p><p></p><p>答案或许又一次藏在了过去。</p><p>&nbsp;</p><p>那么在集成测试上，历史能告诉我们什么呢？历史中，集成测试是不同开发单元一同测试的阶段。这些单元独立开发，且通常来自不同团队。在这一阶段，我们要确保的是所有接口的实现和运行正常。</p><p>&nbsp;</p><p>如今的集成测试常常用于同一团队所开发的代码单元，这就意味着每个源码文件都是一个系统边界，相当于每个代码文件都是由同一个自主团队开发一样，模糊了单元测试和集成测试之间的界限。</p><p>&nbsp;</p><p>因此，我们可以断定，集成测试与单元测试之间区别的根源是个错误。认定集成测试是用于团队之间测试，而单元测试是用于单一团队测试，这种区分观念本身便是不对的。我们所要解决的果正是自己造下的因。</p><p>&nbsp;</p><p>我们应当明确这二者的界限，明确开发团队之间的界限而非层次。界限的明确会让你从新的角度看待系统的角色，以及它与其他领域的交互。类似于Alistair Cockburn所描述的<a href=\"https://alistair.cockburn.us/hexagonal-architecture/\">六边形架构</a>\"，后者也被称作是“端口与适配器”。在他的描述中，系统拥有里外两个面，而我们要做的，就是通过明确定义的边界来连接这两个面。</p><p>&nbsp;</p><p>这有什么用呢？正是这个内外层的关系，明确了单元测试与集成测试之间的关系。单元测试负责从外向内地测试界限，而集成测试则是从内向外地对边界测试。具体来说，集成测试确保了适配器、网关和客户端，这些负责连接其他开发单元（如API、插件、、数据库和模块）之间关系的正常运作。</p><p>&nbsp;</p><p></p><h2>针对行为的测试</h2><p></p><p></p><p>“单元测试”中的“单元”是什么？单元是指行为的单元。这段定义中完全没有提到过任何针对单一文件、对象，或者函数的测试。那么，为什么编写针对行为的测试很难？</p><p>&nbsp;</p><p>多数测试类型都会遇到的问题来自软件结构和测试之间的紧密联系，其中开发者忽视了测试目标，并以透明盒（有时也被称作是白盒）的方式应对测试。透明盒测试是指内部设计时以系统正常运作为目标，常见于单元测试。但透明盒的问题在于，测试往往会过于细化导致产生大量用例，而这些用例又与底层结构紧密耦合，给维护增加了难度。</p><p>&nbsp;</p><p>人们对单元测试的不爽部分来源于此。而集成测试由于更多地脱离底层的设计，受重构的影响往往比单元测试要小。</p><p>&nbsp;</p><p>我更倾向于从另一个角度看问题。这一点是集成测试的优势，还是由透明盒测试所带来的问题？如果我们以基于行为的不透明盒（有时也被称作黑盒）方式进行单元测试，那么结果是否一样或更好？</p><p>&nbsp;</p><p>人们常常以为不透明盒测试只能应用于系统的外部边界，但这是不对的。我们的系统是由许多边界组成，有些可以借助通信协议访问，有些可以通过进程中的适配器扩展。这些适配器都有自己的边界，可以通过基于行为的方式进行测试。</p><p>&nbsp;</p><p></p><h2>模拟：孤注一掷</h2><p></p><p></p><p>透明盒测试通常大量使用模拟（mock），可一旦过度依赖模拟，测试便会更难维护。也许这就是Mark Seemann所说的“<a href=\"https://blog.ploeh.dk/2022/10/17/stubs-and-mocks-break-encapsulation/\">桩（stub）和模拟破坏了封装</a>\"”。在正视这类由过度使用模拟所带来的问题后，厌恶、甚至不惜一切代价地避免模拟是很正常的。仅使用API的测试通常会导致对模拟的过度依赖。</p><p>&nbsp;</p><p>但问题又回到了最初，这是否真的是由模拟或对模拟的误用导致的呢？</p><p>&nbsp;</p><p>模拟和桩或许更难维护，但它们的存在是有意义的。它们让测试更快也更稳定，我们需要掌控它们，且不在必要之外滥用模拟和桩。</p><p>&nbsp;</p><p></p><h2>减少代码的公共表面</h2><p></p><p></p><p>透明盒测试的另一弊端在于其会导致更多代码的暴露。验证器、映射器，以及其他可能的内部实现细节都会因为测试的缘故暴露在公共契约（contract）内。任何使用Java或C#的人都知道接口在代码库中的普遍程度。仅仅为了模拟一个依赖，开发者很可能会引入一个新接口。</p><p>&nbsp;</p><p>可被从外部访问的代码将会更难变动，测试也将成为必须项，让代码的可维护性受到质疑，在没有大量重写单元测试的情况下，重构几乎成为不可能。乍一看，这一问题似乎利于集成测试；集成测试更关注于外层，不会暴露很多的实现细节。</p><p>&nbsp;</p><p>但还是那个问题，这究竟是单元测试的问题，还是我们在实现单元测试方式的问题？如果我们以不透明盒的形式进行单元测试，无视内部设计方式，仅关注于消费者需求，或许我们会收获更小的契约，一个更易于测试的契约，更少的测试量，以及更便于维护的测试。</p><p>&nbsp;</p><p></p><h2>以架构为指导原则</h2><p></p><p></p><p>测试常常是围绕架构进行的。我们常常在系统设计完成之后才会考虑测试，但这也会让系统测试的难度更上一层楼。多层架构中这种情况屡见不鲜，对数据访问技术的依赖让领域层的单元测试更加繁复。</p><p>&nbsp;</p><p>采用测试隔离的架构可以轻松避免这种问题。无论是六边形架构还是干净架构（Clean Architecture），可选的有很多。这类架构的构建是独立于设备的，所有基础设备依赖都会通过依赖配置接入系统。架构的单元测试会更加舒适，并引导集成测试到适当的应用下：测试连往外部的适配器。</p><p>&nbsp;</p><p>集成测试的适配器会为我们的测试策略带来一个薄弱点。在所有组件相连的情况下进行集成测试，将收获测试在配置和组合方面的优势，显然这是我们想要的目标。当然我们也可以继续在组件全部相连的情况下测试，但这些测试只会是“烟雾弹”，不需要测试所有的边界情况，从而导向更稳定，也更可靠的测试。</p><p>&nbsp;</p><p></p><h2>结论</h2><p></p><p></p><p>质疑行业中的固有观念很重要，但在质疑之前先充分理解这些观念也同样重要。</p><p>&nbsp;</p><p>我们都知道历史是不断重复的，过去会带给我们关于将来决定的信息。但我们也应该明白同样的错误将会不可避免地一遍遍发生。这是人之本性，是否能规避这些错误将取决于我们自己。测试策略也是这些不断重复的错误之一。我们要面对这些由于信息或知识匮乏，以及错失已有优秀实践而导致的痛点。</p><p>&nbsp;</p><p>测试与架构是息息相关的。我们需要在设计架构时不忘测试情况，在我们追寻优秀测试策略时，单元测试仍会是我们可用的工具。</p><p></p><p>原文链接：</p><p><a href=\"https://www.infoq.com/articles/unit-tests-testing-pyramid/\">https://www.infoq.com/articles/unit-tests-testing-pyramid/</a>\"</p><p></p><p>相关阅读：</p><p><a href=\"https://www.infoq.cn/article/l0jqESl4bgNs3jC0GFvG\">个性化测试流程，不搞一刀切</a>\"</p><p><a href=\"https://www.infoq.cn/article/SxEUUtjMIWxc2cvJGZK4\">只擅长构建软件是不够的，我们必须擅长构建可测试的软件 | QCon</a>\"</p>",
    "publish_time": "2023-01-09 08:00:00",
    "source": {
      "name": "infoq_recommend",
      "desc": "InfoQ推荐",
      "icon": "https://raw.githubusercontent.com/maguowei/today/master/imgs/icon/infoq.png"
    }
  },
  {
    "title": "字节回应员工因没年终奖与HR互殴；乐视实行 4 天半工作制：不降薪无 996，研发可准点下班；亚马逊发全员信，拟裁员超1.8万人 ｜ Q资讯",
    "url": "https://www.infoq.cn/article/2VOCzMCsy7JQT27Aa8XR",
    "summary": "<p></p><blockquote>字节回应员工因没年终奖与HR互殴；乐视实行 4 天半工作制：不降薪无 996，研发可准点下班；Salesforce宣布重组计划：裁员10%并削减办公空间；Twitter解雇40名广告团队的工程师；亚马逊CEO发全员信，拟裁员超过1.8万人；谷歌希望 RISC-V 成为“一级”Android 架构；微软将推出AI版必应搜索，采用ChatGPT爆红技术；Debian 移除 Python 2；黑客免费公开2.35亿Twitter用户的数据，含姓名、邮件地址等信息……</blockquote><p></p><p>&nbsp;</p><p></p><h2>科技公司</h2><p></p><p>&nbsp;</p><p></p><h4>字节回应员工因没年终奖与HR互殴</h4><p></p><p>&nbsp;</p><p>1月4日，有报道称，字节跳动开启裁员后，有网友爆出被离职员工表示自己干到12月份，每天晚上做到7点半却没有年终奖，因此与HR产生肢体冲突，双方在公司内互薅头发后HR也被离职。对此，字节跳动相关人士对媒体表示，网传“裁员没年终奖字节员工与HR互殴”信息不实。经排查，公司内部未发现互殴情况；字节跳动今年的年终奖评定工作还没有启动，一般在每年4月发放。</p><p>&nbsp;</p><p>根据之前的媒体报道，字节跳动计划将整体规模优化10%左右，而到2022年底，该公司员工有约11万人左右，也就是说，此次裁员将涉及1.1万人，各条业务线也基本确定了优化目标。据称，抖音、TikTok、今日头条、飞书、商业化、Data、懂车帝都收到了裁员通知。</p><p>&nbsp;</p><p></p><h4>乐视实行 4 天半工作制：不降薪无 996，研发可准点下班</h4><p></p><p>&nbsp;</p><p>1 月 3 日，乐视 CEO 张巍发布了 2023 年致全体员工的一封信，名为《乐视，从来与众不同》。全员信中，乐视宣布自 2023 年 1 月 1 日起，公司将执行每周四天半工作制，每周三实行弹性的半天工作制，考勤时间调整为连续 5 小时，如上午 10 点至下午 15 点、上午 11 点至下午 16 点都符合规定。</p><p>&nbsp;</p><p>据潇湘晨报报道，乐视市场部的一名员工称，自去年 7 月起，乐视就已经提出这个制度了，这项决策并不是管理层的一时兴起，而是作为一项长期执行的制度。而且最重要的是，实行 4 天半工作制并不会降薪。</p><p>&nbsp;</p><p>乐视在公开信中表示，这项工作制有四点好处：</p><p>&nbsp;</p><p></p><blockquote>1、有利于员工和家人及时就医。疫情让我们认识到健康的重要性，周三休息半天，员工不用请假可以更灵活安排自己和家人就诊，对自己负责，更是对家庭、对社会负责。&nbsp;2、有利于缓解“周一工作焦虑症”。大城市工作压力大，上下班路远时间长，很多人周末休息后因周一至周五要连续工作五天，一到周一便感到焦虑。周三休息半天，员工可以去跑跑步、健健身或进行其他娱乐活动，能有效缓解这种焦虑。&nbsp;3、有利于员工学习和提高专业技能。活到老学到老，工作不只是输出，更需要充电。对于想要提升自己的员工尤其是刚毕业的年轻员工，周三弹性工作能增加周二晚和周三晚学习时长，规避周末突击学习的弊端，有利于提高学历和备考各类专业证书。&nbsp;4、有利于提升家庭幸福感。对于已经组建家庭的员工，可以更好的平衡工作与家庭。如果家里有孩子，周三不需要请假就可以接送孩子上下学 ; 如果还没有孩子，那么也有利于提高员工生育率，拥护国家政策。</blockquote><p></p><p>&nbsp;</p><p></p><h4>Salesforce宣布重组计划：裁员10%并削减办公空间</h4><p></p><p>&nbsp;</p><p>1月4日消息，美国软件开发商Salesforce宣布一项重组计划，包括裁员约10%，旨在降低运营成本，提高运营利润率。Salesforce预计，与此次重组计划相关的费用约为14亿美元至21亿美元，其中约8亿美元至10亿美元预计将在2023财年第四季度产生，该计划下的员工重组相关行动预计将在公司2024财年结束时基本完成。</p><p>&nbsp;</p><p></p><h4>Twitter解雇40名广告团队的工程师</h4><p></p><p>&nbsp;</p><p>1月6日消息，据The Information报道，Twitter于周三深夜解雇了约40名从事广告业务的数据科学家和工程师，这至少是自去年12月中旬以来的第三轮裁员。这位知情人士说，裁员的对象是Twitter领导层认为失败的领域，比如广告产品，以及不重要的领域，比如数据科学。有网友表示：“作为一名数据科学家，我极为愤慨。马斯克居然说数据科学不重要。”</p><p>&nbsp;</p><p></p><h4>亚马逊CEO发全员信，拟裁员超过1.8万人</h4><p></p><p>&nbsp;</p><p>1月5日，据亚马逊官网，亚马逊CEO安迪·贾西发布全员信，称公司计划裁员超过1.8万人，比较早时媒体报道的亚马逊将裁员逾1.7万人更多，裁员占亚马逊约30万企业员工的 6%。Andy Jassy在全员信中称，鉴于经济的不确定性，以及在过去几年中大规模招聘，年度规划变得更加困难，而且“由于我们的一位同事对外泄露了这项计划，我们决定提前公布消息，以便直接向大家传达细节。我们希望从1月18日开始，与受影响的员工展开沟通。”</p><p>&nbsp;</p><p></p><h2>IT业界</h2><p></p><p>&nbsp;</p><p></p><h4>谷歌希望 RISC-V 成为“一级”Android 架构</h4><p></p><p>&nbsp;</p><p>1月5日消息，谷歌已经正式宣布Android将支持RISC-V指令集架构。该消息的公告来自去年12月举行的RISC-V峰会，谷歌 Android 工程总监 Lars Bergstrom 在会议上提到了 Android 对 RISC-V 架构的支持愿景。他表示希望 RISC-V 成为 Android 支持的 “一级” 架构平台 (tier-1 platform)。</p><p>&nbsp;</p><p>目前，用户可以为RISC-V下载具备非常有限支持的Android版本，但它不支持用于Java工作负载的Android Runtime (ART)。大多数Android应用程序都使用Java代码发布，这意味着目前几乎没有应用程序会在Android上支持RISC-V。</p><p>&nbsp;</p><p>在峰会之前，Bergstrom 还曾表示过在 RISC-V 上优化 Android 构建需要 “大量工作”，并概述了需要 “几年” 才能实现目标的路线图。而现在，谷歌表示官方模拟器支持即将到来，而ART支持预计将在2023年第一季度的某个时候到来。一旦ART支持到来，可以一定程度上将Java转译为RISC-V，因此大多数Android应用程序将无需开发人员额外的工作即可运行。</p><p>&nbsp;</p><p></p><h4>微软将推出AI版必应搜索，采用ChatGPT爆红技术</h4><p></p><p>&nbsp;</p><p>1月4日，据彭博社报道，有知情人士透露，微软正准备将 OpenAI 的 ChatGPT 聊天机器人添加到其 Bing 搜索引擎中，以吸引竞争对手谷歌的用户。</p><p>&nbsp;</p><p>这位知情人士表示，微软相信，对于搜索用户来说，提供更具对话性和上下文回复，可以比链接提供更好的答案，从而赢得用户。微软可能在未来几个月内推出附加功能，但现在仍在权衡聊天机器人的准确性以及将其纳入搜索引擎的速度。该知情人士表示，最初的版本可能是对一小部分用户的有限测试。</p><p>&nbsp;</p><p>微软的 Bing 服务规模远小于 Alphabet Inc.占主导地位的谷歌搜索引擎，这位知情人士表示，微软几个月来一直在试用 ChatGPT。微软尚未置评，OpenAI不予置评。</p><p>&nbsp;</p><p></p><h4>Debian 移除 Python 2</h4><p></p><p>&nbsp;</p><p>Debian 从 FTP 服务器上移除了 Python 2 包。Python 2 已经在 2020 年结束支持，Python 开发者在 2020 年 4 月发布了 Python 2.7 分支的最后一个版本，也是一个非常特殊的版本：Python 2.7.18（近似欧拉常数）。大部分 Linux 发行版开始着手移除 Python 2 包。</p><p>&nbsp;</p><p></p><h4>63GB！黑客免费公开2.35亿Twitter用户的数据，含姓名、邮件地址等信息</h4><p></p><p>&nbsp;</p><p>1月5日消息，有黑客在论坛上泄露了含有2.35亿Twitter用户的数据。据Cybernews报道，此次泄露的数据大约有 63GB，其中包括用户的姓名、电子邮件地址、粉丝数量和账户创建日期。该数据库甚至是公开的，允许任何人下载它。</p><p>&nbsp;</p><p>据《华盛顿邮报》报道，这些记录很可能是在2021年底利用Twitter的一个漏洞泄露的，该漏洞允许掌握电子邮件地址或电话号码的外人在Twitter上找到任何与该信息相匹配的账户。这些查询可以自动化，以检查无限数量的电话号码和电子邮件地址。</p>",
    "publish_time": "2023-01-09 08:03:57",
    "source": {
      "name": "infoq_recommend",
      "desc": "InfoQ推荐",
      "icon": "https://raw.githubusercontent.com/maguowei/today/master/imgs/icon/infoq.png"
    }
  }
]