[
  {
    "title": "万学凡： IT 团队的数字化转型实践 ｜ DTDS 8 月",
    "url": "https://www.infoq.cn/article/kexOtZp47BLua9wFpomF",
    "summary": "<p>在工业和信息化部人才交流中心和中国移动通信联合会教育与考试中心的大力支持与指导下，由极客时间企业版、培训杂志共同举办，甫瀚咨询联合举办的 DTDS 全球数字人才发展线上峰会于 8 月 9 日拉开帷幕。</p>\n<p>经过多年在企业数字人才发展领域的耕耘，极客时间于 2022 年发布了数字人才粮仓模型，深入定义了五层数字人才，收获了来自各行各业的企业客户的认可。我们也看到许多企业都在加大对数字人才的培养，并且希望向行业标杆学习，完善自己的数字人才培养体系，融入数字人才标准和生态。</p>\n<p>为此，DTDS 峰会汇聚了来自政府和产业的权威，以及金融、汽车、制造、ICT、零售、互联网、风控审计企业的数字化先锋人物，旨在建立数字人才培养“朋友圈”，让大家从多维视角了解企业数字化转型，人才发展，和组织变革的先进经验。</p>",
    "publish_time": "2022-09-22 00:00:00",
    "source": {
      "name": "infoq_recommend",
      "desc": "InfoQ推荐",
      "icon": "https://raw.githubusercontent.com/maguowei/today/master/imgs/icon/infoq.png"
    }
  },
  {
    "title": "AWS数据库迁移服务：将Oracle数据库迁移到MySQL",
    "url": "https://www.infoq.cn/article/MwBXrRq4fprblHP43hpR",
    "summary": "<p><a href=\"https://aws.amazon.com/dms/\">AWS数据库迁移服务</a>\"（DMS）是在AWS上进行数据库迁移的服务。目标数据库必须是AWS支持的数据库之一，例如由AWS<a href=\"https://aws.amazon.com/rds/\">关系数据库服务</a>\"（RDS）托管的数据库、<a href=\"https://aws.amazon.com/dynamodb/\">Amazon DynamoDB</a>\"或<a href=\"https://aws.amazon.com/pm/redshift\">Amazon Redshift</a>\"。源数据库可以是AWS上的数据库、本地数据库或其他云平台（如<a href=\"https://docs.oracle.com/en-us/iaas/Content/Database/Concepts/databaseoverview.htm\">Oracle数据库云服务</a>\"）上的数据库。源数据库在迁移过程中不需要停机。</p><p></p><h2>为什么要迁移数据库</h2><p></p><p>你可能会因为以下一个或多个原因而迁移数据库。</p><p></p><p>同构迁移——迁移到不同平台但相同类型的数据库引擎。同构迁移可以用于对数据库进行备份。异构迁移——迁移到不同的数据库引擎，如Oracle数据库迁移到MySQL数据库。如果我们需要利用另一个数据库的功能（例如源数据库不支持某些数据类型），就需要进行异构迁移。商业数据库可以迁移到开源数据库，反之亦然。关系数据库可以迁移到NoSQL数据库。数据复制——将数据持续地复制到不同的目标数据库，用于测试和开发以及实现数据库的区域分布。数据库整合——可以将多个源数据库迁移到单个数据库进行整合。平台迁移——本地机器上的数据可以被迁移到云数据库服务。基于云的数据库即服务（Database-as-a-Service，DBaaS）提供了很多好处：不需要DBA的全托管服务、具有故障转移能力的高可用性、可伸缩性以及与其他云服务集成（实现自动化监控和日志记录）。在本文中，我们将把Oracle数据库迁移到MySQL数据库。如果你更喜欢开源MySQL数据库而不是商业Oracle数据库，那就可能需要进行迁移。MySQL和Oracle数据库是完全不同的，你可能会出于一个或多个原因而迁移到MySQL，例如不同的数据类型支持、操作系统支持和部署规模。</p><p></p><p>进行迁移唯一的先决条件是AWS帐户，可以在<a href=\"https://aws.amazon.com/resources/create-account/\">这里</a>\"创建。</p><p></p><h2>第1步：在RDS上创建Oracle和MySQL DB实例</h2><p></p><p>因为我们分别将Oracle和MySQL RDS DB实例作为DMS迁移的源和目标，因此需要创建两个RDS实例，一个用于Oracle数据库，另一个用于MySQL。在创建RDS实例之前，我们需要创建新的VPC（虚拟私有云）、新的DB子网组和安全组（可选）。我们也可以使用默认的VPC安全组。如果AWS帐户的VPC最大数量有限制，请在创建RDS实例前删除部分不使用的VPC。在创建RDS实例时，将公开访问选项设置为“是”，因为我们需要在执行DMS迁移之前直接访问这些实例，运行一些命令，并在迁移完成后验证迁移的数据。由于RDS默认情况下不创建数据库，所以我们需要选择附加配置，并为每个RDS实例指定初始数据库名称。MySQL RDS实例数据库名称为mysqldb，Oracle RDS实例数据库名称为orcl。某些保留关键字，如MySQL RDS实例的“mysql”不能用在配置中（如数据库名称、数据库实例标识符、主用户名、主密码）。Oracle和MySQL的源和目标RDS实例如图1所示。</p><p></p><p><img src=\"https://imgopt.infoq.com/fit-in/1200x2400/filters:quality(80)/filters:no_upscale()/articles/oracle-to-mysql-aws-database-migration-service/en/resources/1Untitled-2-1662493980459.jpg\" /></p><p>图1. RDS数据库实例</p><p></p><p>如果安全组没有满足需求的入站/出站规则，可能需要修改它们。单击RDS控制台中每个数据库实例的安全组链接。检查安全组的“Type”为“All traffic”、“Protocol”为“All”、“Port Range”为“All”、“Source”为“Anywhere”（0.0.0.0/0），如果不是，单击“Edit inbound rules”按钮并修改设置，然后单击“Save rules”。类似地，出站规则也应该允许所有流量。把每个DB实例的主用户名和主密码记录下来。</p><p></p><h2>第2步：为DMS准备Oracle和MySQL数据库</h2><p></p><p>为了能够使用RDS上的Oracle DB作为DMS源，我们需要在DB实例上配置一些东西。我们可以在命令行中连接到Oracle实例来进行配置。要在命令行中连接到RDS DB实例，我们需要获取RDS实例的端点。RDS上的DB实例的端点可以从RDS控制台获得。</p><p></p><p>安装<a href=\"https://www.oracle.com/ca-fr/database/technologies/instant-client/downloads.html\">Oracle Instant客户端</a>\"。使用下面的sqlplus命令连接到Oracle DB实例，其中HOST、SID和PORT对于不同的用户来说是不一样的。HOST就是端点移除端口后缀后剩下的部分。</p><p></p><p><code lang=\"sql\">sqlplus admin@(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=orcl.crbmlbxmp8qi.us-east-1.rds.amazonaws.com)(PORT=1521))(CONNECT_DATA=(SID=ORCL)))\n</code></p><p></p><p>SQL*Plus命令行连接到RDS上的Oracle DB，并启用DMS数据库级别的补充日志。</p><p></p><p><code lang=\"sql\">exec rdsadmin.rdsadmin_util.alter_supplemental_logging('ADD');\n</code></p><p></p><p>PL/SQL过程执行完毕。</p><p></p><p>使用下面的命令启用数据库级别的PRIMARY KEY日志。</p><p></p><p><code lang=\"sql\">exec rdsadmin.rdsadmin_util.alter_supplemental_logging('ADD','PRIMARY KEY');\n</code></p><p></p><p>由于源数据库是Oracle，要复制正在进行的变更，需要打开补充日志。我们需要确保存档日志在服务器上保留足够长的时间（通常是24小时）。要在RDS数据库上设置存档日志保留期限，可以使用下面的命令。</p><p></p><p><code lang=\"sql\">exec rdsadmin.rdsadmin_util.set_configuration('archivelog retention hours',24);\n</code></p><p></p><p>在迁移数据库时，表和数据也会被迁移。为数据库迁移专门创建一个新的Schema。为新用户授予CREATE SESSION和CREATE TABLE权限。</p><p></p><p><code lang=\"sql\">CREATE USER dms_user IDENTIFIED BY dms_user_pw\nDEFAULT TABLESPACE users\nQUOTA unlimited ON users;\n\nGRANT CREATE SESSION, CREATE TABLE TO dms_user;\n</code></p><p></p><p>在Oracle数据库中创建一张叫作wlslog的数据库表。</p><p></p><p><code lang=\"sql\">CREATE TABLE dms_user.wlslog(time_stamp VARCHAR2(255) PRIMARY KEY,category VARCHAR2(255),type VARCHAR2(255),servername VARCHAR2(255), code VARCHAR2(255),msg VARCHAR2(255));\nINSERT INTO dms_user.wlslog(time_stamp,category,type,servername,code,msg) VALUES('Apr-8-2014-7:06:16-PM-PDT','Notice','WebLogicServer','AdminServer','BEA-000365','Server state changed to STANDBY');\nINSERT INTO dms_user.wlslog(time_stamp,category,type,servername,code,msg) VALUES('Apr-8-2014-7:06:17-PM-PDT','Notice','WebLogicServer','AdminServer','BEA-000365','Server state changed to STARTING');\nINSERT INTO dms_user.wlslog(time_stamp,category,type,servername,code,msg) VALUES('Apr-8-2014-7:06:18-PM-PDT','Notice','WebLogicServer','AdminServer','BEA-000365','Server state changed to ADMIN');\nINSERT INTO dms_user.wlslog(time_stamp,category,type,servername,code,msg) VALUES('Apr-8-2014-7:06:19-PM-PDT','Notice','WebLogicServer','AdminServer','BEA-000365','Server state changed to RESUMING');\nINSERT INTO dms_user.wlslog(time_stamp,category,type,servername,code,msg) VALUES('Apr-8-2014-7:06:20-PM-PDT','Notice','WebLogicServer','AdminServer','BEA-000361','Started WebLogic AdminServer');\nINSERT INTO dms_user.wlslog(time_stamp,category,type,servername,code,msg) VALUES('Apr-8-2014-7:06:21-PM-PDT','Notice','WebLogicServer','AdminServer','BEA-000365','Server state changed to RUNNING');\nINSERT INTO dms_user.wlslog(time_stamp,category,type,servername,code,msg) VALUES('Apr-8-2014-7:06:22-PM-PDT','Notice','WebLogicServer','AdminServer','BEA-000360','Server started in RUNNING mode');\n</code></p><p></p><p>若要为没有PRIMARY KEY日志的表添加补充日志，或者如果未设置数据库级别的PRIMARY KEY日志，可以为表添加补充日志。</p><p></p><p><code lang=\"sql\">alter table dms_user.wlslog add supplemental log data (ALL) columns;\n</code></p><p></p><p>我们还可以直接在CREATE TABLE语句中启用补充日志。</p><p></p><p><code lang=\"sql\">CREATE TABLE dms_user.wlslog(time_stamp VARCHAR2(255) PRIMARY KEY,category VARCHAR2(255),type VARCHAR2(255),servername VARCHAR2(255), code VARCHAR2(255),msg VARCHAR2(255),supplemental log data(ALL) columns);\n</code></p><p></p><h2>第3步：创建复制实例</h2><p></p><p>在本小节中，我们将创建一个复制实例，将RDS上的Oracle DB实例迁移到MySQL DB实例。在AWS控制台中选择DMS服务。单击创建复制实例，如图2所示。</p><p></p><p><img src=\"https://imgopt.infoq.com/fit-in/1200x2400/filters:quality(80)/filters:no_upscale()/articles/oracle-to-mysql-aws-database-migration-service/en/resources/1Untitled-3-1662493980459.jpg\" /></p><p>图2. 创建复制实例</p><p></p><p>打开“Create replication instance”向导，在“Name”字段中指定复制实例名（ora-mysql-repl）。选择一个Instance class，我们选择了dms.t3.medium。在“引擎版本”下拉框中选择AWS DMS版本（3.4.7）。选择“Allocated storage”（50GiB）。选择运行复制实例的Amazon VPC。将“Multi-AZ”下拉框改为“Single-AZ”，我们只使用单个可用分区。选择“Publicly accessible”选项。</p><p></p><p>在“Advanced security and network configuration”中选择“复制子网组”。保持“Availability zone”默认值“No preference”不变。选择默认的VPC安全组。选择KMS密钥作为默认值（aws/dms）。点击“Create”。创建的复制实例如图3所示。</p><p></p><p><img src=\"https://imgopt.infoq.com/fit-in/1200x2400/filters:quality(80)/filters:no_upscale()/articles/oracle-to-mysql-aws-database-migration-service/en/resources/1Figure3-1662493980457.jpg\" /></p><p>图3. 复制实例</p><p></p><h2>第4步：创建端点</h2><p></p><p>接下来是配置端点，它们是源和目标数据库的端点。选择左边栏中的“端点”，单击“Create endpoint”。源和目标端点是分别创建的。在“DMS-&gt;Endpoints-&gt;创建端点向导”中，选择“Endpoint type”为“Source endpoint”，单击“Select RDS DB”复选框，从下拉菜单中选择orcl RDS实例。在“Endpoint configuration”中指定端点标识符orcl。“Source engine”应该为Oracle，因为我们选择了Oracle数据库RDS引擎。在“Access to endpoint database“中选择“Provide access information manually”选项。“Server name”和“Port”应该会自动添加。为ADMIN用户指定密码，用户名必须为大写，因为Oracle数据库是区分大小写的。“Secure Socket Layer (SSL) mode”设置为none。“SID/Service name”应该自动填充为在Oracle RDS实例中配置的值（ORCL）。在“Test endpoint connection (optional) ”中单击Run test。复制实例ora-mysql-repl被用于端点连接。“Status”为“successful”表示连接建立成功。单击“Create endpoint”，源数据库的端点就创建好了，如图4所示。</p><p></p><p><img src=\"https://imgopt.infoq.com/fit-in/1200x2400/filters:quality(80)/filters:no_upscale()/articles/oracle-to-mysql-aws-database-migration-service/en/resources/1Figure4-1662493980459.jpg\" /></p><p>图4. 源端点</p><p></p><p>要创建目标端点，请再次单击“Create endpoint”，启动创建端点向导。这一次，选择“Target endpoint”作为“Endpoint type”。单击“Select RDS DB”复选框并选择mysqldb实例。在“Endpoint configuration”中应该会自动添加“Endpoint identifier”。“Target engine”被设置为MySQL。对于“Access to endpoint database”，选择“Provide access information manually”。“Server name”和“Port”应该会自动添加好。为admin用户指定密码。用户名必须用小写字母指定，因为MySQL使用小写字母。“Secure Socket Layer (SSL) mode”设置为none。在“Test endpoint connection (optional) ”中单击Run test。复制实例ora-mysql-repl被用于端点连接。“Status”为“successful”表示连接建立成功。单击“Create endpoint”，目标数据库的端点就创建好了，如图5所示。</p><p></p><p><img src=\"https://imgopt.infoq.com/fit-in/1200x2400/filters:quality(80)/filters:no_upscale()/articles/oracle-to-mysql-aws-database-migration-service/en/resources/1Figure5-1662493980459.jpg\" /></p><p>图5. 目标端点</p><p></p><h2>第5步：创建任务</h2><p></p><p>接下来，我们需要创建一个迁移任务，但在此之前，我们需要像前面所说的那样创建一个复制实例。在左边栏中选择“Database migration tasks”。在DMS-&gt;Database migration tasks表中单击“Create task”。在“Create database migration task”向导的“Task configuration”中指定一个“Task identifier”（orcl-to-mysql）。在“Replication instance”下拉框中选择前面创建的复制实例。在源数据库端点中选择为Oracle数据库RDS实例创建的orcl端点。对于目标数据库端点，选择前面创建的mysqldb端点。对于“Migration type”，选择“Migrate existing data and replicate ongoing changes”。</p><p></p><p>我们必须至少为一个任务配置一个选择规则，否则创建任务就会失败。在“Table mappings”中单击“Selection rules”下拉框。单击“Add new selection rule”按钮。在规则详细信息中配置“Where”选择规则。在“Schema”下拉框中选择“Enter Schema”。指定“Source name”为DMS_USER，“Source table name”为WLSLOG。模式名/表名/视图名/列名必须是大写的，因为Oracle数据库是区分大小写的。%是模式/表名的通配符，表示所有的模式/表。对于Action字段，我们可以通过选择Include或Exclude来包含或排除对象。排除操作在包含操作之后处理。将“Action”选为“Include”。源过滤器限制了可以添加的从源到目标的记录数量和类型。选择规则配置如图6所示。</p><p></p><p><img src=\"https://imgopt.infoq.com/fit-in/1200x2400/filters:quality(80)/filters:no_upscale()/articles/oracle-to-mysql-aws-database-migration-service/en/resources/1Figure6-1662493980459.jpg\" /></p><p>图6. 选择规则</p><p></p><p>你可以使用转换规则来修改或转换部分或所有选定对象的模式、表或列名。我们可以单击“Add transformation rule”按钮来添加一个转换规则。假设我们要转换表名。在“Rule target”下拉框中选择“Table”。在“Source name”中选择“Enter schema”。将Schema指定为DMS_USER。指定“Source table name”为WLSLOG。在Action下拉框中选择一个可用的操作，例如添加/移除/替换前缀/后缀等。选择Action为“Make lowercase”，因为MySQL以小写形式存储Schema/表名。表名的转换规则如图7所示。</p><p></p><p><img src=\"https://imgopt.infoq.com/fit-in/1200x2400/filters:quality(80)/filters:no_upscale()/articles/oracle-to-mysql-aws-database-migration-service/en/resources/1Figure7-1662493980460.jpg\" /></p><p>图7. 将表名转为小写的转换规则</p><p></p><p>类似地，添加另一个转换规则将Schema名转为小写，如图8所示。</p><p></p><p><img src=\"https://imgopt.infoq.com/fit-in/1200x2400/filters:quality(80)/filters:no_upscale()/articles/oracle-to-mysql-aws-database-migration-service/en/resources/1Figure8-1662493980459.jpg\" /></p><p>图8. 将Schema名称转为小写的转换规则</p><p></p><p>在“Task settings-&gt;Advanced task settings-&gt;Control table settings”中将“Create control table in target using schema”设置为“mysqldb”。如果选择了“Enable premigration assessment run”复选框，可能会执行预迁移评估。在“Migration task startup configuration”中选择“Manually later”。另一个选项是“Automatically on create”，这个选项只在未启用预迁移时才可用。随后，单击“Create task”。</p><p></p><p>一个新任务就添加好了。任务状态最开始时是“创建”，在创建好以后Status变为“Ready”，如图9所示。</p><p></p><p><img src=\"https://imgopt.infoq.com/fit-in/1200x2400/filters:quality(80)/filters:no_upscale()/articles/oracle-to-mysql-aws-database-migration-service/en/resources/1Figure9-1662493980460.jpg\" /></p><p>图9. 任务状态变为Ready</p><p></p><h2>第6步：运行任务</h2><p></p><p>要运行迁移任务，请选择表中带有复选框的任务，并单击Actions下拉框中的Restart/Resume。任务的Status应该会变为Starting。在启动之后，Status会变为Running，当迁移完成时，Status将变为Load complete，如图10所示。Table statistics选项卡应该会列出迁移的表。</p><p></p><p><img src=\"https://imgopt.infoq.com/fit-in/1200x2400/filters:quality(80)/filters:no_upscale()/articles/oracle-to-mysql-aws-database-migration-service/en/resources/1Figure10-1662493980459.jpg\" /></p><p>图10. 任务执行完毕</p><p></p><h2>第7步：查询迁移的数据库Schema</h2><p></p><p>使用MySQL客户端列出迁移的数据库和表。首先，连接到MySQL RDS实例。要连接到MySQL DB，可以从它的配置信息中获取端点，然后使用MySQL客户端的命令行连接MySQL。在出现提示时输入密码：</p><p></p><p><code lang=\"sql\">mysql -h mysqldb.crbmlbxmp8qi.us-east-1.rds.amazonaws.com -P 3306 -u admin  –p\n</code></p><p></p><p>使用SHOW SCHEMAS命令列出所有Schema，其中包含了dms_user的Schema。</p><p></p><p><code lang=\"sql\">~$ mysql -h mysqldb.crbmlbxmp8qi.us-east-1.rds.amazonaws.com -P 3306 -u admin -p \nEnter password: \nMySQL [(none)]&gt; SHOW SCHEMAS;\n+--------------------+\n| Database           |\n+--------------------+\n| dms_user           |\n| information_schema |\n| mysql              |\n| mysqldb            |\n| performance_schema |\n| sys                |\n+--------------------+\n6 rows in set (0.078 sec)\n</code></p><p></p><p>使用use dms_user命令选择dms_user数据库。使用show tables命令列出表，可以看到之前在Oracle数据库中创建的wlslog表已被迁移。</p><p></p><p><code lang=\"sql\">MySQL [(none)]&gt; use dms_user;\nReading table information for completion of table and column names\nYou can turn off this feature to get a quicker startup with -A\n\nDatabase changed\nMySQL [dms_user]&gt; SHOW TABLES;\n+--------------------+\n| Tables_in_dms_user |\n+--------------------+\n| wlslog             |\n+--------------------+\n1 row in set (0.078 sec)\n</code></p><p></p><p>迁移的wlslog表中包含了数据，如查询结果所示。</p><p></p><p><code lang=\"sql\">MySQL [dms_user]&gt; SELECT * FROM wlslog;\n+---------------------------+----------+----------------+-------------+------------+----------------------------------+\n| TIME_STAMP                | CATEGORY | TYPE           | SERVERNAME  | CODE       | MSG                              |\n+---------------------------+----------+----------------+-------------+------------+----------------------------------+\n| Apr-8-2014-7:06:16-PM-PDT | Notice   | WebLogicServer | AdminServer | BEA-000365 | Server state changed to STANDBY  |\n| Apr-8-2014-7:06:17-PM-PDT | Notice   | WebLogicServer | AdminServer | BEA-000365 | Server state changed to STARTING |\n| Apr-8-2014-7:06:18-PM-PDT | Notice   | WebLogicServer | AdminServer | BEA-000365 | Server state changed to ADMIN    |\n| Apr-8-2014-7:06:19-PM-PDT | Notice   | WebLogicServer | AdminServer | BEA-000365 | Server state changed to RESUMING |\n| Apr-8-2014-7:06:20-PM-PDT | Notice   | WebLogicServer | AdminServer | BEA-000361 | Started WebLogic AdminServer     |\n| Apr-8-2014-7:06:21-PM-PDT | Notice   | WebLogicServer | AdminServer | BEA-000365 | Server state changed to RUNNING  |\n| Apr-8-2014-7:06:22-PM-PDT | Notice   | WebLogicServer | AdminServer | BEA-000360 | Server started in RUNNING mode   |\n+---------------------------+----------+----------------+-------------+------------+----------------------------------+\n7 rows in set (0.078 sec)\n\nMySQL [dms_user]&gt; \n</code></p><p></p><p>默认情况下，迁移进程不会主动轮询源数据库来获取数据变更。如果对源数据库做了修改，例如将数据添加到表中或创建了新表，必须再次运行迁移任务。我们有时候可能需要修改迁移任务，例如添加/删除选择规则或修改其他任务设置。任务在未运行时可以被修改。我们可以单击“Modify”来修改任务。</p><p></p><p>作者简介：</p><p>Deepak Vohra是Oracle认证Java程序员和Oracle认证Web组件开发人员，出版了20多本书。</p><p></p><p>原文链接：</p><p><a href=\"https://www.infoq.com/articles/oracle-to-mysql-aws-database-migration-service/\">How to Migrate an Oracle Database to MySQL Using AWS Database Migration Service</a>\"</p><p></p><p>相关阅读：</p><p><a href=\"https://www.infoq.cn/article/0tVa0oXspxw2F7jJR1eC\">亚马逊云科技宣布 Lambda 分级定价</a>\"</p><p><a href=\"https://www.infoq.cn/article/69cDiK84CkeW7CEZXg9j\">Stack Overflow 2022 报告：亚马逊云科技的软件开发“武器库”</a>\"</p><p><a href=\"https://www.infoq.cn/article/YXA3Lcv5byYNqXScc8Zm\">TLS 1.2 成为亚马逊云科技最低 TLS 协议级别</a>\"</p>",
    "publish_time": "2022-09-22 08:00:00",
    "source": {
      "name": "infoq_recommend",
      "desc": "InfoQ推荐",
      "icon": "https://raw.githubusercontent.com/maguowei/today/master/imgs/icon/infoq.png"
    }
  }
]