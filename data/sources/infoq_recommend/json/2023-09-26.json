[
  {
    "title": "电商巨头 Shopify 提升 LLM 辅助工具，优化电子商务生态",
    "url": "https://www.infoq.cn/article/uNJmOYLgQK062KPYFWDw",
    "summary": "<p>在使用大型语言模型聊天机器人打开了创新解决方案之门的同时，Shopify 的工程师 Ates Goral 认为，要使用户体验尽可能自然，需要一些特定的努力，以<a href=\"https://shopify.engineering/sidekicks-improved-streaming\">防止产生卡顿并减少延迟</a>\"。</p><p>&nbsp;</p><p>由大型语言模型返回的 Markdown 响应流会导致渲染卡顿，因为特殊的 Markdown 字符（如 *）在完整表达式被接收之前保持模糊不清，例如，直到接收到闭合的 *。同样的问题也适用于链接和所有其他 Markdown 运算符。这意味着 Markdown 表达式在完全完成之前无法正确渲染，这意味着在短时间内 Markdown 渲染不正确。</p><p>&nbsp;</p><p>为了解决这个问题，Shopify 使用了一个缓冲解析器，它在 Markdown 特殊字符之后不会发出任何字符，并等待 Markdown 表达式完全完成或收到意外字符。</p><p>&nbsp;</p><p></p><blockquote>在进行流式传输时，需要使用一个有状态的流处理器，可以逐个字符地消耗字符。流处理器要么按照字符接收的顺序传递字符，要么在遇到类似 Markdown 的字符序列时更新缓冲区。</blockquote><p></p><p>&nbsp;</p><p>然而，Goral 表示，虽然从原理上讲，这个解决方案相对容易手动实现，但要支持完整的 Markdown 规范，则需要使用现成的解析器。另一方面，延迟主要是由于需要进行多次大型语言模型往返来消耗外部数据源，以扩展大型语言模型的初始响应所导致的。</p><p>&nbsp;</p><p></p><blockquote>大型语言模型对一般的人类语言和文化有很好的理解，但它们并不是获取最新准确信息的绝佳来源。因此，我们告诉大型语言模型通过使用工具来告诉我们当它们需要超出其理解范围的信息时。</blockquote><p></p><p>&nbsp;</p><p>换句话说，基于用户输入，大型语言模型提供的初始响应还包括要咨询以获取缺失信息的其他服务。当这些额外的数据片段被接收后，大型语言模型将构建完整的响应，最终显示给用户。</p><p>&nbsp;</p><p>为了防止用户需要等待所有外部服务都响应完成，Sidekick 使用了 \"卡片\" 的概念，即占位符。Sidekick 渲染了从大型语言模型收到的初始响应，包括任何占位符。一旦额外的请求完成，Sidekick 将占位符替换为接收到的信息。</p><p>&nbsp;</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/43/43afd7d3246a2f60947117a72536422b.gif\" /></p><p></p><p>&nbsp;</p><p>在 Sidekick 中实施的解决方案充分利用了此工作流程中固有的异步性，并将响应分流步骤与 Markdown 缓冲解析器集成在一起。如果您对他们的解决方案的完整细节感兴趣，不要错过 Goral 的原文文章。</p><p>&nbsp;</p><p>&nbsp;</p><p>原文链接：</p><p><a href=\"https://www.infoq.com/news/2023/08/Shopify-sidekick-llm-improvement/\">https://www.infoq.com/news/2023/08/Shopify-sidekick-llm-improvement/</a>\"</p>",
    "publish_time": "2023-09-26 08:00:00",
    "source": {
      "name": "infoq_recommend",
      "desc": "InfoQ推荐",
      "icon": "https://raw.githubusercontent.com/maguowei/today/master/imgs/icon/infoq.png"
    }
  },
  {
    "title": "PICO 首届 XR 开发者挑战赛正式启动，助推行业迈入“VR+MR”新阶段",
    "url": "https://www.infoq.cn/article/EjqbmPdv0fSvUkWqgZ2k",
    "summary": "<p>9 月 25 日，“PICO 2023 首届 XR 开发者挑战赛”（下文简称“挑战赛”）媒体启动会在北京圆满落幕，官方赛事报名通道已于今日开启。据悉，本次挑战赛是 PICO 首次针对全球开发者举办的大型挑战赛事，旨在与开发者保持连接，共同探索 XR 行业新成长。作为主办方，PICO 将为参赛者提供平台、专业技术、资金等全方位支持，而全球领先的芯片厂商英特尔也将作为本届赛事技术合作伙伴为参赛者保驾护航。</p><p></p><p><img src=\"https://static001.infoq.cn/resource/image/bb/40/bbb0993bf6845538a460d7737734a740.png\" /></p><p>图1：PICO 2023首届XR开发者挑战赛报名通道正式开启</p><p>&nbsp;</p><p>启动会现场，除了官宣赛事启动，PICO 相关负责人还围绕行业、技术、资金/人才投入等维度详细阐述了 PICO 一直以来对于开发者的重视及此次举办开发者挑战赛的初衷，呼吁更多开发者投入XR开发新领域，与 PICO 及行业共成长。</p><p></p><p>“新阶段的 XR 行业，值得开发者关注与参与。”PICO OS 产品负责人马杰思谈到，“XR 行业已经迈入新的发展阶段，开始从强调虚拟的‘VR’向虚实融合的‘VR+MR’阶段过渡，这种变化不仅能给用户提供更多样化的产品价值，一定程度也赋予了开发者更大的创作空间。各行各业的开发者，都有机会融入到XR开发的领域之中，一起创造新机会和新市场。同时，光学显示、芯片算力、环境感知、人机交互等技术的突破，也加速了 XR 行业发展。”</p><p></p><p><img src=\"https://static001.infoq.cn/resource/image/ae/29/aef7883c92bd3a90944a3aa27c5ff629.jpg\" /></p><p>图2：PICO OS产品负责人马杰思现场分享</p><p></p><p>马杰思同时表示，想要实现整个 XR 赛道高水平发展的局面，决不是凭借 PICO 或者某一家品牌一家之力就可以做成的事情。一直以来，PICO 都相当重视广大的开发者伙伴，先后启动了“PICO 开发者计划”“PICO 创作者激励计划”等，从硬件、技术、营销等维度，全链路助力开发者成长。此次主办首届开发者挑战赛事，是在 XR 行业新阶段下 PICO 与开发者链接的一次新尝试。新趋势下，PICO 将持续围绕空间感知、图形渲染、人机交互等 XR 核心底层技术能力持续完善，并协同字节底层技术能力，为开发者提供前沿、便捷的开发服务。</p><p></p><p><img src=\"https://static001.infoq.cn/resource/image/a7/b8/a7a445324980c41320ab0e00dbc13fb8.jpg\" /></p><p>图3：PICO中国区游戏商务负责人郭文山现场分享</p><p>&nbsp;</p><p>作为全球知名的 XR 品牌，PICO 在近两年保持快速增长，2022 年全年销量同比之前翻了 8 倍。此外，IDC 数据显示，2022 年市场份额 PICO 全球排名第二、国内位居第一，2023 年上半年国内 VR 市场的厂商份额中，PICO 以 58.7% 的占比大幅领先同行。这些成果背后，离不开庞大的用户群体以及众多开发者共建内容生态的支持。</p><p></p><p>PICO 中国区游戏商务负责人郭文山表示：“截止目前，PICO 应用商店的应用数量已超 530 款，‘大作’占比近四成。其中，国内开发者贡献不容忽视，PICO 应用商店中包括游戏、视频、运动、办公、教育、音乐等在内的 100 多款应用均来自国内开发者。此外，PICO 也给开发者带来更多用户和收入，&nbsp;有 180 款游戏收入超过 10 万元，近 50 款应用下载量超过 10 万，而部分平台头部开发者，在 PICO 的年收入已超过 800 万元。”</p><p></p><p><img src=\"https://static001.infoq.cn/resource/image/8e/8f/8e2daabe3454191f157eb6ffd0f6c68f.png\" /></p><p>图4：PICO将为开发者们提供专业指导、投资机会、流量曝光等全方位支持</p><p>&nbsp;</p><p>据了解，本次“挑战赛”将在欧洲、北美、东南亚、日韩、中国等多个国家和地区同期举办，为全球开发者提供展示才华、实现创意的舞台。所有未发行/已发行且没在往届同类型比赛中 PICO 赛道获奖的作品均可报名。赛事报名通道于 9 月 25 日正式开通，开发者可通过 PICO 官网开放平台赛事专区报名参赛，并于 10 月 2 日至 11 月 10 日期间完成作品提报。<a href=\"https://www.infoq.cn/article/z1CW0cFhLxLi2KYk258t\">PICO</a>\" 将于 11 月 30 日前组织评委完成评审，并于 12 月 5 日举办颁奖仪式，公布获奖名单。</p><p>&nbsp;</p><p><a href=\"https://www.infoq.cn/article/Vsc9cCloJx9mCOTyURGT\">针对</a>\"本届“挑战赛”重点赛区之一的中国区开发者，本次挑战赛设置了前五名，另外还单独设置了游戏类、创新类、MR 赛道、手势识别四个不同赛道奖项。获奖者除收获最高达 6 万元的丰厚奖金外，还有机会得到技术大咖指导、投资圆桌交流、<a href=\"https://xie.infoq.cn/article/40e1258dc998d9c7ce6380c8a\">PICO</a>\" 创投基金和面试直通等额外支持。 赛事技术合作伙伴英特尔也将为获奖参赛作品上线运行提供更多维的算力支撑，搭载英特尔 ARC dGPU 显卡的运行环境后续将开放给大赛开发者实现项目落地。</p><p>&nbsp;</p><p>通过本次挑战赛，开发者们不仅可以充分展示自己的才华和创新能力，同时也能够获得更多的机会和支持。有兴趣的开发者们，不妨立即行动起来，前往 PICO 官网开放平台赛事专区（<a href=\"https://www.picoxr.com/cn/2023picodevjam/#/introduce?trackingFlag=EkWdMubc\">链接</a>\"），报名参加这场挑战赛。</p>",
    "publish_time": "2023-09-26 08:44:05",
    "source": {
      "name": "infoq_recommend",
      "desc": "InfoQ推荐",
      "icon": "https://raw.githubusercontent.com/maguowei/today/master/imgs/icon/infoq.png"
    }
  },
  {
    "title": "首个千亿医药对话大模型来了，要打破医药研发“三十定律”",
    "url": "https://www.infoq.cn/article/0higrDEDX6Zs81dXCaSf",
    "summary": "<p>10年时间，投入超10亿美金，但成功率只有10%——这是医药研发领域的“三十定律”。从某种程度来说，它像是医药行业的一个“魔咒”。</p><p></p><p>一个药物在正式上市之前，需要经过立项调研、早期药物发现、早期临床前研究、临床试验药物重定位等各个流程。对于药企而言，整个过程存在三大痛点：第一，信息繁杂，对专家依赖度极高；第二，探索空间有限，湿实验（*注）迭代慢；第三，投入成本高，失败风险大。</p><p></p><p>为了打破这个“魔咒”，近日水木分子发布了新一代对话式药物研发助手ChatDD&nbsp;(Drug&nbsp;Design)&nbsp;和全球首个千亿参数多模态生物医药对话<a href=\"https://www.infoq.cn/article/Joe403tMlSW3gHQVOHTm\">大模型</a>\"ChatDD-FM&nbsp;100B。其中，ChatDD&nbsp;能够在立项、临床前研究、临床试验各环节提供服务，预计将于10月中下旬邀请基础版本内测；ChatDD-FM&nbsp;100B在C-Eval评测中达到全部医学4项专业第一，是唯一在该4项评测中平均分超过90分的模型。</p><p></p><h3>从人工炼药到人机交互，医药研发经历四个阶段</h3><p></p><p></p><p>回顾研发模式的发展历程，<a href=\"https://www.infoq.cn/article/Bydle1aR2REAdNOLVOrC\">水木分子</a>\"首次定义了医药研发的四个阶段：</p><p></p><p>第一阶段称为TMDD（Traditional&nbsp;Manual&nbsp;Drug&nbsp;Design），从远古时代一直持续到19世纪末，主要以手工合成、提取和筛选为主，基于大量试验、错误和经验主义，缺点是低通量、缺乏系统性、耗时长且成本高；</p><p></p><p>第二阶段称为CADD（Computer-Aided&nbsp;Drug&nbsp;Design），从20世纪中叶到21世纪初，计算机的出现开始辅助加速药物发现和设计，底层有物理化学规则做支持，在一定程度上实现了高通量，但是计算机只具有工具属性，因此只能解决单个问题，在研究过程中，仍然在很大程度上依赖研究人员经验；</p><p></p><p>第三阶段称为AIDD（AI&nbsp;Drug&nbsp;Design），从21世纪初至今，人工智能技术的成熟发展和应用，开始改变药物研发，研究人员可以从训练数据中挖掘药物发现和设计，优点是能够满足超高通量，实现流程化，但是缺乏模型与专家交互，依赖大规模高质量标注数据，面临信息与知识分离，工具服务分散，处理模态单一等挑战；</p><p></p><p>第四阶段称为ChatDD（Chat&nbsp;Drug&nbsp;Design），即基于当下的大模型能力，对多模态数据进行融合理解，与专家自然交互人机协作，重新定义药物研发模式。</p><p></p><p>在整个过程中，每个阶段的技术革新都带来了不同程度的效率提升和科学发展，为药物研发带来了新的机遇和挑战。“但是，目前市场上至少还有超过&nbsp;1/&nbsp;3&nbsp;的药还是通过TMDD研发设计的。”清华智能产业研究院（AIR）首席研究员、水木分子首席科学家聂再清教授表示，这正是如今医药研发周期长、投入大、风险高很重要的原因。</p><p></p><p>虽然计算机、人工智能技术能够起到一定的研发辅助作用，但是仍然停留在工具阶段，研发过程很难摆脱对专家的知识依赖。“并且专家的知识储备也是有限的，无法掌握所有的文章、专利、数据。我们认为，把专家知识与大模型知识联结，二者进行协作，这才是药物研发现在和未来应该有的模式。”聂再清教授强调。</p><p></p><p>除此之外，利用此前的技术辅助医药研发还面临两个挑战：一方面，海量的实时<a href=\"https://www.infoq.cn/news/oZkw8G2uXvv2oVNJ7XFm\">数据</a>\"散落在各处；另一方面，生物医药涉及大量细分领域，每个领域需要配备对应工具，这些工具的使用门槛和成本也相对较高。“这也是我们发布ChatDD的原因，希望通过一个自然语言的交互界面，能够把专家从繁琐的数据处理和工具使用工作当中解放出来，把更多的精力放在更加开创性的、更有价值的工作上。”</p><p></p><h3>搞定立项、临床前研究、临床试验难题，ChatDD的三个场景应用</h3><p></p><p></p><p>水木分子在此次发布会上展示了&nbsp;ChatDD的在医药研发环节的三个具体应用场景，包括ChatDD-BI&nbsp;立项场景、ChatDD-Discovery研发探索场景和ChatDD-Trail&nbsp;临床试验场景应用。&nbsp;&nbsp;</p><p></p><p>ChatDD-BI：辅助立项调研</p><p></p><p>和仿制药生产制造不同，在药物研发过程中，立项环节极为重要，甚至一个错误的决定都可能导致巨大的经济损失。</p><p></p><p>在传统模式下，这一工作存在三个主要痛点：第一，信息繁杂，涉及对大量数据的搜集、整理和分析，比如病人需求、疾病机制、医药行业现状、专利和文献检索等等，并且这些数据散落各处，收集难度大、耗费时间长，一份高质量的立项报告的输出需要专家投入大量精力。第二，这一工作是非标准化的，对专家依赖极高，还存在信息不全面的问题，可能对项目的决策和发展产生负面影响。第三，立项涉及企业商业秘密难以外包，这也增加了信息搜集的难度。</p><p></p><p>针对这一问题，ChatDD-BI的角色是作为立项助手，通过与专家的数轮对话辅助立项调研，从而提升立项的效率和质量。</p><p></p><p>ChatDD-Discovery&nbsp;：启发研发灵感，提高工具使用效率和体验</p><p></p><p>针对临床前研究场景，传统的做法是做湿实验，然后根据结果不断迭代。但是随着时间的推移，找到针对已知靶点的药物越来越难。因此，科学家们需要更大的探索空间来寻找新的靶点和治疗方案。&nbsp;对此，水木分子认为，大模型的<a href=\"https://www.infoq.cn/article/TSJbOkWweAvFh44Oo2dL\">幻觉</a>\"在科学研究探索性中可能会带来“意外”的灵感。&nbsp;</p><p></p><p>以针对渐冻症治疗方案的探索场景为例，研发人员可以通过对话获得“渐冻症”疾病画像，包含疾病的描述、已有治疗方案等等，如下图：</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/d0/d06fc8de62c99ce371fc91dbf7a746e8.png\" /></p><p></p><p>同时，ChatDD还会通过查询外部数据库，如ClinicalTrails，给出渐冻症在研药物进展。&nbsp;以“利司扑兰”为例，研发人员可以利用ChatDD进一步探究其作用靶点，ChatDD找到利司扑兰的作用靶点“SMN2”，通过建立疾病、靶点、药物之间的潜在链条关系，发现并建议“SMN2是渐冻症的潜在靶点，可进行下一步探究探索”。根据已发表的多项研究成果，证明了ChatDD推断的合理性。</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/f8/f8a8b1ce54aa8d167fb0ffdc2f68e7a0.png\" /></p><p></p><p><img src=\"https://static001.geekbang.org/infoq/c9/c9e7e0b87173bb4289b50245431e387b.png\" /></p><p></p><p>除了“灵感激发”之外，ChatDD-Discovery同样可以提高研究人员的研发效率。在医药研发过程中，研究人员需要查询大量文献和检索专利等，这需要高频使用各种工具，学习成本高且难以与专家知识互动融合。而ChatDD-Discovery采用自然语言交互方式，将专家知识模型参数化，只需简单回答问题，就能使用虚拟筛选功能，使研究人员更高效地完成任务。</p><p></p><p>值得一提的是，ChatDD-Discovery&nbsp;研发助手可以处理生物医药多模态数据，如分子、蛋白质、基因序列以及多样的生物医药下游任务，如DDI（药物-药物相互作用计算）、亲和力计算、药物敏感性预测、单细胞类型注释等。&nbsp;例如，输入分子式ChatDD-Discovery就可以生成该分子的完整描述信息，并且支持用户针对该分子进行进一步提问。</p><p></p><p>ChatDD-Trial：提高临床试验成功率</p><p></p><p>在药物研发的全流程中，临床试验是耗资最多、风险最大的那一环，因此，想要打破“三十定律”，提高临床试验成功率是重中之重。换个角度来看，由于成本巨大，所以，在这个环节只要有一点点的提升，就能带来可观的经济效益。</p><p></p><p>对此，水木分子ChatDD目前主要关注四个小场景：药物生物标记物发现、临床试验入组设计、临床试验报告撰写、药物重定位和适应症扩展。</p><p></p><p>比如，ChatDD-Trial可以辅助临床试验研究人员找到最适合入组的患者人群；比如，通过发现药物敏感的生物标志物，更好地理解疾病亚型，实现精准的患者分类，确保患者与试验药物更匹配，减少不必要的变量干扰，提高临床试验成功率；再比如，作为临床试验设计助手，帮助研究团队优化试验设计，通过分析大量的相关数据，提供有关患者选择、临床试验阶段和标准化流程的建议，确保试验的科学性和可行性，减少不必要的误差和风险。</p><p></p><p>据聂再清教授介绍，目前ChatDD提供了三类服务方式：一是订阅服务，支持企业账户；二是API服务，支持高速推理服务，提供开发者培训；三是私有化部署，支持本地数据微调，定制场景方案。</p><p></p><h3>三级淬炼出千亿级生物医药行业大模型</h3><p></p><p></p><p>ChatDD的底层，基于的是水木分子千亿参数多模态<a href=\"https://xie.infoq.cn/article/7edc5aaa592a490f71b758299\">生物医药</a>\"对话大模型ChatDD-FM。</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/db/dbde600079d32101cfb662330be99d95.png\" /></p><p></p><p>上图是ChatDD-FM多模态生物医药大模型的架构图：首先，对生物医药垂直领域的知识图谱、分子、蛋白质、单细胞测序、文本等多模态进行编码；然后，将各种不同模态对齐到统一的特征空间，进行模态融合、专业领域指令微调；最后，在产品端支撑ChatDD-BI、ChatDD-Discovery和ChatDD-Trail&nbsp;三大应用。</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/ec/ecc9f2becb64d9eebae23b16ef3190cf.png\" /></p><p></p><p>水木分子首席技术官、联合创始人乔木博士强调，ChatDD-FM是一个灵活、可扩展的架构，在当下版本基础上，还可以持续增加其它不同模态。而对于用户而言，可以通过自然语言对话方式与大模型进行交互。其背后，是ChatDD-FM对数千篇中英文生物医药文献、千万级通用场景对话、数十万个工具调用指令集等高质量数据的预训练，以及指令微调和智能工具调用。</p><p></p><p>水木分子由AIR孵化，在今年6月份成立，主要专注于生物医药垂直行业大模型的研发与应用。而早在今年4月，聂再清教授团队就已经开源了生物医药版GPT&nbsp;BioMedGPT1.6B，从研究层面验证了将文献、分子、蛋白、测序、知识图谱等数据压缩到统一的多模态大模型框架内，可使模型具备“融会贯通”的能力，在分子性质预测、药物-靶点亲和力预测、性质预测、药物敏感性预测、分子-文本跨模态检索、分子-文本跨模态信息生成等多项任务上优于单一专用模型，从研究层面验证了技术可行性。</p><p></p><p>8月，水木分子又开源了全球首个可商用的百亿级参数规模多模态生物医药大模型BioMedGPT-10B。其中，首次提出了分子QA和蛋白质QA任务，给定特定分子/蛋白质，可以用自然语言回答相关功能、属性等问题，有效评估模型在自然语言和生物编码语言之间的翻译能力。</p><p></p><p>据聂再清教授介绍，虽然BioMedGPT已经实现商用，但由于是科研项目，所以使用的仍然是英文界面，中文对话能力较弱，因此在国内市场实现商用普及有限。这便是水木分子成立背后的原因之一。</p><p></p><p>“接下来，BioMedGPT&nbsp;仍然会继续往前推进，作为科研品牌继续开源。而此次ChatDD和ChatDD-FM的孵化，则是大模型都科研迈向产业化，是产学研结合的关键一步。”聂再清教授强调，“我们认为大模型未来必将成为&nbsp;AI&nbsp;时代的操作系统，就像我们PC时代的Windows，移动互联时代的Android、iOS。而现在我们正在做的生物医药大模型，未来在整个AI&nbsp;for&nbsp;science领域都有可能用上。对此，我们充满了期待。”</p><p></p><p>而现下，ChatDD和ChatDD-FM的发布，已然重新定义了医药研发模式，不仅可以提高研究人员的工作效率，还可以为研发新药提供更多的可能性。未来，随着技术的持续迭代革新，医药研发的效率和成功率将会得到显著提高，打破“三十定律”的“魔咒”指日可待。</p><p></p><p></p><blockquote>*注：“湿”实验指的是将待测样本利用实验室方法进行核酸提取、文库构建（包括片段化、富集、扩增等一系列过程）到完成上机测序的实验过程；“干”实验则是从得到下机数据开始，到完成生信分析和报告解读的整个过程。</blockquote><p></p>",
    "publish_time": "2023-09-26 10:15:56",
    "source": {
      "name": "infoq_recommend",
      "desc": "InfoQ推荐",
      "icon": "https://raw.githubusercontent.com/maguowei/today/master/imgs/icon/infoq.png"
    }
  },
  {
    "title": "欧伟杰博士：突破算力边界！YashanDB 实现理论与工程双重突围",
    "url": "https://www.infoq.cn/article/Bmx2CIoj4icEQgzeghdz",
    "summary": "<p>随着数字化进程的加速，数据处理的规模和速度需求持续攀升。传统数据库系统在处理大规模数据时，存在单表记录数不超过 500 万条的限制，这已成为业务发展的瓶颈。为了解决此问题，分布式数据库通过横向扩展来分担单节点的压力。然而，随着数据规模的增长，数据库节点的数量也会增加，这会导致成倍增长的运维问题和对 IT 运维工作的需求。</p><p></p><p>同时，移动互联网、智能设备、汽车和物联网终端的发展，对并发访问和响应时间提出了更高的要求。现有的解决方案通常基于独立的内存缓存来满足热点数据的读写需求，然而由于缓存容量有限且热点数据不在数据库中，导致无法参与统计分析，数据的价值没有得到充分利用，仍然存在优化空间。</p><p></p><p>除此之外，随着大数据应用场景的快速普及与创新业务的发展，传统的数据管理方案已愈发难以满足海量数据实时分析的需求。实时应用、高通量在线交易和实时分析等混合负载的场景成为业务的基本诉求。</p><p></p><p>面临这些新的挑战，我们认为有以下三个核心命题要去回答：</p><p></p><p>如何在不消耗大量算力资源的情况下，低成本地满足海量数据的计算要求？如何设计一个高效、易用的数据库系统来满足不同的业务诉求？如何避免差异化实现，高效构建一个统一行列存、混合负载的架构？</p><p></p><p>本文将从理论和工程两方面分享由“0”构建全自研数据库系统 YashanDB 的设计理念与背后思考，并试图回答上述的几个关键问题，与大家共同探讨面向未来数据库技术创新之道。</p><p></p><p></p><h1>有界理论打破大数据算力增长挑战</h1><p></p><p></p><p>关系代数理论诞生于上世纪 80 年代，为关系数据库系统奠定了基础。但是随着数据规模的不断增长，传统的数据库无法解决的问题越来越多。</p><p></p><p>因此，人们重新定义了大数据及其基于并行计算的解决方案。这种方案的核心理念是通过大量的计算资源来满足数据的计算需求。然而，计算资源的增长速度远远跟不上数据的增长速度，同时，数据库节点数量和运维复杂度也呈指数级增长，这成为大数据处理所面临的一项关键挑战。</p><p></p><p>但通过观察具体业务不难发现一个现象，绝大部分查询涉及的数据量与全量数据相比是微乎其微的，如果能针对查询找出一个特定的，包含所有正确结果的小数据集，那么就可以节省大部分针对无关数据的扫描和计算开销，这正是有界计算的出发点。</p><p></p><p>有界计算的关键挑战是如何避免数据扫描而找出查询相关的小数据集。首先需定义一个概念为“访问约束”，其意义为对于特定的 X 取值，其对应的 Y 的取值有且仅有 N 种可能，这里的 N 可理解为通过已知的 X 找到对应 Y 的边界。例如在知道某位同学对应班级的前提下，这位同学的 ID 取值不可能超过班级最大人数。</p><p></p><p>这种属性之间的语义在关系理论中并没有被识别和利用，下面我们通过一个简单的例子看下如何运用访问约束来解决查询问题，直观感受有界计算与传统方法的差异：我们想找出 2019 年 5 月份我朋友在 NYC 去过的餐馆的价位。</p><p></p><p>按传统方式需要将朋友关系表 friend 和就餐表 dine 进行连结后再通过餐馆信息表 cafe 找出其价格，但这样就涉及大量数据扫描和连结计算开销巨大，即使使用索引替代全表扫描也会因为随机 IO 使得提升有限。</p><p></p><p>而有界计算通过特定属性间的访问约束（Access Constraint），仅需要访问三个有限的小数据集，避免了大量无关数据之间的计算。</p><p></p><p><img src=\"https://static001.infoq.cn/resource/image/da/ee/daca7e24a62d7e31a078b1ba6583b6ee.png\" /></p><p></p><p>例子中提到的访问约束是基于 YashanDB 列式存储引擎实现的。将特定 X 取值对应的 Y 连续存储，可以基于轻量化算法实现去重和压缩，并在计算时还原原始取值确保语义完整。用户执行查询时优化器根据已有访问约束判断能否实现查询加速，无需人工干预或修改 SQL 语句。与此同时，访问约束也不是一成不变的，对于持续变化的业务数据，可以在业务运行过程中不断刷新已有访问约束，我们发现其维护成本远低于物化视图。</p><p></p><p>有界计算适用于记录中存在大量重复信息的详单分析场景，其原型实现已在电信详单管理和北美航空记录分析两个真实场景中完成验证，最大加速效果可达到 10000 倍。基于有界计算可以大大降低大数据分析的算力要求，拓展数据库系统的能力边界。该理论也获得了 2018 年的 Royal Society Wolfson Research Merit Award（英国皇家学会沃夫森研究优秀奖）。</p><p></p><p></p><h1>自主技术架构：面向混合负载的存储与 SQL 技术</h1><p></p><p></p><p>随着通信和互联网技术的不断发展，业务对数据管理的实时性要求持续提升。传统数据库受制于软硬件处理能力限制，将交易型操作和分析型查询分而治之，带来了数据分析的滞后性和数据库运维上的复杂性。</p><p></p><p>对于新型业务而言更强调混合负载实时数据管理的能力，这也需要数据库系统在存储引擎到 SQL 引擎上采用新的技术与架构。下面我们将详细介绍 YashanDB 如何从混合存储及 SQL 执行两方面实现混合负载能力的。</p><p></p><p></p><h3>混合引擎架构</h3><p></p><p></p><p>为了兼顾高并发数据访问和实时数据分析两类截然不同的需求，YashanDB 在存储架构上大胆尝试多种数据组织形式。</p><p>首先是支持面向高并发短事务的行式存储，简称行表（Heap），将一条记录的多个字段连续存储在一起。而作为存储的最小单元，同一个数据块上存储了多条完整记录和对应事务信息，这种方式可以最小化数据访问的开销，并通过支持原地更新进一步降低数据修改的管理成本。</p><p></p><p>另一方面，为了管理海量数据并支持实时分析，YashanDB 还支持冷热分离的列式存储，简称列表（LSC, Large-scale Storage Columnar Table）。与行表最大的差异是，列表将不同记录的相同字段连续存储在一起。由于大部分查询仅用到记录中的部分字段，因此按字段连续存储可以避免整行读取，从而提高 IO 资源利用率。与此同时，同一字段存在重复取值，基于轻量化压缩算法可实现存储空间的成倍缩减。列表相较行表对于写入不太友好，因为一条记录写入可能要访问多个数据块，造成大量 Cache Miss 和额外 IO。</p><p></p><p><img src=\"https://static001.infoq.cn/resource/image/f1/75/f159d710b6e0e8d5ecaec339c655e475.png\" /></p><p></p><p>值得一提的是，存储引擎的能力不仅是数据组织与管理，还包括事务、持久化等。YashanDB 对于上述两类数据组织均提供完整事务和持久化能力，使得针对快速变化数据的高性能分析不再高不可攀。</p><p></p><p>业界在实现行列混合存储方面仍存在一定的优化空间：采用读写存储的内部转换，为了避免数据变化对列存储数据的影响，需要预留数据量两倍的内存空间；如按副本方式分别管理 TP 和 AP 数据，虽然可以在资源上进行隔离，但引入了数据转化的延迟与开销。</p><p></p><p>YashanDB 提出了一份数据上的混合负载能力，在保证完成 ACID 能力的前提下，提供可更新列存数据存储，通过不同的 SQL 执行引擎来同时实现高通量事务处理和低时延复杂查询。其架构如下图所示，主要差异在于数据仅保存一份，所有已提交的变更都可以通过查询反映到结果集中。这里面包含了三个技术点：</p><p></p><p>支持快速更新和查询的列式存储组织，通过 In-place Update 解决数据变更导致的空间膨胀和无效数据回收问题；面向交易和分析负载的差异化需求，通过不同执行模型最大化资源利用率，火山模型支持低时延短事务，向量化模型支持全面扫描数据分析；细粒度配置的资源与调度管理，避免不同类型处理之间的资源争抢和固定配置带来的资源闲置，会话级配置结合业务特征灵活调整。</p><p></p><p><img src=\"https://static001.infoq.cn/resource/image/14/41/14c330ac09ayy4eddc8c1fe679f32e41.png\" /></p><p></p><p></p><h3>SQL 引擎设计与关键优化</h3><p></p><p></p><p>对于 SQL 引擎而言，优化器和执行器对查询性能的影响最为显著。而优化器的复杂度取决于执行器有多少种不同的算子，每种算子代表了一种可能的访问路径。特定算子之间可以根据规则进行优化。</p><p></p><p>YashanDB 的 SQL 引擎为了达到极致性能，同时支持了行列两类算子分别满足低时延短事务和大数据量查询场景的差异化需求。因此优化器的实现挑战要高于传统数据库系统。这里列举了我们实现的三个关键能力：</p><p></p><p><img src=\"https://static001.infoq.cn/resource/image/40/3b/40269e4581yy73ebc8a701a4c2865b3b.png\" /></p><p></p><p>面向差异化代价模型的行列混合评估。针对行列算子建立独立的代码模型，在最优计划选择时考虑行转列或列转行的整体代价，并结合启发式算法提前排除不理想的备选计划，避免搜索空间过大问题。行列统一的并行优化框架。并行计算是 YashanDB 高性能查询重要的能力，而针对行列算子使用一套并行框架也能大大降低优化器的复杂度，避免大量访问路径需要根据算子类型进行差异化实现。这套框架的并行执行单位为 Pipeline，能够支持单算子的并行，在不同 Pipeline 之间需要通过 PX 算子进行数据的交换，PX 算子可以适用于单机和分布式两种场景下的不同交换策略。面向特定模型的动态优化规则。行列统一是 YashanDB 的架构目标，但在具体工程实现过程中由于算子实现难度各异，需要针对行列算子按照特殊规则进行调整。为了避免这类优化影响优化器基本框架，因此 YashanDB 优化器先生成不区分行列的通用计划，再执行前根据行列算子的特点进行动态优化调整。这其中包括部分列算子未实现的内置函数，都可以动态转为行算子来计算，同时提升了优化器的可维护性。</p><p></p><p><img src=\"https://static001.infoq.cn/resource/image/80/ca/809710232d9b36bb1c93c45yy8638aca.png\" /></p><p></p><p>硬件配置：2288 虚拟机（16 核，160G 内存，3.4T SSD）</p><p>软件版本：OS(CentOS 7)，DB(YashanDB 22.2、Oracle 19C Inmemory 、Greenplum 6.17.1)</p><p>测试模型：TPC-H 100G 数据</p><p></p><p>总体来说，SQL 引擎的整体性能和架构的持续演进非常重要，而优化器作为关键能力，需要充分发挥各执行算子的优势，并减少差异化规则带来的实现复杂性。我们正在探索基于深度学习的查询优化，但目前面临冷启动和假阳性等挑战。</p><p></p><p></p><h1>深度兼容性和一键业务迁移</h1><p></p><p></p><p>作为一款面向企业用户的新型全自研数据库系统，YashanDB 需要考虑用户在切换到该系统时所面临的挑战：一方面是业务系统需要改造以适应新的数据库系统，另一方面是数据搬迁过程如何实现平滑可控。</p><p></p><p></p><h3>改造成本</h3><p></p><p></p><p>首先是改造成本，这主要是由于新老数据库在 SQL 语法 / 数据类型 / 存储过程等方面存在差异导致的。YashanDB 从设计之初就确定了 Oracle 全面兼容的目标，这里的全面不止包含 SQL 语法 / 语义、各类数据类型的处理差异，还包括复杂存储过程，触发器以及系统视图等高级能力。另外，我们还考虑到了资深 DBA 习惯使用的一系列运维工具的支持，如 AWR 和 RMAN 等。在对 Oracle 的兼容性设计中，每一个细节都需要反复论证和推敲，避免全盘照搬导致泥沙俱下，以下是一个 Oracle 的例子。</p><p></p><p><img src=\"https://static001.infoq.cn/resource/image/46/34/46b3d357a11c7985d63177ef6a072934.png\" /></p><p></p><p>前两条语句结果证明在 Oracle 内核中，绑定参数没有同名加载机制，即使命名均为:B1，也都是按位置加载. 最后一条语句可以运行即证明并非所有场景都是按位置加载，猜测 Oracle 为了避免存储过程无法使用 GROUP BY 语句，对按位置加载的绑定参数原则，做了特殊“优化”，这类“优化”在语义表达上会让用户困惑。</p><p></p><p></p><h3>数据迁移</h3><p></p><p></p><p>其次是数据迁移。数据迁移的目标不仅仅是简单的数据导入 / 导出，而是基于业务设计的全自动化处理。YashanDB 的自动化迁移平台具备业务兼容性评估、一键数据迁移和数据完整性校验等功能。</p><p></p><p>业务兼容性评估为迁移计划提供必要的输入，识别当前数据库系统无法兼容的对象和 SQL 语句，并给出改造建议；一键数据迁移可以满足存量数据搬迁和实时增量同步两类需求，目前支持Oracle/MySQL/PostgreSQL 数据库系统；数据完整性校验可以避免数据迁移在异常情况下的数据丢失 / 错误，自动识别并可在人工指导下自动修补错失数据，从而大大提升迁移的可靠性。</p><p></p><p></p><h3>写在最后</h3><p></p><p></p><p>随着数据规模的爆发式增长，我们创新性地将有界计算理论转化系统能力，在不消耗大量算力资源的情况下能够低成本地满足海量数据的计算要求。</p><p></p><p>同时随着数字化转型的持续深入, 很多客户都提出了数据驱动的实时业务决策，这要求数据库能够满足混合负载，兼顾高通量数据变更和实时查询，因此我们设计了一套统一行列存、混合负载的架构。同时充分考虑用户在切换到该系统时所面临的挑战，实现了高度的商业数据库兼容性，极大地降低了应用改造迁移成本。</p><p></p><p>当然我们不仅要考虑当前的需求，还要为未来的需求做好准备。那随着 AI 等技术的快速发展，我们认为智能化机遇将会给数据库带来重大变革：</p><p></p><p>首先，面向大模型场景，数据库管理的对象已经不再是关系表，而是 Embeddings 向量，这类对象的计算方式更复杂，且具有不可解释性，前景非常广阔。另一方面，机器学习也可以将传统数据库调优这类只有资深 DBA 才能搞定的任务变成固定的模型，大大降低了数据库的运维门槛；此外，NLP2SQL 在大模型的赋能下让更多用户可以使用大数据分析。</p><p></p><p>未来，我们将持续探索更多创新技术的可行性和落地方案，拓宽数据库应用的广度和深度，为更多企业的数字化转型提供有力支撑。</p><p></p><p>作者介绍</p><p></p><p>欧伟杰，武汉大学博士，深圳计算科学研究院 YashanDB 研发总监。10 年以上数据库内核设计与开发经验，多篇顶级会议论文及技术专利。作为创始成员之一加入 YashanDB 团队，负责 YashanDB 的架构设计与内核研发，从零到一打造全自研数据库产品在多行业落地应用。</p><p></p><p>关于 FCon</p><p></p><p>FCon 上海 2023，相约 11 月！现在购票，前 100 人可享 5 折特惠购票，咨询购票请联系：17310043226（微信同手机号）。</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/a8/a8ec7f7fb25c7949931b2b8a5deffddd.png\" /></p><p></p>",
    "publish_time": "2023-09-26 11:02:36",
    "source": {
      "name": "infoq_recommend",
      "desc": "InfoQ推荐",
      "icon": "https://raw.githubusercontent.com/maguowei/today/master/imgs/icon/infoq.png"
    }
  }
]