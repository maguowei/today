[
  {
    "title": "Terraform Plugin Framework现已正式发布",
    "url": "https://www.infoq.cn/article/2s1GX5W16EzNqPzjA8Uy",
    "summary": "<p>HashiCorp<a href=\"https://www.hashicorp.com/blog/terraform-plugin-framework-is-now-generally-available\">发布</a>\"了<a href=\"https://developer.hashicorp.com/terraform/plugin/framework?_gl=1*dfzoyc*_ga*MjExNzMxNzQyMy4xNjYzODk4MDA0*_ga_P7S46ZYEKW*MTY3MzA1NTY1NC4zOC4xLjE2NzMwNTU3MDQuMC4wLjA.\">Terraform Plugin Framework</a>\"的1.0版本。该框架改进并取代了<a href=\"https://developer.hashicorp.com/terraform/plugin/sdkv2\">Terraform Plugin SDKv2</a>\"。它包括对验证器、路径表达式、嵌套属性、资源私有状态管理和自定义类型的支持。新框架中的提供者程序是用Go编写的可执行二进制文件。</p><p></p><p>Terraform插件通过RPC（远程过程调用）与Terraform Core一起工作。插件可用于公开特定服务（如云资源、SaaS平台或API）的实现。根据<a href=\"https://www.linkedin.com/in/bflad/\">Brian Flad</a>\"、<a href=\"https://www.linkedin.com/in/bookshelfdave/\">Dave Parfitt</a>\"和<a href=\"https://www.linkedin.com/in/vishnuravindra/\">Vishnu Ravindra</a>\" 的说法，新框架是对之前的Terraform Plugin SDKv2的改进包括：</p><p></p><p>插件框架的代码更易于维护和未来验证，它将作为未来Terraform插件开发特性和工具的基础。</p><p></p><p>该版本包括许多预构建的<a href=\"https://developer.hashicorp.com/terraform/plugin/framework/validation\">验证器</a>\"，它们可以向用户提供关于语法、类型和可接受值的反馈。例如，用于检查字符串长度或确保数字在有效范围内的验证器。预构建的验证器可以在Go模块  terraform-plugin-framwork-validators中找到。</p><p></p><p>可以使用框架定义的泛型类型对属性进行验证。Validators字段应该提供一个验证列表，如下例所示：</p><p></p><p><code lang=\"plain\">schema.StringAttribute{\n    //……其他属性配置……\n    Validators: []validator.String{\n        // 这些是来自terraform-plugin-framework-validators的示例验证器\n        stringvalidator.LengthBetween(10, 256),\n        stringvalidator.RegexMatches(\n            regexp.MustCompile(`^[a-z0-9]+$`),\n            \"must contain only lowercase alphanumeric characters\",\n        ),\n    },\n}\n</code></p><p></p><p><a href=\"https://developer.hashicorp.com/terraform/plugin/framework/handling-data/path-expressions\">路径表达式</a>\"允许将属性之间的关系指定为相对路径。这些可以表示模式或基于模式的数据内的一个或多个实际路径。相对路径表达式是<a href=\"https://pkg.go.dev/github.com/hashicorp/terraform-plugin-framework/path#MatchRelative\">使用path.MatchRelative()函数启动的</a>\"。</p><p></p><p><a href=\"https://developer.hashicorp.com/terraform/plugin/framework/resources/private-state\">资源私有状态管理</a>\"允许数据与状态一起存储，但会在Terraform计划中删除。HashiCorp建议，这可以用于存储和检索不需要向用户显示的值，例如API调用的ETag。提供者程序能够在创建、导入、规划、读取和更新操作期间保存这些数据。可以在执行删除、计划、读取和更新等操作期间读取数据。私有状态数据可以使用 GetKey 函数读取：</p><p></p><p><code lang=\"plain\">func (r *resourceExample) Read(ctx context.Context, req resource.ReadRequest, resp *resource.ReadResponse) {\n    \n    value, diags := req.Private.GetKey(ctx, \"key\")\n    \n    resp.Diagnostics.Append(diags...)\n    \n    if value != nil {\n        //值为[]byte.\n        ... \n    }\n}\n</code></p><p></p><p>虽然还会继续支持Terraform Plugin SDKv2，但HashiCorp已经表示，新的Terraform Plugin Framework将会获得新功能和工具的优先权。可以使用迁移指南将插件从Terraform Plugin SDKv2迁移到新的Terraform Plugin Framework。</p><p></p><p>基于插件框架的提供者程序可以向后兼容Terraform 0.12及更高版本。也可以选择使用新的<a href=\"https://developer.hashicorp.com/terraform/plugin/how-terraform-works#terraform-plugin-protocol\">Terraform Plugin Protocol</a>\"版本6。这将允许访问Terraform 1.x版本中的最新功能。有关该版本的更多详细信息，可以在<a href=\"https://www.hashicorp.com/blog/terraform-plugin-framework-is-now-generally-available\">博客文章</a>\"或<a href=\"https://www.terraform.io/plugin/framework?_gl=1*1heuu30*_ga*MjExNzMxNzQyMy4xNjYzODk4MDA0*_ga_P7S46ZYEKW*MTY3MzIxNzA0MS4zOS4wLjE2NzMyMTcwNDEuMC4wLjA.\">快速上手页面</a>\"上找到。</p><p></p><p>作者介绍：</p><p>Matt领导InfoQ的DevOps编辑团队。他是教育技术公司D2L的云平台副总裁，负责其基础设施和云平台团队。他关注的领域是DevOps和SRE，并在企业规模上实施这些。</p><p></p><p>原文链接：</p><p><a href=\"https://www.infoq.com/news/2023/01/terraform-plugin-framework/\">HashiCorp Terraform Plugin Framework Now Generally Available</a>\"</p><p></p><p>相关阅读：</p><p><a href=\"https://www.infoq.cn/article/t1OYQuveBtsjPBr6ETdx\">Terraform 1.3，简化重构体验</a>\"</p><p><a href=\"https://www.infoq.cn/article/kwb3BDFQ5UulqcLYrko7\">Cloud Development Kit：使用TypeScript和Python生成Terraform配置</a>\"</p><p><a href=\"https://www.infoq.cn/article/pVtFe1GoAuSYVCMNhii9\">如何将基础设施自动导入 Terraform ？</a>\"</p>",
    "publish_time": "2023-01-25 08:00:00",
    "source": {
      "name": "infoq_recommend",
      "desc": "InfoQ推荐",
      "icon": "https://raw.githubusercontent.com/maguowei/today/master/imgs/icon/infoq.png"
    }
  }
]