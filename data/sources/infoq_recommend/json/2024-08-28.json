[
  {
    "title": "Slack发布用于Kubernetes StatefulSet部署的Operator",
    "url": "https://www.infoq.cn/article/Nqll8FcgQLNYbvGtJ1rE",
    "summary": "<p><a href=\"https://slack.com/?accessToken=eyJhbGciOiJIUzI1NiIsImtpZCI6ImRlZmF1bHQiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE3MjQ3MjQxNDYsImZpbGVHVUlEIjoiUjEzamRRakJwMmZyNzhrNSIsImlhdCI6MTcyNDcyMzg0NiwiaXNzIjoidXBsb2FkZXJfYWNjZXNzX3Jlc291cmNlIiwidXNlcklkIjo1MDA3OTA2fQ.nbnam2hbkFyplnUaFoqGJTolnjxlQTmmqtmW5T5-Qzg\">Slack</a>\"开发了一个定制的<a href=\"https://www.infoq.com/articles/kubernetes-operators-in-depth/?accessToken=eyJhbGciOiJIUzI1NiIsImtpZCI6ImRlZmF1bHQiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE3MjQ3MjQxNDYsImZpbGVHVUlEIjoiUjEzamRRakJwMmZyNzhrNSIsImlhdCI6MTcyNDcyMzg0NiwiaXNzIjoidXBsb2FkZXJfYWNjZXNzX3Jlc291cmNlIiwidXNlcklkIjo1MDA3OTA2fQ.nbnam2hbkFyplnUaFoqGJTolnjxlQTmmqtmW5T5-Qzg\">Kubernetes Operator</a>\"，旨在克服管理<a href=\"https://www.infoq.com/articles/kubernetes-stateful-applications/?accessToken=eyJhbGciOiJIUzI1NiIsImtpZCI6ImRlZmF1bHQiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE3MjQ3MjQxNDYsImZpbGVHVUlEIjoiUjEzamRRakJwMmZyNzhrNSIsImlhdCI6MTcyNDcyMzg0NiwiaXNzIjoidXBsb2FkZXJfYWNjZXNzX3Jlc291cmNlIiwidXNlcklkIjo1MDA3OTA2fQ.nbnam2hbkFyplnUaFoqGJTolnjxlQTmmqtmW5T5-Qzg\">StatefulSet部署</a>\"时的限制。在Slack的工程博客上，Clément Labbe（高级云计算工程师）介绍了<a href=\"https://slack.engineering/kube-stateful-rollouts/?accessToken=eyJhbGciOiJIUzI1NiIsImtpZCI6ImRlZmF1bHQiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE3MjQ3MjQxNDYsImZpbGVHVUlEIjoiUjEzamRRakJwMmZyNzhrNSIsImlhdCI6MTcyNDcyMzg0NiwiaXNzIjoidXBsb2FkZXJfYWNjZXNzX3Jlc291cmNlIiwidXNlcklkIjo1MDA3OTA2fQ.nbnam2hbkFyplnUaFoqGJTolnjxlQTmmqtmW5T5-Qzg\">Bedrock Rollout Operator</a>\"，开发这个Operator的初衷是为了提供更精细的控制和增强功能，优化在Kubernetes集群中部署有状态应用程序的过程。</p><p></p><p>工程师通常使用StatefulSet来运行需要持久存储和具有唯一Pod标识的应用。然而，Slack的工程团队发现，现有的StatefulSet更新策略存在一些局限性。默认的<a href=\"https://kubernetes.io/docs/tutorials/kubernetes-basics/update/update-intro/?accessToken=eyJhbGciOiJIUzI1NiIsImtpZCI6ImRlZmF1bHQiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE3MjQ3MjQxNDYsImZpbGVHVUlEIjoiUjEzamRRakJwMmZyNzhrNSIsImlhdCI6MTcyNDcyMzg0NiwiaXNzIjoidXBsb2FkZXJfYWNjZXNzX3Jlc291cmNlIiwidXNlcklkIjo1MDA3OTA2fQ.nbnam2hbkFyplnUaFoqGJTolnjxlQTmmqtmW5T5-Qzg\">RollingUpdate</a>\"策略虽然实现了自动化更新，但一次只更新一个Pod，在处理拥有大量Pod的应用程序时会导致部署过程变得相当缓慢。OnDelete策略虽然提供了手动控制的灵活性，但缺少像基于百分比的滚动更新这样的高级功能。</p><p></p><p>Slack使用<a href=\"https://github.com/kubernetes-sigs/kubebuilder?accessToken=eyJhbGciOiJIUzI1NiIsImtpZCI6ImRlZmF1bHQiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE3MjQ3MjQxNDYsImZpbGVHVUlEIjoiUjEzamRRakJwMmZyNzhrNSIsImlhdCI6MTcyNDcyMzg0NiwiaXNzIjoidXBsb2FkZXJfYWNjZXNzX3Jlc291cmNlIiwidXNlcklkIjo1MDA3OTA2fQ.nbnam2hbkFyplnUaFoqGJTolnjxlQTmmqtmW5T5-Qzg\">Kubebuilder</a>\"开发了Bedrock Rollout Operator，以满足其内部团队对于更高效部署的需求。这个Operator负责管理一个叫作StatefulsetRollout的自定义资源，封装了StatefulSet规范以及用于增强功能的附加参数。</p><p></p><p>Bedrock Rollout Operator解决了几个基本问题：</p><p></p><p>部署缓慢：它突破了默认RollingUpdate策略的局限，这个策略一次只更新一个Pod，对于拥有许多Pod的应用程序来说效率低下。</p><p>控制不足：它提供了比原生Kubernetes更精细可控的滚动更新机制，允许进行更快的基于百分比的更新，并能够暂停更新。</p><p>回滚能力有限：它在必要时提供了更为迅速的回滚选项。</p><p>集成差距：它与Slack的内部服务发现（Consul）集成，并通过Slack发送滚动更新状态通知，填补了现有工作流的空白。</p><p>定制需求：它允许Slack实现符合其特定需求的自定义滚动逻辑，而标准的Kubernetes功能未能满足这些需求。</p><p>可见性：通过实时的Slack通知和与内部发布管理UI的集成，提高了滚动更新过程的可见性。</p><p>大规模管理：尽管需要做一些调整，但该解决方案有效支持管理多达1000个Pod的大型StatefulSet部署。</p><p></p><p>该Operator已成功部署在Slack庞大的Kubernetes基础设施中，覆盖了200多个集群，并有效管理着近100个有状态服务。</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/fd/fd3c3fcdbba0acf7e699fa477e1b8720.webp\" /></p><p>滚动更新过程从Slack工程师在bedrock.yaml文件中定义他们的应用配置开始。当开发人员通过Slack的内部发布平台启动部署时，Bedrock API将这个配置转换为StatefulsetRollout资源。</p><p></p><p>Bedrock Rollout Operator持续监控StatefulsetRollout资源，确保期望状态与集群的实际状态保持一致。它负责执行创建或更新StatefulSet和终止Pod等操作以实现滚动更新。与事件驱动方式不同，这个Operator采用了自排队协调循环机制。这种方法可以确保按顺序处理自定义资源，减少了竞态条件的发生，简化了整个协调过程。</p><p></p><p>该Operator通过详尽的文本Slack通知向用户实时传达更新情况，包括版本号和正在滚动更新的Pod列表等详细信息。此外，它还与Bedrock API通信，报告滚动更新的成功或失败状态，确保Slack的发布管理UI能够准确反映当前的更新状态。</p><p></p><p>虽然这个自定义Operator已被证明对Slack的需求有效，但也存在一些限制。在处理包含多达1000个Pod的大型StatefulSet部署时出现了一个挑战，需要对通知系统做出调整，以防止因频繁通知而触发的速率限制问题。另一个限制是在对StatefulSet部署采用OnDelete策略时固有的“版本泄露”问题。在滚动更新被暂停或未完全执行的情况下，运行旧版本的Pod因非更新原因而被终止，它们可能会被运行新版本的Pod所替换，这可能导致渐进、无意的全滚动更新。为了缓解这一问题，Slack鼓励团队及时完成他们的滚动更新流程。</p><p></p><p>Slack开发了一个与现有内部系统和通信渠道完美融合的定制解决方案，实现了对StatefulSet部署的更精细的控制。随着Kubernetes的持续演进，其维护者可能会将其中一些功能纳入Kubernetes的核心功能集中。然而，在这一过程中，Operator模型所提供的灵活性和深度集成能力，对于那些有着复杂部署需求和定制化基础设施的组织来说，仍然具有不可估量的价值。</p><p></p><p>Slack计划扩大使用Operator模型来管理Kubernetes部署的策略。他们正在探索现有的CNCF项目，如Argo Rollouts和OpenKruise，这些项目主要针对非有状态部署资源。其他组织也开发了专门用于滚动更新的Operator——例如，Grafana Labs提供了一个<a href=\"https://github.com/grafana/rollout-operator?accessToken=eyJhbGciOiJIUzI1NiIsImtpZCI6ImRlZmF1bHQiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE3MjQ3MjQxNDYsImZpbGVHVUlEIjoiUjEzamRRakJwMmZyNzhrNSIsImlhdCI6MTcyNDcyMzg0NiwiaXNzIjoidXBsb2FkZXJfYWNjZXNzX3Jlc291cmNlIiwidXNlcklkIjo1MDA3OTA2fQ.nbnam2hbkFyplnUaFoqGJTolnjxlQTmmqtmW5T5-Qzg\">对滚动更新进行更细粒度控制的Operator</a>\"。其他产品，如<a href=\"https://argo-rollouts.readthedocs.io/?accessToken=eyJhbGciOiJIUzI1NiIsImtpZCI6ImRlZmF1bHQiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE3MjQ3MjQxNDYsImZpbGVHVUlEIjoiUjEzamRRakJwMmZyNzhrNSIsImlhdCI6MTcyNDcyMzg0NiwiaXNzIjoidXBsb2FkZXJfYWNjZXNzX3Jlc291cmNlIiwidXNlcklkIjo1MDA3OTA2fQ.nbnam2hbkFyplnUaFoqGJTolnjxlQTmmqtmW5T5-Qzg\">Argo Rollouts</a>\"也提供了类似的功能，另外还提供了蓝绿部署、金丝雀部署、金丝雀分析、实验和渐进式交付功能，但主要专注于Deployment资源。<a href=\"https://docs.flagger.app/usage/deployment-strategies?accessToken=eyJhbGciOiJIUzI1NiIsImtpZCI6ImRlZmF1bHQiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE3MjQ3MjQxNDYsImZpbGVHVUlEIjoiUjEzamRRakJwMmZyNzhrNSIsImlhdCI6MTcyNDcyMzg0NiwiaXNzIjoidXBsb2FkZXJfYWNjZXNzX3Jlc291cmNlIiwidXNlcklkIjo1MDA3OTA2fQ.nbnam2hbkFyplnUaFoqGJTolnjxlQTmmqtmW5T5-Qzg\">Flagger</a>\"提供了带有或不带有会话亲和性的金丝雀发布功能，以及蓝绿和A/B测试，以满足类似的需求。<a href=\"https://jstobigdata.com/k8s/understanding-kubernetes-statefulsets-and-best-practices/?accessToken=eyJhbGciOiJIUzI1NiIsImtpZCI6ImRlZmF1bHQiLCJ0eXAiOiJKV1QifQ.eyJleHAiOjE3MjQ3MjQxNDYsImZpbGVHVUlEIjoiUjEzamRRakJwMmZyNzhrNSIsImlhdCI6MTcyNDcyMzg0NiwiaXNzIjoidXBsb2FkZXJfYWNjZXNzX3Jlc291cmNlIiwidXNlcklkIjo1MDA3OTA2fQ.nbnam2hbkFyplnUaFoqGJTolnjxlQTmmqtmW5T5-Qzg\">Bikram Kundu在Jstobigdata</a>\"博客上讨论了Kubernetes StatefulSet的复杂性和局限性，并总结了该领域的一些最佳实践。</p><p></p><p>原文链接：</p><p><a href=\"https://www.infoq.com/news/2024/08/slack-kubernetes-operator-bedroc/\">https://www.infoq.com/news/2024/08/slack-kubernetes-operator-bedroc/</a>\"</p>",
    "publish_time": "2024-08-28 08:00:00",
    "source": {
      "name": "infoq_recommend",
      "desc": "InfoQ推荐",
      "icon": "https://raw.githubusercontent.com/maguowei/today/master/imgs/icon/infoq.png"
    }
  },
  {
    "title": "中国数据库前世今生第5集：2020年代/国产数据库“百团大战”",
    "url": "https://www.infoq.cn/article/oK0d52icRBMwRpUfzQ3y",
    "summary": "<p>本集纪录片将聚焦于国产数据库在当前时代面临的挑战与机遇，深入分析技术发展、市场策略、政策支持等多重因素如何共同推动国产数据库的进步。与此同时，我们也将讨论 2020s 的数据库技术的演变，特别是图数据库、HTAP 数据库等新型数据库技术的诞生与发展。在 LLM 技术取得突破性进展的今天，向量数据库以其卓越的数据存储和检索能力，成为业界瞩目的焦点。三位资深嘉宾也将分享他们对于向量数据库与大模型结合前景的深刻见解，以及这一新兴技术如何引领数据库技术的未来革新。</p>",
    "publish_time": "2024-08-28 09:38:20",
    "source": {
      "name": "infoq_recommend",
      "desc": "InfoQ推荐",
      "icon": "https://raw.githubusercontent.com/maguowei/today/master/imgs/icon/infoq.png"
    }
  }
]