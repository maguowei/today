[
  {
    "title": "HTTP/3为什么正迅速吞噬世界？",
    "url": "https://www.infoq.cn/article/kII5H8RrJkPzYTmZoPH4",
    "summary": "<p>超文本传输协议（HTTP）作为互联网的基石，一直在网页加载、视频流传输、应用获取数据等方方面面发挥重要作用。</p><p>&nbsp;</p><p>去年，负责定义互联网技术的互联网工程任务组（IETF）将该协议的最新版本HTTP/3定为标准。在此之后，HTTP.3及相关QUIC协议在公共网络上迅速普及。尽管不同来源和测量方法给出的结果略有差别，但目前普遍认为全球19%到50%的Web服务器和网络均已支持HTTP/3。</p><p>&nbsp;</p><p>由于这些新协议得到谷歌和Meta等大公司的广泛应用，我们认为，当前互联网流量中已经有很大一部分在使用HTTP/3。</p><p>&nbsp;</p><p>在本篇文章中，我将介绍一些背景信息，介绍HTTP/3解决了哪些问题、它是如何执行的、为什么能够得到迅速普及，以及HTTP/3仍然面临哪些有待克服的障碍。</p><p>&nbsp;</p><p></p><h2>我们为什么需要HTTP/3?</h2><p></p><p>&nbsp;</p><p>网络协议所描述的，是数据如何在网络上的两个实体之间（通常是用户设备和Web服务器）进行通信。因为市场上有多家公司在为网络开发软件，因此通信协议必须确保标准化，以便所有软件之间都可以“互操作”。换句话说，各软件能够在遵循相同规则的基础之上相互理解。</p><p>&nbsp;</p><p>在实践当中，我们往往不会使用单一某种协议，而是同时使用多种协议的组合。其中各项协议都有自己的作用和规则（详见图一）。这样的设计是为了保障灵活性和可复用性——无论大家使用的是Wi-Fi、固网还是4G/5G，都能使用完全相同的HTTP逻辑。</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/c3/c334bdf14095bae99e63c9f1e384f15b.png\" /></p><p></p><p>图1 HTTP/2与HTTP/3的协议栈，如何将多项协议组合起来以提供完整的互联网功能</p><p>&nbsp;</p><p>不少初期互联网协议早在上世纪80、90年代就已经被定为标准，这意味着它们在设计上考虑的是几十年前的需求和限制。虽然其中一些协议经受住了时间的考验，但也有不少已经明显有些过时了。大多数问题倒是可以通过变通和一些小技巧进行解决，可也有一些到了不得不变的时候。其中最典型的就是传输控制协议（TCP），它的作用是确保数据能够可靠地在互联网上往来传输。</p><p>&nbsp;</p><p></p><h2>为什么说TCP已经不适合如今的Web</h2><p></p><p>&nbsp;</p><p>HTTP/1.1和HTTP/2正常运作的前提，就是以TCP为基础。具体来讲，在客户端和服务器间交换HTTP请求/响应之前，必须先建立起TCP连接。</p><p>&nbsp;</p><p>随着时间推移，人们做出了不少努力来更新TCP，并解决其中一些影响效率的问题——例如，TCP会将网页视为单个文件，而非由数百个独立文件构成的集合。虽然部分更新已经取得成功，但多数影响较大的更新（例如TCP多路径和TCP Fast Open）花了近十年时间才在公共互联网上实际落地。</p><p>&nbsp;</p><p>革新TCP的主要挑战，在于互联网上成千上万的设备各有各的TCP协议实现。除了大家第一时间能想到的手机、笔记本电脑和服务器，还有路由器、防火墙、负载均衡器等其他类型的“中间装置”。也就是说，如果我们想要更新TCP，就必须等待这些设备中的大部分都对自己的协议实现做更新，而这明显是个需要耗时数年的艰辛过程。</p><p>&nbsp;</p><p></p><h3>QUIC解决方案</h3><p></p><p>&nbsp;</p><p>面对这个几乎无解的问题，最靠谱的办法反而是直接出台一种全新方案、直接替换掉TCP。这套替代方案就是QUIC协议，但也有不少人半开玩笑地将其称为TCP 2.0。这个昵称其实并无不妥，因为QUIC中确实包含许多与TCP相同的高级功能，只是做了一系列关键性调整。</p><p>&nbsp;</p><p>其中最大的变化就是QUIC与传输层安全（TLS）协议的深度集成。TLS负责加密网络上的敏感数据，也就是HTTPS中的S（安全）。在TCP协议下，TLS仅加密实际HTTP数据（参见图二）；对于QUIC，TLS还会对QUIC协议本身的大部分内容进行加密。也就是说，TCP当中对所有中间件均可见（且可更改）的元数据（例如数据包编号、连接关闭信号等），在现在的QUIC中将仅供客户端和服务器使用。</p><p>&nbsp;</p><p><img src=\"https://static001.geekbang.org/infoq/79/79416600a9b5921a2117dd23cc707983.png\" /></p><p></p><p>图2 TCP+TLS与QUIC之间的加密差异。可以看到，QUIC中被加密的不仅仅是HTTP数据</p><p>&nbsp;</p><p>此外，由于QUIC的加密程度更高，所以对它的变更或新功能添加要比TCP简单得多——即只需要更新客户端和服务器，因为中间件无论如何也无法解密元数据。这就让QUIC成为一种面向未来的协议，能帮助我们快速解决种种新兴挑战。</p><p>&nbsp;</p><p>当然，这种额外的加密机制也有助于增强新协议的总体安全性和隐私性。虽然TCP+TLS非常适合保护信用卡或电子邮件内容等个人敏感数据，但却仍容易受到复杂（隐私）攻击的影响。而且随着AI技术的快速发展，这些攻击的实施门槛也越来越低。通过进一步加密此类元数据，QUIC协议无疑能够更好地应对精心策划的恶意攻击。</p><p>&nbsp;</p><p>QUIC还包含诸多其他与安全相关的功能，包括防御分布式拒绝服务（DDoS）攻击、以及防放大和RETRY数据包等功能。</p><p>&nbsp;</p><p>最后，与TCP相比，QUIC还带来了大量效率和性能改进，包括更快的连接握手（参见图三）、消除“队头阻塞”问题、更好的数据包丢失检测/恢复，以及处理用户切换网络的方法（我们将在后续文章中具体介绍）。</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/25/25200db49ceebac34661be5a4a213fed.png\" /></p><p></p><p>图3 QUIC在设置上拥有更快的连接速度，因为它能将“传输”三向握手与TLS加密会话相结合，性能优于TCP+TLS中的两个独立过程</p><p>&nbsp;</p><p></p><h2>我们真正需要的并不是HTTP/3，而是QUIC</h2><p></p><p>&nbsp;</p><p>最初，我们也曾尝试保留HTTP/2并进行增量式调整，希望能在底层用上QUIC（毕竟当初保留这么多协作元素和可复用协议，意义也就在于此）。但很明显，QUIC与TCP之间存在着巨大差异，HTTP/2根本无法全部兼容。因此，互联网工程任务组才决定专门为QUIC制作新的HTTP版本，这就是现在的HTTP/3。</p><p>&nbsp;</p><p>HTTP/3与HTTP/2几乎相同，二者的主要区别就体现在QUIC/TCP之上各项功能的技术实现。但由于HTTP/3能够使用QUIC的全部新功能，因此在加载网页和流媒体视频时将带来更好的性能表现。也正是这个优势，让HTTP/3得到了市场的广泛认可和快速接纳。</p><p>&nbsp;</p><p>原文链接：</p><p></p><p><a href=\"https://blog.apnic.net/2023/09/25/why-http-3-is-eating-the-world/\">https://blog.apnic.net/2023/09/25/why-http-3-is-eating-the-world/</a>\"</p><p></p><p></p><h5>相关阅读：</h5><p></p><p></p><p><a href=\"https://mp.weixin.qq.com/s?__biz=MzI3NzE0NjcwMg%3D%3D&amp;chksm=f368ba65c41f33733cc3c78ea6e638c841df7eb25aa3e16eb757e74b11964e78d3a848648767&amp;idx=3&amp;mid=2650187588&amp;scene=27&amp;sn=999c866c2bed020a111b3506f803c410&amp;utm_campaign=geek_search&amp;utm_content=geek_search&amp;utm_medium=geek_search&amp;utm_source=geek_search&amp;utm_term=geek_search#wechat_redirect\">HTTP/3&nbsp;发布了，我们来谈谈&nbsp;HTTP/3</a>\"</p><p><a href=\"https://www.infoq.cn/article/SOtQV5xLEI6KBdjYyI0y?utm_campaign=geek_search&amp;utm_content=geek_search&amp;utm_medium=geek_search&amp;utm_source=geek_search&amp;utm_term=geek_search\">基于 QUIC 协议的&nbsp;HTTP/3&nbsp;正式发布</a>\"</p><p><a href=\"https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng%3D%3D&amp;chksm=fa4aad35cd3d24233acd9b864784d3084bd4169596bb466e11c1ebdee7f954be7a84dcf64c58&amp;idx=2&amp;mid=2247504516&amp;scene=27&amp;sn=6422df56b0fd748dc8e8e436d3874376&amp;utm_campaign=geek_search&amp;utm_content=geek_search&amp;utm_medium=geek_search&amp;utm_source=geek_search&amp;utm_term=geek_search#wechat_redirect\">从&nbsp;HTTP&nbsp;到&nbsp;HTTP/3&nbsp;的发展简史</a>\"</p><p><a href=\"https://mp.weixin.qq.com/s?__biz=MjM5MDE0Mjc4MA%3D%3D&amp;chksm=bdbe8cd38ac905c5b6c7f4be1a042158e6fab31a8b15f927d1050df5eb144cdd8297fc5fdd79&amp;idx=3&amp;mid=2651026560&amp;scene=27&amp;sn=2a8f5e8fcad8156e1bee4f94da2d78ec&amp;utm_campaign=geek_search&amp;utm_content=geek_search&amp;utm_medium=geek_search&amp;utm_source=geek_search&amp;utm_term=geek_search#wechat_redirect\">HTTP/3&nbsp;与&nbsp;HTTP/2&nbsp;的性能对比</a>\"</p>",
    "publish_time": "2023-11-12 08:00:00",
    "source": {
      "name": "infoq_recommend",
      "desc": "InfoQ推荐",
      "icon": "https://raw.githubusercontent.com/maguowei/today/master/imgs/icon/infoq.png"
    }
  }
]