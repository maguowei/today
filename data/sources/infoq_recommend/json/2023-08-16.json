[
  {
    "title": "分布式PostgreSQL基准测试：Azure Cosmos DB、CockroachDB和YugabyteDB",
    "url": "https://www.infoq.cn/article/0HLeJbIogjXgqZ8bbCJj",
    "summary": "<p>最近，微软详细介绍了<a href=\"https://devblogs.microsoft.com/cosmosdb/distributed-postgresql-benchmarks-using-hammerdb-by-gigaom/\">分布式PostgreSQL基准测试的结果</a>\"，比较了Azure Cosmos DB for PostgreSQL、CockroachDB与Yugabyte的事务处理性能和价格。这几种数据库在实现时做了不同的权衡，测试结果显示，Azure Cosmos DB的吞吐量更高。同时，他还着重指出了针对分布式数据库进行基准测试所面临的挑战。</p><p>&nbsp;</p><p>根据<a href=\"https://research.gigaom.com/report/transaction-processing-price-performance-testing/\">GigaOm基准测试</a>\"，在事务性能和价格方面，采用Citus分布式表的<a href=\"https://learn.microsoft.com/en-us/azure/cosmos-db/postgresql/introduction\">Azure Cosmos DB for PostgreSQL</a>\"优于CockroachDB Dedicated和Yugabyte Managed这两种全托管分布式数据库。</p><p>&nbsp;</p><p>正如<a href=\"https://www.infoq.com/news/2021/10/cloud-spanner-postgresql/\">InfoQ之前的报道</a>\"，随着不同的供应商对PostgreSQL这个流行的开源关系型数据库进行扩展、重新实现或创建分叉，它正在成为云分布式数据库的新标准。这项由微软赞助的基准测试使用了<a href=\"https://github.com/TPC-Council/HammerDB/\">HammerDB</a>\"。这是一个用于对关系型数据进行基准测试的开源工具，由事务性能委员会（<a href=\"https://www.tpc.org/\">Transaction Performance Council</a>\"，缩写为TPC）负责管理。微软首席软件工程师<a href=\"https://www.linkedin.com/in/marcoslot/\">Marco Slot</a>\"写道：</p><p></p><p></p><blockquote>GigaOM使用HammerDB TPROC-C对Azure Cosmos DB for PostgreSQL和两个类似的托管服务产品（…）进行了基准测试。在最初的基准测试中，GigaOM使用了1000个仓库，产生了大约100GB的数据。然而，CockroachDB和Yugabyte的吞吐量之低令人惊讶。在不改变连接数的情况下，增加两者的仓库数量可以提升性能。</blockquote><p></p><p>&nbsp;</p><p></p><p><img src=\"https://static001.geekbang.org/infoq/2f/2f32249fbec97e91fcf1b2c95cc52e6f.png\" /></p><p></p><p>图片来源：<a href=\"https://devblogs.microsoft.com/cosmosdb/distributed-postgresql-benchmarks-using-hammerdb-by-gigaom/\">https://devblogs.microsoft.com/cosmosdb/distributed-postgresql-benchmarks-using-hammerdb-by-gigaom/</a>\"</p><p>&nbsp;</p><p>有一个非常重要但颇有争议的点是<a href=\"https://www.citusdata.com/product/citus-on-azure/\">Citus</a>\"的使用。Citus是PostgreSQL中一个用于分发表的开源扩展，它要求开发人员指定一个分发列，即分片键：</p><p></p><p></p><blockquote>Citus的核心理念一直是：分布式PostgreSQL是为大规模、高性能而生的，因为对于其他任何事情，PostgreSQL都已经足够好。</blockquote><p></p><p>&nbsp;</p><p>测试的其他分布式数据库不依赖于分布式列的定义。在Reddit上，Slot<a href=\"https://www.reddit.com/r/PostgreSQL/comments/14fbjgg/comment/jozf85t/?utm_source=share&amp;utm_medium=web2x&amp;context=3\">承认</a>\"了其中的区别：</p><p></p><p></p><blockquote>性能差异似乎有点尴尬。我想特别指出的是，使用Citus确实需要一些额外的步骤（例如create_distributed_table）来定义分布式列和协同定位（否则，你只能使用单个节点）。我们的经验是，如果不对相关数据做协同定位，那么传统的事务型PostgreSQL工作负载的性能将比单个服务器差许多。</blockquote><p></p><p>&nbsp;</p><p>YugabyteDB开发大使Franck Pachot在推特上谈到了这项基准测试，他<a href=\"https://twitter.com/FranckPachot/status/1672330208802635776\">提了一个问题</a>\"：</p><p></p><p></p><blockquote>这是比较Citus（通过两阶段提交协议在SQL数据库上实现的分片）与YugabyteDB及CockroachDB （通过全局ACID事务在分布式存储上实现的SQL）吗？弹性、全局一致性、灵活性、自动划分/再平衡都不在同一个层次上。它们针对的是不同的用例。</blockquote><p></p><p>&nbsp;</p><p>该报告承认，对于不同的部署，不同的分布式数据库可能在不同的特性上胜出，包括响应时间、并发性、容错性、功能、一致性或持久性。Slot总结道：</p><p></p><p></p><blockquote>分布式系统，尤其是分布式数据库，涉及多个层面的权衡。CockroachDB和Yugabyte做了不同的权衡，它们不需要分布式列（…）不管是扩展Postgres（如Citus所做的），还是创建Postgres分叉（如Yugabyte所做的），亦或是是重新实现Postgres（如CockroachDB所做的），每一种决定也都是一个权衡，都会对最终用户的体验产生重大的或好或坏的影响。</blockquote><p></p><p>&nbsp;</p><p>为了鼓励客户运行与其工作负载相匹配的基准测试，<a href=\"https://github.com/citusdata/citus-benchmark/tree/master/azure\">微软共享了辅助脚本</a>\"，以便他们可以在Azure Cosmos DB上运行HammerDB基准测试。微软高级软件工程师<a href=\"https://www.linkedin.com/in/jeltef/\">Jelte Fennema</a>\"<a href=\"https://victorious-mud-07c59021e-600.westus2.3.azurestaticapps.net/blog/2022/03/12/how-to-benchmark-performance-of-citus-and-postgres-with-hammerdb/\">展示</a>\"了如何自动运行基准测试，包括集群设置和销毁。</p><p>&nbsp;</p><p>按照GigaOm的说法，<a href=\"https://cloud.google.com/spanner/docs/postgresql-interface\">Google Spanner Postgres Interface</a>\"之所以不在比较范围，是因为该服务不提供运行基准测试所需的Postgres兼容性级别。</p><p>&nbsp;</p><p>&nbsp;</p><p>原文链接：</p><p><a href=\"https://www.infoq.com/news/2023/07/distributed-postgresql-benchmark/\">https://www.infoq.com/news/2023/07/distributed-postgresql-benchmark/</a>\"</p><p></p><p>相关阅读：</p><p><a href=\"https://www.infoq.cn/article/VVCTQbCV1rKcZoMD3TKR\">这将是一场灾难？37年历史的PostgreSQL数据库将进行重大架构变更</a>\"</p><p><a href=\"https://www.infoq.cn/article/4114G9FlqZFEyTzQ53mq\">微软发布Azure Cosmos DB for PostgreSQL</a>\"</p>",
    "publish_time": "2023-08-16 08:00:00",
    "source": {
      "name": "infoq_recommend",
      "desc": "InfoQ推荐",
      "icon": "https://raw.githubusercontent.com/maguowei/today/master/imgs/icon/infoq.png"
    }
  }
]